function create_beam(){var d=new platform("beam","Mixer");return d.domain="mixer.com",d.url="https://"+d.domain+"/",d.api_url=d.url+"api/v1/",d.avatar_size=26,d.badge_size=18,d.name_colors={Pro:"#c642ea",Mod:"#37ed3b",GlobalMod:"#07fdc6",Staff:"#ecbf37",User:"#37aad5",Owner:"#ffffff",Founder:"#e42d2d"},d.user_roles=["Owner","Mod","Founder","GlobalMod","Staff","Pro","User"],d.emoticons_url="https://static.mixer.com/emotes/2.0.4/emoticons/",d.elements={connect_label:$("#connect-beam-label"),live_info_div:$("#beam-live-info-div"),live_status_div:$("#beam-live-status-div"),viewer_user_count:$("#beam-live-status-div>.viewer-count-div>.user-count"),follower_user_counut:$("#beam-live-info-div>.follower-count-div>.user-count"),live_time_div:$("#beam-live-status-div>.live-time-div"),live_up_time:$("#beam-live-status-div>.live-time-div>.up-time"),emoticon_list_padding:$("#beam-emoticon-list-padding"),channel_title_textarea:$("#beam-channel-title-textarea"),channel_game_inputtext:$("#beam-channel-game-inputtext"),channel_game_list_ul:$("#beam-channel-game-list-ul"),channel_status_set_button:$("#beam-channel-status-set-button"),channel_status_refresh_button:$("#beam-channel-status-refresh-button"),connections_menu_div:$("#connections-menu-div"),option_menu_div:$("#beam-option-menu-div"),slow_mode_set_button:$("#beam-slow-mode-set-button"),slow_mode_inputnumber:$("#beam-slow-mode-inputnumber"),clear_chat_button:$("#beam-clear-chat-button")},d.current_endpoint=0,window.WebSocket||(window.WebSocket=window.MozWebSocket),d.init=function(){d.user_name="",d.channel="",d.user_id=-1,d.channel_id=-1,d.auth_key="",d.endpoints=[],d.chat_id=0,d.room_state={},d.badges=null,d.emotIconsAdd=null,d.send_message_id={msg_id:{},chat_id:{},reply_id:{}}},d.init(),d.initApiEndpoint=function(){d.setApiLinks({chats:d.api_url+"chats/"+d.channel_id,channels:d.api_url+"channels/"+d.channel_id,chats_users:d.url+"api/v2/chats/"+d.channel_id+"/users",types:d.api_url+"types",channels_emoticons:d.api_url+"channels/"+d.channel_id+"/emoticons",channels_preferences:d.api_url+"channels/"+d.channel_id+"/preferences",channels_details:d.api_url+"channels/"+d.channel_id+"/details",broadcasts:d.api_url+"broadcasts/current"})},d.onChangeToken=function(){d.setApiHeaders({Authorization:"Bearer "+d.access_token})},d.connect=function(){checkAuth(d.name,function(e){e&&checkTokenExpire(d.name,function(){""===d.user_name?d.api("",{url:d.api_url+"users/current"}).done(function(e){e.username&&e.channel?(d.user_name=e.username,d.channel=e.channel.token,d.user_id=e.id,d.channel_id=e.channel.id,updateId(d.name,d.channel),chat.addSelfUsername(d.name,d.user_name),d.initApiEndpoint(),tooltip.applyTooltip(d.elements.connect_label,d.user_name),chat.systemMessage(d.name,'Connecting to channel "'+d.channel+'"...'),d.ircConnect(),d.constellation.connect()):(chat.systemMessage(d.name,"Failed to retrieve user name."),d.timer.connect.start())}).fail(function(){chat.systemMessage(d.name,"Failed to retrieve user name."),d.timer.connect.start()}):d.ircConnect()})})},d.disconnect=function(){isEmpty(d.irc)||d.irc.close(),d.constellation.disconnect(),d.toggleNameList(!1)},d.ircConnect=function(){void 0!==d.irc&&(d.irc.readyState<2&&d.irc.close(),d.irc=void 0),void 0===d.irc&&window.WebSocket&&d.api("chats").done(function(e){e.endpoints&&e.endpoints.length&&e.authkey?(d.endpoints=e.endpoints,d.auth_key=e.authkey,d.current_endpoint>=d.endpoints.length&&(d.current_endpoint=0),d.irc=new WebSocket(d.endpoints[d.current_endpoint++]),d.irc.onopen=function(){},d.irc.onclose=function(){d.onDisconnected(),isEmpty(d.access_token)||d.onReconnect()},d.irc.onerror=function(){},d.irc.onmessage=function(e){var t=JSON.parse(e.data);switch(isEmpty(t.type)&&(t.type="error"),t.type){case"reply":if(isEmpty(t.error)||isEmpty(t.error.message)||chat.noticeMessage(d.name,t.error.message),!isEmpty(t.data)){if(!isEmpty(t.data.authenticated)&&t.data.authenticated)return void d.onConnected();t.id&&t.data.id&&d.send_message_id.chat_id.hasOwnProperty(t.id)&&(d.send_message_id.reply_id[t.data.id]=d.send_message_id.chat_id[t.id],d.send_message_id.msg_id[d.send_message_id.chat_id[t.id]].reply_id[t.data.id]=null,delete d.send_message_id.msg_id[d.send_message_id.chat_id[t.id]].chat_id[t.id],delete d.send_message_id.chat_id[t.id])}break;case"event":if(!isEmpty(t.event)&&t.hasOwnProperty("data"))switch(t.event){case"WelcomeEvent":d.chatAuth();break;case"ChatMessage":d.onMessage(t.data);break;case"SkillAttribution":d.onSkillAttribution(t.data);break;case"PollStart":case"PollEnd":break;case"UserJoin":d.onJoin(t.data);break;case"UserLeave":d.onPart(t.data);break;case"ClearMessages":d.onClearChat()}break;default:chat.systemMessage(d.name,"Unknown message: "+e.data)}}):chat.systemMessage(d.name,"Error on GET chats: "+e)})},d.send=function(e,t){if(void 0!==d.irc){var n={type:"method",method:e,arguments:t,id:++d.chat_id};d.irc.send(JSON.stringify(n))}},d.chatAuth=function(){0<=d.channel_id&&0<=d.user_id&&""!==d.auth_key?d.send("auth",[d.channel_id,d.user_id,d.auth_key]):chat.systemMessage(d.name,"Error on Authorization.")},d.chatVote=function(e){d.send("vote",[e])},d.chatClear=function(){d.send("clearMessages",[])},d.onConnected=function(){chat.systemMessage(d.name,"Connected successfully."),void 0===d.init_channel_once&&(d.init_channel_once=!0),d.onEmoteSets(),d.getStreamStatus(!0),d.getRoomState(),d.toggleNameList(!0),d.listChatters(),d.toggleConnectStatus(!0)},d.reset=function(){d.toggleConnectStatus(!1),d.constellation.disconnect(),d.timer.stopAll(),d.init(),d.onNames([]),d.elements.emoticon_list_padding.empty(),d.toggleEmotIconDiv(!1)},d.onDisconnected=function(){chat.systemMessage(d.name,"Disconnected."),d.reset(),d.toggleNameList(!1)},d.onReconnect=function(){chat.systemMessage(d.name,"Reconnecting..."),d.toggleNameList(!1),d.connect()},d.onMessage=function(e){if(!isEmpty(e.user_name)&&!isEmpty(e.message)&&(isEmpty(e.message.meta)||!e.message.meta.censored)){isEmpty(e.user_roles)&&(e.user_roles=["User"]);for(var t=null,n=0;n<d.user_roles.length;++n)if(-1!==e.user_roles.indexOf(d.user_roles[n])){t=d.name_colors[d.user_roles[n]];break}var o={user:{"display-name":e.user_name,roles:{},color:t},message:d.messageText(e.message.message),formatted_message:d.formatMessage(e.message),badge:d.getAvatar(e.user_id),badge_after:d.formatBadges(e.user_roles),self:-1!==e.user_roles.indexOf("Owner"),sent:null};if(-1!==e.user_roles.indexOf("Subscriber")&&(o.user.roles.subscriber=1),-1!==e.user_roles.indexOf("Mod")&&(o.user.roles.moderator=1),o.self&&e.id&&d.send_message_id.reply_id.hasOwnProperty(e.id)){var i=d.send_message_id.reply_id[e.id];if(o.sent={id:i},d.send_message_id.msg_id.hasOwnProperty(i)){var s=d.send_message_id.msg_id[i];o.sent.output=s.output,o.event=s.event,s.reply_id.hasOwnProperty(e.id)&&delete s.reply_id[e.id],delete d.send_message_id.reply_id[e.id],s.complete&&isEmpty(s.reply_id)&&isEmpty(s.chat_id)?(o.sent.complete=!0,delete d.send_message_id.msg_id[i]):o.sent.complete=!1}else o.sent.complete=!1}isEmpty(e.message.meta)||(e.message.meta.hasOwnProperty("me")&&e.message.meta.me&&(o.user["message-type"]="action"),e.message.meta.hasOwnProperty("whisper")&&e.message.meta.whisper&&(o.user["message-type"]="whisper")),chat.onMessage(d.name,o)}},d.messageText=function(e){if(isEmpty(e))return"";for(var t,n="",o=0;o<e.length;++o)switch((t=e[o]).type){case"text":n+=t.data;break;case"emoticon":chat.keyword_filter.isMuteEmoticons()?n+=" ":n+=t.text;break;case"link":n+=t.text;break;case"tag":n+=t.username;break;case"image":n+=" ";break;default:isEmpty(t.text)||(n+=t.text)}return n},d.formatMessage=function(e){if(!isEmpty(e.meta)&&e.meta.is_skill){e.meta.skill;return d.skillAttribution(e.meta.skill)}if(isEmpty(e=e.message))return"";for(var t,n="",o=0;o<e.length;++o)switch((t=e[o]).type){case"text":n+=t.text;break;case"emoticon":n+=d.formatEmot(t);break;case"link":n+='<a href="'+t.url+'" target="_blank">'+t.text+"</a>";break;case"tag":n+=t.text;break;case"image":n+='<img src="'+t.url+'" style="max-width: 2em; max-height: 2em;"'+(isEmpty(t.text)?"":' tooltip="'+t.text+'"')+" />";break;default:isEmpty(t.text)||(n+=t.text)}return n},d.onSkillAttribution=function(e){if(!isEmpty(e.user_name)){isEmpty(e.user_roles)&&(e.user_roles=["User"]);for(var t=null,n=0;n<d.user_roles.length;++n)if(-1!==e.user_roles.indexOf(d.user_roles[n])){t=d.name_colors[d.user_roles[n]];break}var o={user:{"display-name":e.user_name,roles:{},color:t},message:"",formatted_message:d.skillAttribution(e.skill),badge:d.getAvatar(e.user_id),badge_after:d.formatBadges(e.user_roles),self:-1!==e.user_roles.indexOf("Owner"),sent:null};-1!==e.user_roles.indexOf("Subscriber")&&(o.user.roles.subscriber=1),-1!==e.user_roles.indexOf("Mod")&&(o.user.roles.moderator=1),chat.onMessage(d.name,o)}},d.skillAttribution=function(e){return'<div class="beam-skill">'+("Sparks"===e.currency?'<i class="fas fa-bolt"></i>':isEmpty(e.currency)?"":e.currency+" ")+e.cost+' <img src="'+e.icon_url+'"'+(isEmpty(e.skill_name)?"":' tooltip="'+e.skill_name+'"')+" /></div>"},d.formatEmot=function(e){var t="builtin"===e.source?d.emoticons_url+e.pack+".png":""!==e.pack?e.pack:isEmpty(d.emotIconsAdd)?"":d.emotIconsAdd.url;return" "+d.createEmoji(t,e.coords,e.text)},d.createEmoji=function(e,t,n){var o=28/12/t.width,i=function(e){return(e*o).toFixed(3)},s=escapeHTML(escapeHTML(n).replace(/'/g,"&#39;"));return'<span class="beam-emoticon" tooltip="'+s+'" data-emotcode=" '+s+' " style="width:'+i(t.width)+"em;height:"+i(t.height)+'em"><img src="'+e+'" style="margin:-'+i(t.y)+"em 0 0 -"+i(t.x)+'em" onload="'+d.name+".onEmojiLoad(this,"+t.width+')"></span>'},d.onEmojiLoad=function(e,t){e.style.width=28*e.naturalWidth/12/t+"em"},d.formatUserName=function(e,t,n){var o=getUserColor(n);return'<span class="username-span"'+(o=isEmpty(o)?"":' style="color: '+o+';"')+">"+d.getAvatar(t)+e+d.formatBadges(n)+"</span>"},d.getUserColor=function(e){for(var t=0;t<e.length;++t)if(d.name_colors.hasOwnProperty(e[t]))return d.name_colors[e[t]];return null},d.getAvatar=function(e){return'<img class="beam-profile-img profile-img" src="'+d.api_url+"users/"+e+"/avatar?w="+d.avatar_size+"&h="+d.avatar_size+'">'},d.formatBadges=function(e){if(!isEmpty(d.badges)&&-1!==e.indexOf("Subscriber")){var t=[d.badge_size,d.badge_size];return isEmpty(badge.meta)||isEmpty(badge.meta.size)||(badge.meta.size[1]>t[1]?t[0]=t[1]/badge.meta.size[1]*badge.meta.size[0]:t=badge.meta.size),'<span class="" tooltip="Subscriber"><img src="'+d.badges.url+'" alt="Subscriber" class="badge-img" width='+t[0]+" height="+t[1]+"></span>"}return null},d.getChatBadges=function(){""!==d.channel&&d.api("channels",{data:{fields:"badge"}}).done(function(e){isEmpty(e.badge)||isEmpty(e.badge.url)||(d.badges=e.badge)})},d.sendMessage=function(n){return!!d.isConnected()&&(d.send_message_id.msg_id[n.id]={chat_id:{},reply_id:{},complete:!1,output:n.output,event:!!n.hasOwnProperty("event")&&n.event},stringSlice(n.msg,360,function(e,t){d.processSendMessage({msg:e,id:n.id,complete:t})}),!0)},d.chatSend=function(e){d.send_message_id.msg_id[e.id].complete|=e.complete,d.send_message_id.msg_id[e.id].chat_id[d.chat_id+1]=null,d.send_message_id.chat_id[d.chat_id+1]=e.id,d.send("msg",[e.msg])},d.send_message_queue=[],d.send_message_sending=!1,d.processSendMessage=function(e){isEmpty(e.msg)||(d.send_message_queue.push(e),!1===d.send_message_sending&&(d.send_message_sending=!0,d.processSendMessageQueue()))},d.processSendMessageQueue=function(){if(d.send_message_queue.length<=0)d.send_message_sending=!1;else{var e=d.send_message_queue.shift();d.chatSend(e),d.timer.send_message_queue.start()}},d.isConnected=function(){if(void 0!==d.irc)return d.irc.readyState===d.irc.OPEN},d.onNotice=function(e){chat.noticeMessage(d.name,e)},d.onClearChat=function(){chat.clearMessage(d.name),d.onNotice("Chat was cleared by a moderator")},d.onNames=function(e){if(0!==e.length){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]={id:e[n]};$doc.trigger("name_list:names",{platform_name:d.name,users:t})}},d.onJoin=function(e){""!==d.user_name&&d.user_name!==e.username&&$doc.trigger("name_list:join",{platform_name:d.name,user:{id:e.username}})},d.onPart=function(e){$doc.trigger("name_list:part",{platform_name:d.name,user:{id:e.username}})},d.listChatters=function(){""!==d.user_name&&d.api("chats_users").done(function(e){if(e&&e.length){for(var t=[],n=0;n<e.length;++n)isEmpty(e[n].username)||d.user_name===e[n].username||t.push(e[n].username);d.onNames(t)}})},d.getLiveTime=function(){d.api("broadcasts").done(function(e){e&&e.startedAt&&d.showLiveTime(new Date(e.startedAt)-(new Date(e.now||Date.now())-Date.now()))}).fail(function(){})},d.getStreamStatus=function(t,n){-1===d.channel_id?d.toggleOnlineStatus(!1):d.api("channels").done(function(e){e&&(e.online||n)?(d.toggleOnlineStatus(!0),d.showViewerCounter(e.viewersCurrent),d.getLiveTime()):d.toggleOnlineStatus(!1),d.showFollowerCounter(e.numFollowers),t&&d.getChannelInfo(e)}).fail(function(){d.toggleOnlineStatus(!1),chat.systemMessage(d.name,"Failed to retrieve stream status.")})},d.setChannelTitle=function(e){-1!==d.channel_id&&d.api("channels",{data:JSON.stringify({name:e}),method:"PATCH"}).done(function(e){!isEmpty(e)&&e.hasOwnProperty("name")?(d.elements.channel_title_textarea.val(e.name),chat.systemMessage(d.name,"Channel information updated successfully. Title: "+e.name)):chat.systemMessage(d.name,"Failed to update channel title.")}).fail(function(){chat.systemMessage(d.name,"Failed to update channel title.")})},d.elements.channel_status_set_button.on1("click",function(e){d.elements.channel_title_textarea.val().length<4?showSetTitleWarningMessage("["+d.display_name+"] title must be at least 4 characters long.",$(this)):d.setChannelInfo()}),d.elements.channel_status_refresh_button.on1("click",function(e){d.getStreamStatus(!0)}),d.setChannelInfo=function(){if(-1!==d.channel_id){var t=d.elements.channel_game_inputtext.val();d.api("types",{data:{where:"name:eq:"+t.replace(/[:;.,]/g,"\\$&"),limit:1,page:0}}).done(function(e){isEmpty(e)||!e.length||"string"!=typeof e[0].name||"number"!=typeof e[0].id||e[0].name.toLowerCase()!==t.toLowerCase()?showSetTitleWarningMessage("["+d.display_name+"] no matched game name found.",d.elements.channel_status_set_button):d.api("channels",{data:JSON.stringify({name:d.elements.channel_title_textarea.val(),typeId:e[0].id}),method:"PATCH"}).done(function(e){!isEmpty(e)&&e.hasOwnProperty("name")&&e.hasOwnProperty("type")&&(d.elements.channel_title_textarea.val(e.name),d.elements.channel_game_inputtext.val(e.type.name),chat.systemMessage(d.name,"Channel information updated successfully. Title: "+e.name+" , Game Name: "+e.type.name))}).fail(function(){chat.systemMessage(d.name,"Failed to update channel title and game.")})}).fail(function(){chat.systemMessage(d.name,"Failed to update channel title and game.")})}},d.getChannelInfo=function(e){d.elements.channel_title_textarea.val(e.hasOwnProperty("name")?e.name:""),d.elements.channel_game_inputtext.val(e.type&&e.type.hasOwnProperty("name")?e.type.name:"")},d.getGameList=function(){var e=d.elements.channel_game_inputtext.val();isEmpty(e)||isEmpty(d.access_token)?d.closeGameList():(d.get_game_list_queue=!0,d.timer.get_game_list.isFinished()&&(d.get_game_list_queue=!1,d.timer.get_game_list.start(),d.api("types",{data:{query:e}}).done(function(e){if(e&&e.length){for(var t=[],n=0;n<e.length;++n)t.push({html:e[n].name});select_list.openList(d.elements.channel_game_inputtext,t,function(e){null!==e&&(d.elements.channel_game_inputtext.val(e.html),d.elements.channel_game_inputtext.focus()),d.get_game_list_queue=!1})}})))},d.closeGameList=function(){d.get_game_list_queue=!1,select_list.closeList()},d.elements.channel_game_inputtext.on1("input click",function(e){d.getGameList()}),d.elements.channel_game_inputtext.on1("blur",function(e){d.closeGameList()}),d.elements.channel_game_inputtext.on1("mousedown",function(e){e.stopPropagation()}),d.onEmoteSets=function(){-1!==d.channel_id&&d.api("channels_emoticons").done(function(e){isEmpty(e)||isEmpty(e.url)||isEmpty(e.emoticons)||(d.emotIconsAdd=e)}).always(function(){d.showEmotIconList()})},d.showEmotIconList=function(){isEmpty(d.emotIconsAdd)||isEmpty(d.emotIconsAdd.emoticons)||isEmpty(d.emotIconsAdd.url)||d.appendEmotIcons(d.emotIconsAdd),$.ajax({url:d.emoticons_url+"manifest.json"}).done(function(e){for(var t in e)d.appendEmotIcons(e[t],d.emoticons_url+t+".png")}),d.toggleEmotIconDiv(!0)},d.appendEmotIcons=function(e,t){var n,o,i,s,a={},r=0,l=56;if(e.hasOwnProperty("emoticons")){for(n in e.hasOwnProperty("url")&&(t=e.url),e.emoticons)(o=e.emoticons[n]).x+o.width>r&&(r=o.x+o.width,l=o.width);var u=28/12/l,c=function(e){return(e*u).toFixed(3)};for(n in e.emoticons)a[s=(o=e.emoticons[n]).x+","+o.y]||(a[s]=1,i=$("<span></span>").attr({"data-emotcode":unescapeHTML(n),tooltip:escapeHTML(n),class:"hoverhand"}).css({background:'url("'+t+'") -'+c(o.x)+"em -"+c(o.y)+"em/"+c(r)+"em",width:c(o.width)+"em",height:c(o.height)+"em"}),d.elements.emoticon_list_padding.append($("<span></span>").append(i)),tooltip.applyTooltip(i),i.on("click",d.postEmotIcon))}},d.postEmotIcon=function(e){chat.postBgImg(e.target.style.background,e.target.style.width,e.target.style.height,e.target.dataset.emotcode)},d.isViewer=function(e){return e.toUpperCase()!==d.user_name.toUpperCase()},d.constellation=new function(){var o=this;o.init=function(){o.chat_id=1},o.init(),o.connect=function(){if(d.timer.constellation_on_connect.stop(),d.timer.constellation_on_reconnect.stop(),window.WebSocket){void 0!==o.ws&&(o.ws.readyState<2&&o.ws.close(),o.ws=void 0),o.ws=new WebSocket("wss://constellation."+d.domain);var e=o.ws;e.onopen=function(){},e.onclose=function(){o.onDisconnected()},e.onerror=function(){},e.onmessage=function(e){var t=JSON.parse(e.data);switch(isEmpty(t.type)&&(t.type="error"),t.type){case"reply":break;case"event":if(!isEmpty(t.event)&&t.hasOwnProperty("data"))switch(t.event){case"live":o.onMessage(t.data);break;case"hello":o.onConnected()}}}}},o.disconnect=function(){void 0!==o.ws&&(o.ws.readyState<2&&o.ws.close(),o.ws=void 0)},o.onConnected=function(){if(void 0!==o.ws&&1===o.ws.readyState)return d.startUpdateAlert(),d.startFollowerAlert(),d.startHostAlert(),void d.startSubscriberAlert();d.timer.constellation_on_connect.isFinished()&&d.timer.constellation_on_connect.start()},o.onDisconnected=function(){!isEmpty(d.access_token)&&d.timer.constellation_on_reconnect.isFinished()&&d.timer.constellation_on_reconnect.start()},o.onReconnect=function(){o.init(),o.connect()},o.onMessage=function(e){if(e.hasOwnProperty("channel")&&e.hasOwnProperty("payload"))switch(lastPartString(e.channel,":")){case"update":d.onUpdate(e.payload);break;case"followed":d.onFollowed(e.payload);break;case"hosted":d.onHosted(e.payload);break;case"subscribed":d.onSubscibed(e.payload);break;case"resubscribed":d.onResub(e.payload)}},o.send=function(e,t){if(void 0!==o.ws){var n={type:"method",method:e,params:{events:t},id:++o.chat_id};o.ws.send(JSON.stringify(n))}},o.subscribe=function(e){isEmpty(d.channel_id)||o.send("livesubscribe",["channel:"+d.channel_id+":"+e])},o.unsubscribe=function(e){isEmpty(d.channel_id)||o.send("liveunsubscribe",["channel:"+d.channel_id+":"+e])}},d.startUpdateAlert=function(){d.constellation.subscribe("update")},d.stopUpdateAlert=function(){d.constellation.unsubscribe("update")},d.startFollowerAlert=function(){d.constellation.subscribe("followed")},d.stopFollowerAlert=function(){d.constellation.unsubscribe("followed")},d.startHostAlert=function(){d.constellation.subscribe("hosted")},d.stopHostAlert=function(){d.constellation.unsubscribe("hosted")},d.startSubscriberAlert=function(){d.constellation.subscribe("subscribed"),d.constellation.subscribe("resubscribed")},d.stopSubscriberAlert=function(){d.constellation.unsubscribe("subscribed"),d.constellation.unsubscribe("resubscribed")},d.onUpdate=function(e){e.hasOwnProperty("viewersCurrent")&&d.showViewerCounter(e.viewersCurrent),e.hasOwnProperty("numFollowers")&&d.showFollowerCounter(e.numFollowers),e.hasOwnProperty("online")&&(e.online?d.getStreamStatus(!1,!0):d.toggleOnlineStatus(!1))},d.onFollowed=function(e){e.following&&$doc.trigger("events:follower",{platform_name:d.name,username:e.user.username})},d.onHosted=function(e){var t=0;d.api("",{url:d.api_url+"chats/"+e.hosterId+"/users"}).done(function(e){t=isEmpty(e)?0:e.length}).always(function(){$doc.trigger("events:host",{platform_name:d.name,username:e.hoster.token,viewers:t})})},d.onSubscibed=function(e){$doc.trigger("events:subscriber",{platform_name:d.name,username:e.user.username})},d.onResub=function(e){$doc.trigger("events:resub",{platform_name:d.name,username:e.user.username,months:e.totalMonths})},d.initRoomState=function(){d.elements.slow_mode_set_button.on1("click",function(e){var t=d.elements.slow_mode_inputnumber[0],n=t.value;if(t.validity.rangeOverflow?n=t.max:(!t.validity.valid||t.value<0)&&(n=0),-1!==d.channel_id){var o="channel:slowchat";d.api("channels_preferences",{data:{"channel:slowchat":1e3*n},method:"POST"}).done(function(e){e&&e.hasOwnProperty(o)&&d.elements.slow_mode_inputnumber.val(e[o]/1e3)})}}),d.elements.slow_mode_inputnumber.on1("input",function(e){"0"===this.value&&(this.value="")}),d.elements.clear_chat_button.on1("click",function(e){d.isConnected()&&d.send("clearMessages",[])})},d.getRoomState=function(){-1!==d.channel_id&&d.api("channels_preferences").done(function(e){var t="channel:slowchat";!isEmpty(e)&&e.hasOwnProperty(t)&&d.elements.slow_mode_inputnumber.val(e[t]/1e3)})},d.getSubscribers=function(t){-1!==d.channel_id&&d.api("channels_details").done(function(e){t(!isEmpty(e)&&e.hasOwnProperty(numSubscribers)?e.numSubscribers:0)}).fail(function(){t(0)})},d.timer.connect=new Timer(d.connect,3e4),d.timer.get_game_list=new Timer(function(){d.get_game_list_queue&&d.getGameList()},3e3),d.timer.constellation_on_connect=new Timer(d.constellation.onConnected,1e3),d.timer.constellation_on_reconnect=new Timer(d.constellation.onReconnect,3e4),d.timer.send_message_queue=new Timer(d.processSendMessageQueue,500),d}var chat=new function(){var c=this;c.max_speech_char=9999,c.max_message_size=1e3,c.message_size=0,c.max_system_log_size=1e3,c.system_log_size=0,c.max_msg_sent_log=10,c.msg_sent_log=[],c.msg_current_index=-1,c.msg_edited=!1,c.current_sent_message_id=0,c.current_speech_id=-1,c.last_notify_speech_id=-1,c.scroll_lock=!0,c.scroll_timeout=!1,c.last_scroll_top=0,c.is_smooth_scroll_supported="scrollBehavior"in document.documentElement.style,c.chat_fade=!1,c.onload=function(){c.elements={message_div:$("#message-div"),messages_ul:$("#messages-ul"),system_msg_ul:$("#system-msg-ul"),chat_line_indicator_div:$("#chat-line-indicator"),send_button:$("#send-button"),send_textarea:$("#send-textarea"),chat_scroll_lock_button:$("#chat-scroll-lock-button"),personality_voice_checkbox:$("#personality-voice-checkbox"),max_speech_char_inputnumber:$("#max-speech-char-inputnumber")},c.self_username={},c.onMessage=function(e,t){var n=this;if(void 0!==config&&void 0!==config.user_groups&&(!t.sent||(t.sent.complete&&this.onMessageSentComplete(e,t.sent.id),!1!==t.sent.output))){var o=e;"object"==typeof e&&(e="general");var i=t.user["display-name"],s=t.user.hasOwnProperty("message-type")&&"whisper"===t.user["message-type"],a=-1,r=n.getUserVoiceOptions({name:isEmpty(t.user.username)?null:t.user.username,display_name:i,type:t.self?1:isEmpty(t.user.roles)?0:t.user.roles.hasOwnProperty("subscriber")?3:t.user.roles.hasOwnProperty("moderator")?2:0},e);if(r.group){var l=null,u=null,c=!t.hasOwnProperty("event")||!t.event,d=null;if(c&&(config.options.event.chat.hasOwnProperty("only_read_command")&&!1!==config.options.event.chat.only_read_command?custom_commands.commands.tts.enable&&null!==t.message.match(custom_commands.commands.tts.regex)?d=t.message.replace(custom_commands.commands.tts.regex,""):c=!1:c=!(l=null!==(u=n.checkUserCommand(t.message,t.self)))),!c||s&&!config.options.event.chat.speech_whisper)0<=n.last_notify_speech_id&&(a=n.last_notify_speech_id,n.last_notify_speech_id=-1);else{if(null===d&&(d=t.message),config.options.event.chat.hasOwnProperty("stop_read_command")&&!1!==config.options.event.chat.stop_read_command){var m=-1;custom_commands.commands.stop_read.enable&&-1!==(m=d.search(custom_commands.commands.stop_read.regex))&&(d=d.substring(0,m))}if(r.group.speech&&null!==(d=n.keyword_filter.execute(d))&&(d=n.trimMessage(trimSpaces(d))).length){var p=config.options.event[s?"whisper":"chat"].msg_format.replace(/\$message\$/gi,isEmpty(r.voice)?" "+d+" ":" !reset0 "+r.voice+" "+d+" !reset1 ").replace(/\$username\$/gi," !reset0 !o"+(r.name_voice_id<0?9999:r.name_voice_id)+" "+r.name_pronunce+" !reset1 ");a=speech_bot.speakMessage(p)}}if(user_group.playUserGroupAudio(r.group),r.group.show_message&&(!s||config.options.event.chat.display_whisper)&&(!t.self||(t.formatted_message=trimSpaces(t.formatted_message||escapeHTML(t.message)),0!==t.formatted_message.length))){var f=t.user.color||null;null===f&&(f=calcColorByName(i));var g=" style='color:"+f+";'",_="<span class='chat-line-time'>"+n.formatTimeMin()+"</span>",h="<span class='chat-line"+(t.user.hasOwnProperty("message-type")&&"action"===t.user["message-type"]?" chat-line-action":"")+(l?" chat-line-command":"")+(t.event?" chat-line-event":"")+"'"+g+" id='speech-id-"+a+"'>",v="<span class='chat-line-display-name'>"+i+(t.user.username&&t.user.username.toLowerCase()!==i.toLowerCase()?"<span class='chat-line-username'>("+t.user.username+")</span>":"")+"</span>",b="<span "+(t.sent?"id='msg-id-"+t.sent.id+"'":"")+"class='chat-line-message'>"+scemoji.parse(t.formatted_message||escapeHTML(t.message))+"</span>",y=t.user.hasOwnProperty("notify_msg")?"<span class='chat-line-notice'>"+t.user.notify_msg+"</span><br><span class='empty-service-icon service-logo'></span>":"",w=s?"<span class='chat-line-whisper'></span>":"";n.addMessage(o,_+h+y+(t.badge||"")+v+(t.badge_after||"")+w+"<span class='chat-line-colon'></span>"+b+"</span>"),l&&u(),n.current_speech_id===a&&-1!==a&&speech_bot.isSpeaking()&&n.showChatLineIndicator(a)}}}},c.getUserVoiceOptions=function(e,t){var n={},o=isEmpty(e.display_name)?e.name||"":e.display_name;n.group=null,isEmpty(e.name)||(n.group=user_group.getUserGroupByUserName(e.name,t)),n.group||isEmpty(e.display_name)||(n.group=user_group.getUserGroupByUserName(e.display_name,t)),n.group||isEmpty(e.type)||(n.group=user_group.getUserGroupByType(user_group.user_group_type_names[e.type],t));var i=user_group.getUserAdvOptionsByGroup(e,t,n.group);return n.voice=user_group.getVoiceByUserAdvOptions(i),isEmpty(n.voice)&&c.elements.personality_voice_checkbox[0].checked&&(n.voice=calcVoiceByName(o)+"99"),n.name_voice_id=isEmpty(i)?9999:user_group.getVoiceAdvOptionsVoice(i.username_voice,9999),9999===n.name_voice_id&&(1===e.type?0<=selfname_voice_index&&(n.name_voice_id=selfname_voice_index):0<=username_voice_index&&(n.name_voice_id=username_voice_index)),n.name_pronunce=c.keyword_filter.executeName(user_group.getNamePronByAdvOptions(i,1!==e.type||isEmpty(config.options.selfname_pron)?o:config.options.selfname_pron)),n},c.trimMessage=function(e){if(e.length<=c.max_speech_char)return e;var t=e.substring(0,c.max_speech_char+1).replace(/(\W|\d)([a-zA-Z]{0,20}$)/,"$1");return(t.length>c.max_speech_char||0===t.length)&&t.substring(0,c.max_speech_char),t},c.onMessageSentComplete=function(e,t){var n=$("#msg-id-"+t);if(n.length){var o=n.parent().parent();return!!o.hasClass("general-chat-li")&&(o.removeClass(e+"-msg-sending"),!0)}return!1},c.showChatLineIndicator=function(e){var t=$("#speech-id-"+e);if(t.length<=0||"hidden"===t.parent().css("visibility"))c.elements.chat_line_indicator_div.removeClass("show-indicator");else{t=t.parent()[0],c.elements.chat_line_indicator_div.attr("speech-id",e);var n="visible"===c.elements.chat_line_indicator_div.css("visibility");n||c.elements.chat_line_indicator_div.addClass("no-transition"),c.elements.chat_line_indicator_div.css({top:t.offsetTop+"px",height:t.offsetHeight+"px"}),n||(c.elements.chat_line_indicator_div[0].offsetHeight,c.elements.chat_line_indicator_div.removeClass("no-transition")),c.elements.chat_line_indicator_div.addClass("show-indicator")}},c.updateChatLineIndicator=function(){c.elements.chat_line_indicator_div.hasClass("show-indicator")&&c.showChatLineIndicator(c.elements.chat_line_indicator_div.attr("speech-id"))},c.elements.chat_line_indicator_div.on1(e_transitionend,function(e){c.elements.chat_line_indicator_div.hasClass("show-indicator")||c.elements.chat_line_indicator_div.css({top:0,height:0})}),c.onSpeechStart=function(e){c.current_speech_id=e,c.showChatLineIndicator(e)},c.onSpeechEnd=function(e){c.elements.chat_line_indicator_div.removeClass("show-indicator")},c.checkUserCommand=function(e,t){return config.options.event.chat.mute_command&&null!=e.match(/^\s*!/)?function(){}:t&&/^###/.test(e)?function(){}:null},c.sendHelpMessage=function(e){for(var t=speech_bot.getVoiceCommandHints(e),n=0,o=t.length;n<o;++n)c.sendMessage({msg:t[n]})},c.sendMessage=function(e){var t=!1;e.msg=trimSpacesLineBreaks(e.msg),e.id=c.current_sent_message_id;for(var n=$(".send-service-checkbox.service-connected:not(#send-service-checkbox-all)"),o=[],i=0;i<n.length;++i)n[i].checked&&o.push(n[i].id.replace(/send-service-checkbox-/,""));if(1<o.length){var s={user:{"display-name":"Me",subscriber:!1,"user-type":null,color:"red"},message:e.msg,self:!0,sent:{id:c.current_sent_message_id}};e.hasOwnProperty("event")&&(s.event=e.event),c.onMessage(o,s),e.output=!1}else e.output=!0;for(i=0;i<o.length;++i)t|=window[o[i]].sendMessage(e);return++c.current_sent_message_id,t},c.sendText=function(){c.elements.send_button.trigger("click")},c.addMessage=function(e,t,n){var o=this;o.checkMessageSize();var i=$("<li></li>");if("object"==typeof e){for(var s="",a="general-chat-li",r=0;r<e.length;++r)s+=service_tiny_icon[e[r]],a+=" "+e[r]+"-msg-sending";i.html(s+t).addClass(a)}else i.html(service_icon[e]+t).addClass(e+"-chat-li");return void 0!==n&&i.addClass(n),o.elements.messages_ul.append(i),tooltip.applyTooltip(i.find("[tooltip]")),o.scrollToBottom(),o.updateHideHButtonPos(),o.applyChatFade(i),i},c.formatTime=function(){var e=new Date;return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)},c.formatTimeMin=function(){var e=new Date;return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)},c.systemLogAdd=function(e,t){c.system_log_size>=c.max_system_log_size?$("#system-msg-ul>li:first-of-type").remove():c.system_log_size++,c.elements.system_msg_ul.append("<li>"+c.formatTime()+" - ["+(window.hasOwnProperty(e)?window[e].display_name:e)+"] "+t+"</li>")},c.systemLog=function(e,t,n,o){c.systemLogAdd(e,t);var i=c.addMessage(e,"<span class='chat-line-notice'><span class='chat-line-time'>"+c.formatTimeMin()+"</span>"+t+"</span>",o);config.options.hasOwnProperty(n)&&!config.options[n]&&i.replaceWith($("<p></p>").append(i.children()).prop("class",i.prop("class")))},c.systemMessage=function(e,t){c.systemLog(e,t,"display_system_msg","chat-line-system-msg")},c.noticeMessage=function(e,t){c.systemLog(e,t,"display_notice_msg","chat-line-notice-msg")},c.eventMessage=function(e,t){c.systemLog(e,t,"display_event_msg","chat-line-event-msg")},c.checkMessageSize=function(){++c.message_size>c.max_message_size&&(--c.message_size,c.removeMessage(c.elements.messages_ul.find("li:first-of-type")))},c.beginReduceMessageLines=function(){return $("#messages-ul>li").length%2==0},c.endReduceMessageLines=function(e){c.updateChatLineIndicator(),c.last_scroll_top=c.elements.messages_ul[0].scrollTop,c.checkScrollBottom(),e!==($("#messages-ul>li").length%2==0)&&c.elements.messages_ul.toggleClass("alt-row-color")},c.removeMessage=function(e){var t=c.beginReduceMessageLines();e.remove(),c.endReduceMessageLines(t)},c.clearMessage=function(e){var t=$("."+e+"-chat-li");c.message_size-=t.length,c.removeMessage(t)},c.addSelfUsername=function(e,t){c.self_username.hasOwnProperty(t)?-1===c.self_username[t].indexOf(e)&&c.self_username[t].push(e):c.self_username[t]=[e]},c.removeSelfUsername=function(e,t){c.self_username.hasOwnProperty(t)&&-1<(index=c.self_username[t].indexOf(e))&&(c.self_username[t].splice(index,1),0===c.self_username[t].length&&delete c.self_username[t])},c.clearSelfUsername=function(e){isEmpty(e.user_name)||c.removeSelfUsername(e.name,e.user_name),isEmpty(e.user_display_name)||c.removeSelfUsername(e.name,e.user_display_name)},c.onLogin=function(){setDefaultValue(config.options,"event",{}),setDefaultValue(config.options.event,"chat",{});var i=config.options.event.chat,e=function(t,e,n,o){setDefaultValue(i,t,n),e.prop("checked",o?!i[t]:i[t]),e.on1("change",function(e){i[t]=o?!this.checked:this.checked,updateConfig("options")})};e("display_whisper",$("#display-whisper-checkbox"),!0),e("speech_whisper",$("#speech-whisper-checkbox"),!1),e("mute_command",$("#read-command-checkbox"),!0,!0);var t=function(o,n,e){var i=config.options.event.chat;setDefaultValue(i,o,!1),n="#"+n;var s=$(n+"-input"),a=$(n+"-select"),t=$(n+"-select-div"),r=$(n+"-fieldset"),l=custom_commands.commands[e];s.on1("blur",function(e){if(!isEmpty(config.options)){updateConfigValue(["options","event","chat",o],this.value);var t=$(n+"-input-warning");switch(t.length&&(t.trigger("mouseout"),t.remove()),l.update(this.value)){case!1:ui.showInputWarning(s,"duplicated command");break;case-1:ui.showInputWarning(s,"cannot contain spaces")}}});var u=[{html:"off",index:0},{html:l.prefix+l.default_command,index:1},{html:"custom "+points.getCostHTML(o),selected_html:"custom",index:2}];select_list.initSelectList(t,a,u,function(e){if(!isEmpty(config.options)){var t=0!==e.index&&(1===e.index||l.default_command);if(typeof i[o]!=typeof t){var n="boolean"!=typeof t;if(!points.toggle(o,n,"activate custom command"))return void a.selectByIndexTrigger(1);r.toggleClass("show",n),n&&s.val(t),s.trigger("blur")}l.update(t),updateConfigValue(["options","event","chat",o],t)}}),update_config=!1;var c=i[o];i[o]=!1,a.selectByIndexTrigger(!1===c?0:!0===c?1:2),c&&!0!==c&&(s.val(c),s.trigger("blur")),update_config=!0};t("only_read_command","only-read-command","tts"),t("stop_read_command","stop-read-command","stop_read"),c.max_speech_char=i.hasOwnProperty("max_speech_char")?i.max_speech_char:9999,c.elements.max_speech_char_inputnumber.val(c.max_speech_char<9999?c.max_speech_char:""),c.elements.max_speech_char_inputnumber.on("blur",function(e){this.validity.valid||(this.value="");var t=parseInt(this.value);if(c.max_speech_char=!isNaN(t)&&t<9999&&0<t?t:9999,c.max_speech_char!==i.max_speech_char){if(9999===c.max_speech_char){if(!i.hasOwnProperty("max_speech_char"))return;delete i.max_speech_char}else i.max_speech_char=c.max_speech_char;updateConfig("options")}}),c.keyword_filter.onLogin()},c.elements.send_textarea.on1("keypress",function(e){if(13==e.keyCode)return c.sendText(),!1}),c.elements.send_textarea.on1("keydown",function(e){if(38===e.keyCode||40===e.keyCode){var t=c.send_text.getSelection();if(38===e.keyCode){if(0<t.start||c.msg_sent_log.length<=0)return;if(c.msg_edited){var n=c.elements.send_textarea.html();""!==n?(c.msg_sent_log.push(n),c.msg_sent_log.length>c.max_msg_sent_log&&c.msg_sent_log.shift(),c.msg_current_index=c.msg_sent_log.length-1):c.msg_current_index=c.msg_sent_log.length,c.msg_edited=!1}0<c.msg_current_index&&--c.msg_current_index,c.elements.send_textarea.html(c.msg_sent_log[c.msg_current_index]),c.send_text.setCaret(!0)}else if(40===e.keyCode){if(t.end<c.send_text.element.innerText.length)return;c.msg_current_index<c.msg_sent_log.length&&++c.msg_current_index,c.msg_current_index<c.msg_sent_log.length?(c.elements.send_textarea.html(c.msg_sent_log[c.msg_current_index]),c.send_text.setCaret(!1)):c.msg_edited||c.elements.send_textarea.html("")}}}),c.keydown_target_type_patt=/^(date|datetime|datetime-local|email|file|month|number|password|search|tel|text|time|url|week)$/i,window.addEventListener("keydown",function(e){if(!(e.ctrlKey||e.altKey||e.metaKey)){var t=e.target.tagName.toLowerCase();if("input"===t){if(c.keydown_target_type_patt.test(e.target.type))return}else if("textarea"===t||/\btextarea\b/.test(e.target.className))return;if(hotkey.isHotkeyPressed(e,!1))return!1;if(13===e.keyCode)c.sendText(),e.preventDefault();else if(8===e.keyCode)e.preventDefault();else if(!(32===e.keyCode||46<=e.keyCode&&e.keyCode<=90||96<=e.keyCode&&e.keyCode<=111||160<=e.keyCode&&e.keyCode<=176||188<=e.keyCode&&e.keyCode<=222))return;c.elements.send_textarea.focus()}}),c.elements.send_button.on1("click",function(e){var t=c.elements.send_textarea,o="",n=t.contents();return 0===n.length?o=t.text():n.each(function(e,t){if(3===t.nodeType)o+=t.textContent;else{var n=t.tagName.toUpperCase();"SPAN"===n?t.dataset.hasOwnProperty("emotcode")?o+=t.dataset.emotcode:o+=t.innerText:"IMG"!==n||isEmpty(t.alt)||(o+=" "+t.alt+" ")}}),""!==(o=o.trim())&&c.sendMessage({msg:o})&&(c.msg_sent_log.push(t.html()),c.msg_sent_log.length>c.max_msg_sent_log&&c.msg_sent_log.shift(),c.msg_current_index=c.msg_sent_log.length-1,t.empty()),t.focus(),!1}),c.elements.send_textarea.on1("input",function(e){c.msg_edited=!0,c.msg_current_index=c.msg_sent_log.length-1}),c.elements.send_textarea.on1("paste",function(e){var t="";return e.originalEvent.clipboardData?t=e.originalEvent.clipboardData.getData("text/plain"):window.clipboardData&&(t=window.clipboardData.getData("Text")),t&&c.send_text.replaceSelected(t),e.preventDefault(),!1}),c.elements.send_textarea.on1("drop",function(e){var t=e.originalEvent.dataTransfer.getData("text/plain");return t&&c.send_text.replaceSelected(t),e.preventDefault(),!1}),c.send_text=new function(){var a=this;a.element=c.elements.send_textarea[0],a.doc=a.element.ownerDocument||a.element.document,a.win=a.doc.defaultView||a.doc.parentWindow,a.current_sel=!1,a.setCaret=function(e){var t,n;a.doc.createRange&&("object"==typeof e?n=e:((n=a.doc.createRange()).selectNodeContents(a.element),n.collapse(e)),(t=a.win.getSelection()).removeAllRanges(),t.addRange(n))},a.replaceSelected=function(e){var t,n;c.elements.send_textarea.focus(),a.msg_edited=!0,e="string"==typeof e?document.createTextNode(e):e.cloneNode(!0),a.win.getSelection?(t=a.win.getSelection()).rangeCount&&((n=t.getRangeAt(0)).deleteContents(),n.insertNode(e),n.collapse(!1),a.element.focus()):a.doc.selection&&a.doc.selection.createRange&&((n=a.doc.selection.createRange()).text=e)},a.getSelection=function(){var e,t={start:0,end:0};if(void 0!==a.win.getSelection){if(0<(e=a.win.getSelection()).rangeCount){var n=a.win.getSelection().getRangeAt(0),o=n.cloneRange();o.selectNodeContents(a.element),o.setEnd(n.startContainer,n.startOffset),t.start=o.toString().length,o.setEnd(n.endContainer,n.endOffset),t.end=o.toString().length}}else if((e=a.doc.selection)&&"Control"!==e.type){var i=e.createRange(),s=a.doc.body.createTextRange();s.moveToElementText(a.element),s.setEndPoint("EndToStart",i),t.start=s.text.length,s.setEndPoint("EndToEnd",i),t.end=s.text.length}return t}},c.postImg=function(e){c.send_text.replaceSelected(e)},c.postEmotIcon=function(e){c.send_text.replaceSelected($("<img>").attr({src:e.style.backgroundImage.replace(/(^url\(.|.\)$)/g,""),alt:e.dataset.emotcode})[0])},c.postBgImg=function(e,t,n,o){c.send_text.replaceSelected($("<img>").attr({alt:o,src:"data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}).css({background:e,width:t,height:n,"min-width":t,"min-height":n,"max-width":t,"max-height":n})[0])},c.applyChatFade=function(t){var n=this;!1!==n.chat_fade&&(t[0].timeout=setTimeout(function(){t.addClass("removing"),t.off(e_transitionend),t.one(e_transitionend,function(e){n.removeMessage(t),t=null})},1e3*n.chat_fade))},c.setChatFade=function(e){var t=this;t.chat_fade=e,$("#messages-ul>li, #messages-ul>p").each(function(){this.hasOwnProperty("timeout")&&!1!==this.timeout&&(clearTimeout(this.timeout),this.timeout=!1),t.applyChatFade($(this))})},c.elements.send_textarea.on1("blur",function(e){void 0!==c.send_text.win.getSelection?0<c.send_text.win.getSelection().rangeCount&&(c.send_text.current_sel=c.send_text.win.getSelection().getRangeAt(0)):c.send_text.current_sel=!1}),c.elements.chat_scroll_lock_button.on1("click",function(e){c.scrollLock(!0)}),c.scrollToBottom=function(e){if(c.scroll_lock){var t=c.elements.messages_ul[0];c.is_smooth_scroll_supported&&!e?t.scroll({top:t.scrollHeight,behavior:"smooth"}):t.scrollTop=t.scrollHeight}},c.scrollLock=function(e){c.scroll_lock!==e&&((c.scroll_lock=e)||0!==$("#chat-scroll-lock-button-style").length||$("head").append("<style id='chat-scroll-lock-button-style'>#chat-scroll-lock-button{right:"+(5+c.elements.messages_ul[0].offsetWidth-c.elements.messages_ul[0].clientWidth)+"px !important;}</style>"),c.elements.chat_scroll_lock_button.toggleClass("show",!e),c.scrollToBottom())},c.checkScrollBottom=function(){c.updateHideHButtonPos();var e=c.elements.messages_ul[0];return Math.ceil(e.scrollTop+e.clientHeight)>=e.scrollHeight&&(c.scrollLock(!0),!0)},c.onScrollEnd=function(){c.scroll_timeout=!1;c.elements.messages_ul[0];c.checkScrollBottom()||c.scrollToBottom()},c.elements.messages_ul.on1("scroll",function(e){!1!==c.scroll_timeout&&clearTimeout(c.scroll_timeout),c.scroll_timeout=setTimeout(c.onScrollEnd,200);var t=c.elements.messages_ul[0];c.last_scroll_top>t.scrollTop&&Math.ceil(t.scrollTop+t.clientHeight)<t.scrollHeight&&(void 0!==config&&config.options&&config.options.always_scroll_lock?(c.scrollLock(!0),c.scrollToBottom()):c.scrollLock(!1)),c.last_scroll_top=t.scrollTop}),c.updateHideHButtonPos=function(){elements.hide_h_button.css({right:c.elements.messages_ul[0].offsetWidth-c.elements.messages_ul[0].clientWidth})},$win.on("resize.chat_scroll",function(e){c.last_scroll_top=c.elements.messages_ul[0].scrollTop,c.elements.messages_ul.trigger("scroll"),c.scrollToBottom(!0)}),elements.chat_div.on1(e_transitionend,function(e){"height"===e.originalEvent.propertyName&&c.scrollToBottom()}),elements.chatter_names_div.on1(e_transitionend,function(e){c.scrollToBottom(!0)}),c.keyword_filter=new function(){var r=this;r.mute_emoji_patt=/\ud83d[\udc68-\udc69](?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92])|(?:\ud83c[\udfcb\udfcc]|\ud83d\udd75|\u26f9)(?:\ufe0f|\ud83c[\udffb-\udfff])\u200d[\u2640\u2642]\ufe0f|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd37-\udd39\udd3d\udd3e\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f|(?:[\u0023\u002a\u0030-\u0039])\ufe0f?\u20e3|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddd1-\udddd]|[\u270a\u270b])(?:\ud83c[\udffb-\udfff]|)|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud800\udc00|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\udeeb\udeec\udef4-\udef8]|\ud83e[\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd40-\udd45\udd47-\udd4c\udd50-\udd6b\udd80-\udd97\uddc0\uddd0\uddde-\udde6]|[\u23e9-\u23ec\u23f0\u23f3\u2640\u2642\u2695\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a]|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u00a9\u00ae\u203c\u2049\u2122\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2694\u2696\u2697\u2699\u269b\u269c\u26a0\u26a1\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))/g,r.mute_number_patt=/(\d|[\uff10-\uff19])/g,r.mute_symbol_patt=/[^A-Za-z\d\s\u00c0-\u00f6\u00f8-\u01bf\u01c4-\u02af\u0370-\u1fff\u2c00-\u2dff\u2e80-\u2fdf\u3040-\u31ff\u3400-\u4dbf\u4e00-\ua6ff\ua720-\udfff\uf900-\ufe0f\ufe70-\ufeff]/g,r.init=function(){var e=function(a){r["mute_"+a+"_patt"]=null,r["mute_"+a+"_hash"]={},elements["keyword_filter_add_mute_"+a+"_button"].on1("click",function(e){var t=!isTitleShow(elements["keyword_filter_add_mute_"+a+"_button_dropdown_title"]);hideAllControlPanelSubMenu(),t&&(elements["keyword_filter_add_mute_"+a+"_dialog_words_input"].val(""),showMenu(elements["keyword_filter_add_mute_"+a+"_button_dropdown_title"],elements["keyword_filter_add_mute_"+a+"_dialog"],!0)),cancelEvent(e)}),elements["keyword_filter_add_mute_"+a+"_dialog_add_button"].on1("click",function(e){var t=elements["keyword_filter_add_mute_"+a+"_dialog_words_input"].val().split(",");if(t.length){setDefaultValue(config.options,"keyword_filter",{}),setDefaultValue(config.options.keyword_filter,"mute_"+a+"_list",[]);for(var n=config.options.keyword_filter["mute_"+a+"_list"],o=r["mute_"+a+"_hash"],i=0;i<t.length;++i)t[i]={text:t[i].trim().toLowerCase().substring(0,50)},!t[i].text.length||o[t[i].text]?t.splice(i--,1):(n.push(t[i]),o[t[i].text]=1);t.length&&(updateConfig("options"),r.addKeywordsToList(t,a)),hideMenu(elements["keyword_filter_add_mute_"+a+"_button_dropdown_title"],elements["keyword_filter_add_mute_"+a+"_dialog"])}}),elements["keyword_filter_add_mute_"+a+"_dialog"].on1("click",cancelEvent),elements["keyword_filter_remove_mute_"+a+"_dialog_yes_button"].on1("click",function(e){var t=this.data_obj,n="mute_"+a+"_list";if(hideAllControlPanelSubMenu(),config.options.hasOwnProperty("keyword_filter")&&!isEmpty(config.options.keyword_filter[n])){for(var o=t.find(".keyword-filter-mute-"+a+"-item-text").text(),i=config.options.keyword_filter[n],s=0;s<i.length;++s)if(i[s].text===o){delete r["mute_"+a+"_hash"][i[s].text],i.splice(s,1),updateConfig("options");break}r.updatePatt(a)}t.remove(),points.toggle("keyword_filter_mute_keyword",!1),r.updateTabHeight(),cancelEvent(e)}),elements["keyword_filter_remove_mute_"+a+"_dialog_no_button"].on1("click",function(e){hideAllControlPanelSubMenu()}),elements["keyword_filter_remove_mute_"+a+"_dialog"].on1("click",cancelEvent),elements["keyword_filter_mute_"+a+"_list_toggle"].on1("click",function(e){var t=$(this),n=!t.hasClass("toggled"),o="mute_"+a+"_list_toggle";setDefaultValue(config.options,"keyword_filter",{}),config.options.keyword_filter[o]!==n&&(config.options.keyword_filter[o]=n,updateConfig("options")),t.toggleClass("toggled"),elements["keyword_filter_mute_"+a+"_container"].toggleClass("toggled",n)})};e("word"),e("message")},r.init(),r.onLogin=function(){var e=function(t,e){var n=elements["keyword_filter_read_"+t+"_checkbox"],o=!(config.options.hasOwnProperty("keyword_filter")&&config.options.keyword_filter.hasOwnProperty("mute_"+t)?config.options.keyword_filter["mute_"+t]:e);r["mute_"+t]=!(n[0].checked=o),n.on1("change",function(e){setDefaultValue(config.options,"keyword_filter",{}),config.options.keyword_filter["mute_"+t]=!this.checked,updateConfig("options")})};e("emoticons",!1),e("numbers",!1),e("symbols",!1),e("name_numbers",!1),e("name_symbols",!1);var t=function(e){r["mute_"+e+"_patt"]=null;var t=r["mute_"+e+"_hash"]={};if(elements["keyword_filter_mute_"+e+"_list_ul"].empty(),config.options.hasOwnProperty("keyword_filter")&&!isEmpty(config.options.keyword_filter["mute_"+e+"_list"])){for(var n=config.options.keyword_filter["mute_"+e+"_list"],o=0;o<n.length;++o)t[n[o].text]=1;r.addKeywordsToList(n,e)}var i=!!config.options.hasOwnProperty("keyword_filter")&&config.options.keyword_filter["mute_"+e+"_list_toggle"];elements["keyword_filter_mute_"+e+"_list_toggle"].toggleClass("toggled",i),elements["keyword_filter_mute_"+e+"_container"].toggleClass("toggled",i)};t("word"),t("message")},r.updateTabHeight=function(){$body[0].offsetHeight,updateTabHeight("tabs1-3-div")},r.addKeywordsToList=function(e,i){if(e.length){var t,n="",o="mute_"+i+"_list";for(t=0;t<e.length;++t){if(!points.toggle("keyword_filter_mute_keyword",!0,"add more keywords")){config.options.keyword_filter[o].splice(t-e.length),e.splice(t-e.length),updateConfig("options");break}n+="<li class='keyword-filter-mute-"+i+"-item'><div class='keyword-filter-mute-"+i+"-item-text'>"+e[t].text+"</div><div class='keyword-filter-mute-"+i+"-item-remove-button dropdown-title-div'><div class='dropdown-title'><i class='fas fa-times' aria-hidden='true'></i></div></div></li>"}elements["keyword_filter_mute_"+i+"_list_ul"].append(n=$(n));var s=n.find(".keyword-filter-mute-"+i+"-item-remove-button");s.on("click",function(e){var t=$(this),n=t.find(".dropdown-title"),o=!isTitleShow(n);hideAllControlPanelSubMenu(),o&&(elements["keyword_filter_remove_mute_"+i+"_dialog_yes_button"][0].data_obj=t.parent(),showMenu(n,elements["keyword_filter_remove_mute_"+i+"_dialog"],!0)),cancelEvent(e)}),tooltip.applyTooltip(s,"Remove"),r.updatePatt(i),r.updateTabHeight()}},r.updatePatt=function(e){var t="mute_"+e+"_list",n=config.options.hasOwnProperty("keyword_filter")&&config.options.keyword_filter.hasOwnProperty(t)?config.options.keyword_filter[t]:null,o=[];if(n)for(var i=0;i<n.length;++i)o.push(escapeRegex(n[i].text));r["mute_"+e+"_patt"]=isEmpty(o)?null:"word"===e?new RegExp("("+o.join("|")+")(?=\\W|$)","gi"):new RegExp("("+o.join("|")+")","i")},r.setMuteListToggle=function(e,t){var n="mute_"+t+"_list_toggle";setDefaultValue(config.options,"keyword_filter",{}),config.options.keyword_filter.hasOwnProperty(n)&&config.options.keyword_filter[n]===e||(config.options.keyword_filter[n]=e,updateConfig("options")),elements["keyword_filter_mute_"+t+"_list_toggle"].toggleClass("toggled",e)},r.w_patt=/(\W|\d)/,r.wordReplacer=function(e,t,n,o){return 0===n||r.w_patt.test(o[n-1])?"":e},r.isMuteEmoticons=function(){return!elements.keyword_filter_read_emoticons_checkbox[0].checked},r.execute=function(e){if(config.options.hasOwnProperty("keyword_filter")){if(config.options.keyword_filter.mute_message_list_toggle&&r.mute_message_patt&&r.mute_message_patt.test(e))return null;config.options.keyword_filter.mute_word_list_toggle&&r.mute_word_patt&&(e=e.replace(r.mute_word_patt,r.wordReplacer)),elements.keyword_filter_read_emoticons_checkbox[0].checked||(e=e.replace(r.mute_emoji_patt," ")),elements.keyword_filter_read_numbers_checkbox[0].checked||(e=e.replace(r.mute_number_patt," ")),elements.keyword_filter_read_symbols_checkbox[0].checked||(e=e.replace(r.mute_symbol_patt," ")),e=trimSpaces(e)}return e.length?e:null},r.executeName=function(e){return e?(config.options.hasOwnProperty("keyword_filter")&&(elements.keyword_filter_read_name_numbers_checkbox[0].checked||(e=e.replace(r.mute_number_patt," ")),elements.keyword_filter_read_name_symbols_checkbox[0].checked||(e=e.replace(r.mute_symbol_patt," ")),e=trimSpaces(e)),e):""}},c.elements.scemoji_container=$("#scemoji-container"),scemoji.init({img:"pic/scemoji.5007a3bc.png"}),scemoji.buildMenu(c.elements.scemoji_container[0]),tooltip.applyTooltipAll(c.elements.scemoji_container);var l=/(|||)/,u=function(e){return e.substring(0,4)+""+e.substring(4)};c.scemojiReplacer=function(e,t,n,o,i){var s=scemoji.toPercentPos(t,n),a=scemoji.config,r=a.icon_size+a.icon_unit;return c.send_text.replaceSelected($("<img>").attr({alt:e.replace(l,u),src:"data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}).css({"background-image":"url('"+a.img+"')","background-size":a.img_bg_size+a.icon_unit,"background-position":s.x+"% "+s.y+"%",width:r,height:r,"min-width":r,"min-height":r,"max-width":r,"max-height":r})[0]),null},scemoji.on("pick",function(e){scemoji.parse(e.detail.emoji,c.scemojiReplacer)})}},_escape_HTML_container=document.createElement("textarea");function escapeHTML(e){return _escape_HTML_container.textContent=e,_escape_HTML_container.innerHTML.replace(/&nbsp;/g," ")}function unescapeHTML(e){return _escape_HTML_container.innerHTML=e,_escape_HTML_container.textContent}var _escape_regex_patt=/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,_escape_regex_replacer="\\$&";function escapeRegex(e){return e.replace(_escape_regex_patt,_escape_regex_replacer)}function trimSpaces(e){return e.replace(/\s\s+/g," ").trim()}function trimSpacesLineBreaks(e){return e.replace(/(\s\s+)|[\r\n]/g," ").trim()}function stringSlice(e,t,n){if(e.length<=t)n(e,!0);else for(var o,i;;){if((o=e.substring(0,t)).length===e.length)return void n(o,!0);-1!==(i=o.lastIndexOf(" "))?(n(o.substring(0,i),!1),e=e.substring(i+1)):(n(o,!1),e=e.substring(t))}}function wordWrap(e,t,n){if(e.length<=t)n(e,!0);else{for(var o=(e=e.trim().replace(/\s+/g," ")).split(/\b/),i="",s=0;s<o.length;++s){if(o[s].length>t)for(n(i),i="";n(o[s].substring(0,t)),o[s]=o[s].substring(t),o[s].length>t;);i.length+o[s].length>t&&(n(i),i=""),i+=o[s]}if(i.length>t)for(;n(i.substring(0,t)),(i=i.substring(t)).length>t;);n(i,!0)}}function isEmpty(e){var t=typeof e;if("number"===t||"boolean"===t)return!1;if("undefined"===t||null===e)return!0;if(void 0!==e.length)return 0===e.length;for(var n in e)if(e.hasOwnProperty(n)||!isEmpty(n))return!1;return!0}function isFunction(e){return"function"==typeof e}function safeCall(e,t){if(isFunction(e)){for(var n=[],o=2;o<arguments.length;++o)n.push(arguments[o]);return e.apply(void 0!==t?t:null,n)}}function emptyObject(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]}function defaultArg(e,t){return void 0===e?t:e}function findInArray(e,t){for(var n=0,o=e.length;n<o;++n)if(t(e[n]))return e[n];return null}function findIndexArray(e,t){for(var n=0,o=e.length;n<o;++n)if(t(e[n]))return n;return-1}function firstPartString(e,t){var n=e.indexOf(t);return 0<=n?e.substring(n):""}function lastPartString(e,t){var n=e.lastIndexOf(t)+1;return 0<n?e.substring(n):""}function setCookie(e,t,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var i="expires="+o.toGMTString();document.cookie=e+"="+encodeURIComponent(t)+"; "+i}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}}function deleteCookie(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain="+location.hostname,document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/",document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;"}function getByteLen(e){for(var t=0,n=0,o=e.length;n<o;n++){var i=e.charCodeAt(n);t+=i<128?1:i<2048?2:i<65536?3:i<1<<21?4:i<1<<26?5:i<1<<31?6:Number.NaN}return t}$.fn.on1=function(e,t,n){void 0===n?this.off(e).on(e,t):this.off(e,t).on(e,t,n)};var Timer=function(e,t){this._timer_id=!1,this._start_time=0,this._delay="number"==typeof e?e:t,this._callback=e,this._remaining=this._delay};function compareNames(e,t){return e.toUpperCase()===t.toUpperCase()}function setDefaultValue(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}Timer.prototype.start=function(e,t){"function"==typeof e?this._callback=e:"number"==typeof e&&(this._delay=e),"number"==typeof t&&(this._delay=t),this._remaining=this._delay,this.stop(),this._timer_id=null,this.resume()},Timer.prototype.stop=function(){!1!==this._timer_id&&(clearTimeout(this._timer_id),this._timer_id=!1)},Timer.prototype.pause=function(){!1!==this._timer_id&&(clearTimeout(this._timer_id),this._remaining-=Date.now()-this._start_time)},Timer.prototype.resume=function(){return!1!==this._timer_id&&(this._start_time=Date.now(),clearTimeout(this._timer_id),this._timer_id=setTimeout(function(){this._timer_id=!1,this._callback()}.bind(this),this._remaining),!0)},Timer.prototype.restart=function(){this.start()},Timer.prototype.isFinished=function(){return!1===this._timer_id};var custom_commands=new function(){var r=this,l=function(e,t,n,o,i,s){this.prefix=e,this.default_command=t,this.command=t,this.patt1=n+escapeRegex(e),this.patt2=o,this.modifier=i,this.regex=null,this.enable=s,this.update=function(e){if(!0===e)e=this.default_command;else{if(!1===e)return!(this.enable=!1);if(-1!==e.indexOf(" "))return this.enable=!1,-1;for(var t in r.commands)if(r.commands[t]!==this&&r.commands[t].regex.test(this.prefix+e))return this.enable=!1}return this.command=e,this.regex=new RegExp(this.patt1+escapeRegex(this.command)+this.patt2,this.modifier),this.enable=!0},this.update(t)};r.add=function(e,t,n,o,i,s,a){r.commands[e]=new l(t,n,o,i,s,a)},r.commands={},r.add("p","!","p","(^|\\s*)","\\d(\\s+|$)","i",!0),r.add("v","!","v","(^|\\s*)","\\d{3,5}(\\s+|$)","i",!0),r.add("s","!","s","(^|\\s*)","\\d{1,8}(\\s+|$)","i",!0),r.add("reset","!","reset","(^|\\s*)","\\d{0,1}(\\s+|$)","i",!0),r.add("tts","!","speak","^\\s*","(\\s+|$)","i",!1),r.add("stop_read","","###","(^|\\s*)","","i",!1)},elements=new function(){var t=this;t.ele_names=["select-list-ul","loading-div","app-menu-bugreport","emoticon-button","emoticon-list-tabs","emoji-list-tabs","voice-select-div","voice-select","selfname-voice-select-div","selfname-voice-select","username-voice-select-div","username-voice-select","selfname-pronunciation-inputtext","select-audio-external-menu-div","select-audio-external-link-inputtext","select-audio-external-set-button","select-audio-inputfile","donate-button","speech-checkbox","pause-speech-button","chat-div","user-list-div","status-div","speech-status-div","live-info-div","send-div","chatter-list-div","chatter-names-div","hide-h-button","hide-v-button","hide-h-button>i","hide-v-button>i","keyword-filter-read-emoticons-checkbox","keyword-filter-read-numbers-checkbox","keyword-filter-read-symbols-checkbox","keyword-filter-read-name-numbers-checkbox","keyword-filter-read-name-symbols-checkbox","keyword-filter-mute-word-container","keyword-filter-mute-word-list-toggle","keyword-filter-add-mute-word-button","keyword-filter-add-mute-word-button-dropdown-title","keyword-filter-add-mute-word-dialog","keyword-filter-add-mute-word-dialog-words-input","keyword-filter-add-mute-word-dialog-add-button","keyword-filter-remove-mute-word-dialog","keyword-filter-remove-mute-word-dialog-yes-button","keyword-filter-remove-mute-word-dialog-no-button","keyword-filter-mute-word-list-ul","keyword-filter-mute-message-container","keyword-filter-mute-message-list-toggle","keyword-filter-add-mute-message-button","keyword-filter-add-mute-message-button-dropdown-title","keyword-filter-add-mute-message-dialog","keyword-filter-add-mute-message-dialog-words-input","keyword-filter-add-mute-message-dialog-add-button","keyword-filter-remove-mute-message-dialog","keyword-filter-remove-mute-message-dialog-yes-button","keyword-filter-remove-mute-message-dialog-no-button","keyword-filter-mute-message-list-ul"],t.onload=function(){for(var e=0;e<t.ele_names.length;++e)t[t.ele_names[e].replace(/[->]/g,"_")]=$("#"+t.ele_names[e]);delete t.ele_names}},errorlog=new function(){var s=this;s.max_size=100,s.list=[],s.index=0,s.ajax_error_count=0,s.version_str="beta.speechchat.com"===location.hostname?" beta":"",window.addEventListener("error",function(e){e.filename&&e.filename.length&&(s.onerror(e.message,e.filename,e.lineno,e.colno,e.error),"function"==typeof ga&&ga("send","event","Exceptions"+s.version_str,"JS errors",e.message+" > "+e.filename+":"+e.lineno+":"+e.colno+' > UA: "'+navigator.userAgent+'"'))}),$(document).ajaxError(function(e,t,n,o){10<++s.ajax_error_count||void 0===t||!t.responseText&&!t.status||void 0!==n&&"string"==typeof n.url&&n.url.match(/\/manifest.light2$/)||"function"==typeof ga&&ga("send","event","Exceptions"+s.version_str,"AJAX errors",(void 0!==n?(n.url?'URL: "'+n.url+'"':"")+(n.type?", "+n.type:""):"")+(void 0!==t?(t.responseText?' > Response: "'+t.responseText:"")+(t.status?" > status: "+t.status:""):"")+' > UA: "'+navigator.userAgent+'"')}),s.serialize=function(){for(var e,t=0,n="";t<s.list.length;t++)e=s.list[t],n.length&&"\n\n"!==n.slice(-2)&&(n+="\n"===n.slice(-1)?"\n":"\n\n"),n+=e.index+": "+(e.error&&"string"==typeof e.error.stack?e.error.stack:e.msg+"\n"+e.url+":"+e.line+":"+e.col);return n},s.updateButton=function(e){e&&(s.list=[]);var t=$(".error-log-count");t&&(s.list.length?t.html(s.list.length).addClass("show"):t.html("").removeClass("show"))},s.onerror=function(e,t,n,o,i){s.list.length>s.max_size&&s.shift(),s.list.push({index:++s.index,msg:e||"",url:t||"",line:n||0,col:o||0,error:i||null}),s.updateButton()},s.log=function(e){s.onerror(e.message,e.fileName,e.lineNumber,e.columnNumber,e)},s.viewLog=function(){ui.createDCDialog({html:'<h2 id="error-log-title">Error log</h2><div id="error-log-div"><pre>'+(escapeHTML(s.serialize())||"No Error Found.")+'</pre></div><button class="dcdialog-close-button">OK</button>',css:{width:450,height:"auto"},fullscreen:!0})},s.onload=function(){s.updateButton(),elements.app_menu_bugreport.on("click",function(e){ui.createDCDialog({html:'<h2 id="bug-report-title">Bug report</h2><input id="bug-report-email" maxlength="60" placeholder="Email (required)"><br><textarea id="bug-report-textarea" class="char-counter" maxlength="500" placeholder="Description (optional)"></textarea><p class="bug-report-msg">Send the error log along with your current settings to help us improve this software.</p><button class="error-log-view-button">View error log<span class="error-log-count"></span></button><button class="bug-report-send-button">Send</button>',css:{width:370,height:"auto"},fullscreen:!0,done:function(e){s.updateButton(),ui.textareaCharCounterSetup($("#bug-report-textarea"));var i=e.find(".error-log-view-button");i.on("click",function(e){s.viewLog()}),e.find(".bug-report-send-button").on("click",function(e){var t=$("#bug-report-email").val();if(t){var n=$("#bug-report-textarea").val();if(!(n.length<10)||s.list.length){this.disabled=!0,i.disabled=!0;var o="";try{o=JSON.stringify(config)}catch(e){}ui.createDCDialog({ajax:{url:"send_error_log.php",data:{email:t,bug_report:n,error_log:s.serialize(),config:o},method:"post"},css:{width:300,height:80},fullscreen:!0,done:function(){s.updateButton(!0)}})}}})}}),cancelEvent(e)})}},events=new function(){var r=this;r.onLoad=function(){r.message_format={chat:"$username$ said $message$",whisper:"$username$ whispered $message$",viewer:"$username$ , welcome to my channel!",follower:"$username$ , thanks for following!",host:"$username$ is now hosting you for $viewers$ viewers!",raid:"$viewers$ raiders from $username$ have joined.",subscriber:"$username$ , thanks for subscribing!",subanniversary:"$username$ , thanks for subscribing for $months$ months!"},r.follower_id_list={twitch:[],youtube:[]},r.max_follower_id_list=100,r.notification_audio={},r.elements={viewer_alert_post_message_checkbox:$("#viewer-alert-post-message-checkbox"),viewer_alert_speak_message_checkbox:$("#viewer-alert-speak-message-checkbox"),follower_alert_post_message_checkbox:$("#follower-alert-post-message-checkbox"),follower_alert_speak_message_checkbox:$("#follower-alert-speak-message-checkbox"),follower_audio_inputtext:$("#follower-audio-inputtext"),host_alert_post_message_checkbox:$("#host-alert-post-message-checkbox"),host_alert_speak_message_checkbox:$("#host-alert-speak-message-checkbox"),raid_alert_post_message_checkbox:$("#raid-alert-post-message-checkbox"),raid_alert_speak_message_checkbox:$("#raid-alert-speak-message-checkbox"),subscriber_alert_post_message_checkbox:$("#subscriber-alert-post-message-checkbox"),subscriber_alert_speak_message_checkbox:$("#subscriber-alert-speak-message-checkbox")}},r.onLogin=function(){isEmpty(config.options.event)&&(config.options.event={});var e=function(e){isEmpty(config.options.event[e])&&(config.options.event[e]={})};e("chat"),e("whisper"),e("viewer"),e("follower"),e("host"),e("raid"),e("subscriber"),e("subanniversary"),r.initNotifies(),r.initAudios(),r.initMessageFormats()},r.initNotifies=function(){var o=function(t,n,e,o){isEmpty(t[n])&&(t[n]=!1),e[0].checked=t[n],e.on1("change",function(e){t[n]=this.checked,updateConfig("options"),safeCall(o,null,this.checked)})},e=function(e,t){var n=config.options.event[e];isEmpty(n.notify)||(n.post_msg=n.speak_msg=n.notify,delete n.notify),o(n,"post_msg",$("#"+e+"-alert-post-message-checkbox"),t),o(n,"speak_msg",$("#"+e+"-alert-speak-message-checkbox"),t)};e("viewer"),e("follower",r.setFollowerAlert),e("subscriber"),e("host"),e("raid")},r.initAudios=function(){var e=function(t,e){initAudioElement({cfg:config.options.event[t],id:t,setAudio:function(e){r.notification_audio[t]=e},getAudio:function(){return r.notification_audio[t]},getParents:function(){return null},updateConfigAudio:function(){updateConfig("options")},callback:function(){updateTabHeight("tabs1-4-div"),safeCall(e)}})};e("viewer"),e("follower",r.setFollowerAlert),e("host"),e("raid"),e("subscriber"),updateTabHeight("tabs1-4-div")},r.initMessageFormats=function(){var e=function(e){config.options||(config.options={}),config.options.event||(config.options.event={}),config.options.event[e]||(config.options.event[e]={});var t=config.options.event[e];isEmpty(t.msg_format)&&(t.msg_format=r.message_format[e]);var n=$("#"+e+"-message-format-inputtext");n.val(t.msg_format),n.on1("change",function(e){t.msg_format=this.value,updateConfig("options")})};e("chat"),e("whisper"),e("viewer"),e("follower"),e("host"),e("raid"),e("subscriber"),e("subanniversary")},r.getFormatMessage=function(e){return config.options&&config.options.event&&config.options.event[e]&&config.options.event[e].msg_format?config.options.event[e].msg_format:""},r.formatVoiceMessageUsername=function(e,t,n){var o=chat.getUserVoiceOptions(t,n);return r.getFormatMessage(e).replace(/\$username\$/gi," !o"+o.name_voice_id+" "+o.name_pronunce+" !reset ")},r.formatMessageUsername=function(e,t){return r.getFormatMessage(e).replace(/\$username\$/gi,t)},r.viewerAlert=function(e,t){r.playSound("viewer");var n=isEmpty(t.full_name)?isEmpty(t.display_name)?t.id:t.display_name:t.full_name;chat.eventMessage(e,n+" has joined the channel."),r.elements.viewer_alert_speak_message_checkbox.prop("checked")&&(chat.last_notify_speech_id=speech_bot.speakImportantMessage(r.formatVoiceMessageUsername("viewer",{name:t.id,display_name:isEmpty(t.display_name)?null:t.display_name},e).replace(/\$viewers\$/gi,window[e].viewers))),r.elements.viewer_alert_post_message_checkbox.prop("checked")&&chat.sendMessage({msg:r.formatMessageUsername("viewer",n).replace(/\$viewers\$/gi,window[e].viewers),event:!0})},r.setFollowerAlert=function(){r.elements.follower_alert_speak_message_checkbox.prop("checked")||r.elements.follower_alert_post_message_checkbox.prop("checked")||""!==r.elements.follower_audio_inputtext.val()?r.startFollowerAlert():r.stopFollowerAlert()},r.startFollowerAlert=function(){twitch.startFollowerAlert()},r.stopFollowerAlert=function(){twitch.stopFollowerAlert()},r.followerAlert=function(e,t,n){if(r.follower_id_list.hasOwnProperty(e)){var o=r.follower_id_list[e];if(n=n||t,-1!==o.indexOf(n))return!1;o.length>=r.max_follower_id_list&&o.shift(),o.push(n)}return r.playSound("follower"),chat.eventMessage(e,t+" just followed the channel!"),r.elements.follower_alert_speak_message_checkbox.prop("checked")&&(chat.last_notify_speech_id=speech_bot.speakImportantMessage(r.formatVoiceMessageUsername("follower",{name:t},e).replace(/\$followers\$/gi,window[e].followers))),r.elements.follower_alert_post_message_checkbox.prop("checked")&&chat.sendMessage({msg:r.formatMessageUsername("follower",t).replace(/\$followers\$/gi,window[e].followers),event:!0}),!0},r.hostAlert=function(e,t,n){r.playSound("host"),chat.eventMessage(e,t+" is now hosting you for "+n+" viewers!"),r.elements.host_alert_speak_message_checkbox.prop("checked")&&(chat.last_notify_speech_id=speech_bot.speakImportantMessage(r.formatVoiceMessageUsername("host",{name:t},e).replace(/\$viewers\$/gi,n))),r.elements.host_alert_post_message_checkbox.prop("checked")&&chat.sendMessage({msg:r.formatMessageUsername("host",t).replace(/\$viewers\$/gi,n),event:!0})},r.raidAlert=function(e,t,n){r.playSound("raid"),chat.eventMessage(e,n+" raiders from "+t+" have joined."),r.elements.raid_alert_speak_message_checkbox.prop("checked")&&(chat.last_notify_speech_id=speech_bot.speakImportantMessage(r.formatVoiceMessageUsername("raid",{name:t},e).replace(/\$viewers\$/gi,n))),r.elements.raid_alert_post_message_checkbox.prop("checked")&&chat.sendMessage({msg:r.formatMessageUsername("raid",t).replace(/\$viewers\$/gi,n),event:!0})},r.replaceMonths=function(e,t){return null!==t?e.replace(/\$months\$/gi,t):e},r.subscriberAlertOutput=function(e,t,n,o,i,s,a){r.playSound("subscriber"),chat.eventMessage(e,i),r.elements.subscriber_alert_speak_message_checkbox.prop("checked")&&(chat.last_notify_speech_id=speech_bot.speakImportantMessage(r.formatVoiceMessageUsername(s,{name:t},e).replace(/\$months\$/gi,n).replace(/\$subscribers\$/gi,a))),r.elements.subscriber_alert_post_message_checkbox.prop("checked")?(chat.sendMessage({msg:r.formatMessageUsername(s,t).replace(/\$months\$/gi,n).replace(/\$subscribers\$/gi,a),event:!0}),isEmpty(o)||isEmpty(o.user)||(o.user.notify_msg=r.getFormatMessage("subscriber").replace(/\$username\$/gi,t).replace(/\$months\$/gi,n).replace(/\$subscribers\$/gi,a),chat.onMessage(e,o))):isEmpty(o)||isEmpty(o.user)||chat.onMessage(e,o)},r.subscriberAlertProcess=function(t,n,o,i,s,a){config.options&&config.options.event&&config.options.event[a]&&config.options.event[a].msg_format&&(/\$subscribers\$/i.test(config.options.event[a].msg_format)&&window[t].hasOwnProperty("getSubscribers")?window[t].getSubscribers(function(e){r.subscriberAlertOutput(t,n,o,i,s,a,e)}):r.subscriberAlertOutput(t,n,o,i,s,a,0))},r.subscriberAlert=function(e,t,n){r.subscriberAlertProcess(e,t,0,n,t+" just subscribed!","subscriber")},r.resubAlert=function(e,t,n,o){r.subscriberAlertProcess(e,t,n,o,t+" has subscribed for "+n+" months!","subanniversary")},r.subgiftAlert=function(e,t,n,o){r.subscriberAlertProcess(e,n,0,"",o,"subscriber")},r.anonsubgiftAlert=function(e,t,n){r.subscriberAlertProcess(e,t,0,"",n,"subscriber")},r.playSound=function(e){if(r.notification_audio&&r.notification_audio.hasOwnProperty(e))var t=r.notification_audio[e];"object"==typeof t&&4===t.readyState&&(t.currentTime=0,t.play())},$doc.on("load_complete:",r.onLoad).on("login:",r.onLogin).on("events:viewer",function(e,t){r.viewerAlert(t.platform_name,t.user)}).on("events:follower",function(e,t){return r.followerAlert(t.platform_name,t.username,t.id)}).on("events:host",function(e,t){r.hostAlert(t.platform_name,t.username,t.viewers)}).on("events:raid",function(e,t){r.raidAlert(t.platform_name,t.username,t.viewers)}).on("events:subscriber",function(e,t){r.subscriberAlert(t.platform_name,t.username,t.message)}).on("events:resub",function(e,t){r.resubAlert(t.platform_name,t.username,t.months,t.message)}).on("events:subgift",function(e,t){r.subgiftAlert(t.platform_name,t.username,t.recipient,t.message)}).on("events:anonsubgift",function(e,t){r.anonsubgiftAlert(t.platform_name,t.recipient,t.message)})};function create_google_drive(){var l=new platform("google_drive","Google Drive");return l.configFilename="config.json",l.configFileId="",l.config={},l.user_id=null,l.apiURL="https://www.googleapis.com",l.filesURL=l.apiURL+"/drive/v3/files",l.uploadURL=l.apiURL+"/upload/drive/v3/files",l.typeFolder="application/vnd.google-apps.folder",l.typeJSON="application/json",l.typeFolderQuery="mimeType%3D'"+l.typeFolder+"'",l.loading=null,l.loadingRef=0,l.loadingFunc=function(e){e?(l.loadingRef<=0&&(l.loadingRef=0,null!==l.loading&&l.loading(!0)),++l.loadingRef):(--l.loadingRef,l.loadingRef<=0&&(l.loadingRef=0,null!==l.loading&&l.loading(!1)))},l.ajax_async=!0,l.async=function(e){l.ajax_async=e},l.connect=function(){checkAuthByCookie(l.name,function(e){e?checkTokenExpireByCookie(l.name,function(e){e?l.getAbout(function(e){l.openConfigFile(function(e){chat.systemMessage(l.name,"Connected successfully."),onOpenConfigFile(e)})}):(chat.systemMessage(l.name,"Connection Failed."),unauthPlatformByCookie(l.name))}):onNotAuth()})},l.disconnect=function(){l.configFileId="",onLogout(),chat.systemMessage(l.name,"Disconnected.")},l.openConfigFile=function(n){var o=1;l.config=null,l.openJSONFile(l.configFilename,null,function(e,t){isEmpty(t)?(chat.systemMessage(l.name,"Unable to open config file on Google Drive. Any changes on configuration may not save."),l.configFileId=t):(l.configFileId=t,isEmpty(e)?l.config={options:{}}:l.config=e),--o<=0&&(n(l.config),l.garbageCollector())})},l.openConfigGroup=function(n,o){l.openJSONFile(l.configFilename,l.config.id.user_groups[n].folder,function(e,t){l.config.user_groups[n]=e,l.config.id.user_groups[n].file=t,o()})},l.openJSONFile=function(e,t,n){l.openFile(e,t,function(e,t){n(isEmpty(e)?{}:JSON.parse(e),t)})},l.updateConfigFile=function(){isEmpty(l.configFileId)||l.updateFileId(l.configFileId,l.typeJSON,JSON.stringify(l.config),null,function(e){isEmpty(e)&&console.log("Failed to update config file on Google Drive.")})},l.createConfigGroup=function(e,n,t,o){isEmpty(l.access_token)||(l.loadingFunc(!0),l.createFolder(e,t,function(t){isEmpty(t)?(l.loadingFunc(!1),console.log("Failed to create group folder on Google Drive."),o(t,"")):l.createFile(l.configFilename,JSON.stringify(n),l.typeJSON,t,function(e){l.loadingFunc(!1),isEmpty(e)&&console.log("Failed to create group file on Google Drive."),o(t,e)})}))},l.garbageCollector=function(){l.ajax({url:l.filesURL+"?spaces=appDataFolder&fields=files(id%2CcreatedTime)",success:function(e,t,n){if(!isEmpty(e)&&!isEmpty(e.files)&&!isEmpty(l.configFileId)){var o={};o[l.configFileId]=null;var i=function(e){for(var t in e.hasOwnProperty("audio_file")&&(o[e.audio_file]=null),e)e.hasOwnProperty(t)&&"object"==typeof e[t]&&i(e[t])};i(l.config);for(var s=new Date(n.getResponseHeader("date")||Date.now())-864e5,a=0;a<e.files.length;)o.hasOwnProperty(e.files[a].id)||new Date(e.files[a].createdTime).getTime()>s?e.files.splice(a,1):++a;for(a=0;a<e.files.length;++a)l.deleteFileId(e.files[a].id)}}})},l.getAbout=function(t){l.ajax({url:l.apiURL+"/drive/v3/about?fields=user",success:function(e){e&&e.user&&e.user.permissionId?(l.user_id=e.user.permissionId,l.user_name=e.user.displayName,l.user_email=e.user.emailAddress,tooltip.applyTooltip($("#connect-"+l.name+"-label"),l.user_name),safeCall(t,null,e.user)):safeCall(t,null,null)},error:function(){console.log("Failed to get about user on Google Drive."),safeCall(t,null,null)}})},l.deleteAllFiles=function(o){isEmpty(l.access_token)?safeCall(o,null,!1):l.listFiles("",function(e){if(!isEmpty(e))for(var t=e.length,n=0;n<e.length;++n)isEmpty(e[n].id)?--t<=0&&safeCall(o,null,!0):l.deleteFileId(e[n].id,function(){--t<=0&&safeCall(o,null,!0)})})},l.listFiles=function(e,t){l.ajax({url:l.filesURL+"?spaces=appDataFolder&fields=files(id%2CmimeType%2Cname%2Csize%2Cparents)"+(isEmpty(e)?"":"&q="+e),success:function(e){isEmpty(e)||isEmpty(e.files)?safeCall(t,null,[]):safeCall(t,null,e.files)},error:function(){console.log("Failed to list files on Google Drive."),safeCall(t,null,null)}})},l.getFileId=function(e,t,n){l.ajax({url:l.filesURL+"?spaces=appDataFolder&q=name%3D'"+e+"'+and+"+l.parentsQuery(t),success:function(e){isEmpty(e)||isEmpty(e.files)?n(""):n(e.files[0].id)},error:function(){console.log("Failed to retrieve file ID from Google Drive."),n(null)}})},l.getFileNewId=function(t,n,o,i){l.getFileId(t,o,function(e){null!==e?""!==e?i(e,!0):l.newFile(t,n,o,function(e){i(e,!1)}):i(e,!1)})},l.getMediaURL=function(e,n){l.access_token&&!isEmpty(e)?l.ajax({url:l.filesURL+"/"+e+"/copy",method:"POST",success:function(t){isEmpty(t)||isEmpty(t.id)?(console.log("Failed to copy file on Google Drive."),n(null)):l.ajax({url:l.filesURL+"/"+t.id+"?alt=media",dataType:"binary",processData:!1,success:function(e){n(URL.createObjectURL(e)),l.deleteFileId(t.id)},error:function(){console.log("Failed to open file on Google Drive."),n(null)}})},error:function(){console.log("Failed to copy file on Google Drive."),n(null)}}):(console.log("Failed to open file on Google Drive."),n(null))},l.openFileId=function(e,t){l.ajax({url:l.filesURL+"/"+e+"?alt=media",dataType:"text",success:function(e){t(e)},error:function(){console.log("Failed to open file on Google Drive."),t(null)}})},l.openFile=function(e,n,o){isEmpty(l.access_token)&&o(null,null),l.getFileId(e,n,function(t){null!==t?isEmpty(t)?l.newFile(e,l.typeJSON,n,function(e){o("",e=e||"")}):l.openFileId(t,function(e){o(e,t)}):o(null,null)})},l.newFile=function(e,t,n,o){l.uploadFile(e,new Blob([""],{type:t}),n,o)},l.createFile=function(e,t,n,o,i){l.uploadFileId(null,e,new Blob([t],{type:n}),o,i)},l.updateFileId=function(e,t,n,o,i){l.uploadFileId(e,null,new Blob([n],{type:t}),o,i)},l.uploadFile=function(t,n,o,i){isEmpty(l.access_token)?safeCall(i,null,null):l.getFileId(t,o,function(e){l.uploadFileId(e,t,n,o,i)})},l.uploadFileId=function(e,t,n,o,i){if(isEmpty(l.access_token))safeCall(i,null,null);else{var s,a,r={mimeType:n.type};isEmpty(e)?(s="POST",a="",r.name=t,r.parents=isEmpty(o)?["appDataFolder"]:[o]):(s="PATCH",a="/"+e),body=new FormData,body.append("metadata",new Blob([JSON.stringify(r)],{type:l.typeJSON})),body.append("file",n),l.ajax({url:l.uploadURL+a+"?uploadType=multipart",data:body,contentType:!1,processData:!1,method:s,success:function(e){safeCall(i,null,isEmpty(e)?e:e.id)},error:function(e){console.log("Failed to upload file to Google Drive."),safeCall(i,null,null)}})}},l.deleteFile=function(e,t,n){l.getFileId(e,t,function(e){null!==e?l.deleteFileId(e,n):safeCall(n,null,!0)})},l.deleteFileId=function(e,t){isEmpty(e)?safeCall(t,null,!0):l.ajax({url:l.filesURL+"/"+e,method:"DELETE",success:function(){safeCall(t,null,!0)},error:function(){console.log("Failed to delete file on Google Drive."),safeCall(t,null,!1)}})},l.getFolderId=function(t,n,o){l.ajax({url:l.filesURL+"?spaces=appDataFolder&q=name%3D'"+t+"'+and+"+l.parentsQuery(n)+"+and+"+l.typeFolderQuery,success:function(e){isEmpty(e)||isEmpty(e.files)?l.createFolder(t,n,o):o(e.files[0].id)},error:function(){o(null)}})},l.createFolder=function(e,t,n){var o={name:e,mimeType:l.typeFolder,parents:[l.testParents(t)]};l.ajax({url:l.filesURL,data:JSON.stringify(o),contentType:l.typeJSON,processData:!1,method:"POST",success:function(e){safeCall(n,null,isEmpty(e)?e:e.id)},error:function(){safeCall(n,null,null)}})},l.ajax=function(s){if(isEmpty(l.access_token))isEmpty(s.error)||s.error("Unauthenticated");else{isEmpty(s.headers)&&(s.headers={}),s.headers.Authorization="Bearer "+l.access_token,s.async=l.ajax_async,l.loadingFunc(!0);var n=s.complete||function(e,t){};s.complete=function(e,t){l.loadingFunc(!1),n(e,t)};var a=s.error||function(e,t,n){};s.error=function(t,n,o){console.log(t,n,o),l.loadingFunc(!1);try{if("error"!==n)throw 0;if(isEmpty(t.responseText))throw 0;var e=JSON.parse(t.responseText);if(e.hasOwnProperty("error")&&e.error.hasOwnProperty("errors")&&e.error.errors.length){var i=e.error.errors[0];if(i.hasOwnProperty("reason")&&"authError"===i.reason&&!s._retry)return s._retry=1,void refreshTokenByCookie(l.name,function(e){l.loadingFunc(e),e?l.ajax(s):a(t,n,o)});i.hasOwnProperty("message")&&ui.createNoticeDialog("["+l.display_name+"] Error: "+i.message,3e4)}}catch(e){l.loadingFunc(!1),a(t,n,o)}},l.ajaxQueue.push(s),l.timer.ajax.isFinished()&&l.ajaxTimerFunc()}},$.ajaxTransport("+binary",function(d,e,t){if(window.FormData&&(d.dataType&&"binary"==d.dataType||d.data&&(window.ArrayBuffer&&d.data instanceof ArrayBuffer||window.Blob&&d.data instanceof Blob)))return{send:function(e,t){var n=new XMLHttpRequest,o=d.url,i=d.type,s=d.async||!0,a=d.responseType||"blob",r=d.data||null,l=d.username||null,u=d.password||null;for(var c in n.addEventListener("load",function(){var e={};e[d.dataType]=n.response,t(n.status,n.statusText,e,n.getAllResponseHeaders())}),n.open(i,o,s,l,u),e)n.setRequestHeader(c,e[c]);n.responseType=a,n.send(r)},abort:function(){t.abort()}}}),l.ajaxTimerFunc=function(){l.ajaxQueue.length&&($.ajax(l.ajaxQueue.shift()),l.ajax_async?l.timer.ajax.start():l.ajaxTimerFunc())},l.ajaxQueue=[],l.timer.ajax=new Timer(l.ajaxTimerFunc,100),l.testParents=function(e){return isEmpty(e)?"appDataFolder":e},l.parentsQuery=function(e){return"'"+l.testParents(e)+"'+in+parents"},l}var selfname_pronunciation,service_icon,service_tiny_icon,hotkey={onload:function(){var a=this;a.elements={all_hotkey_input:$(".hotkey-input"),pause_speech_hotkey_input:$("#pause_speech-hotkey-input")},a.keys={enable_speech:{key:null,trigger:function(){elements.speech_checkbox.trigger("click")}},pause_speech:{key:null,trigger:function(){elements.pause_speech_button.trigger("click")}}},a.modifier={alt:1,ctrl:2,shift:4,meta:8},a.elements.all_hotkey_input.attr({tooltip:"Esc to remove the shortcut key",placeholder:"Shortcut key"}),tooltip.applyTooltip(a.elements.all_hotkey_input),a.initFromConfig=function(){if(isEmpty(config.options.hotkeys))config.options.hotkeys={};else for(var e in config.options.hotkeys)a.keys[e].key=config.options.hotkeys[e],$("#"+e+"-hotkey-input").val(a.keys[e].key&&a.keys[e].key.text?a.keys[e].key.text:"")},a.numpad_keycode={"2d":[96,"0"],23:[97,"1"],28:[98,"2"],22:[99,"3"],25:[100,"4"],c:[101,"5"],27:[102,"6"],24:[103,"7"],26:[104,"8"],21:[105,"9"],"2e":[110,"."],d:[269,"Enter"]},a.convertNumpadKey=function(e){var t={code:e.keyCode,shift:e.shiftKey};if(e.location===KeyboardEvent.DOM_KEY_LOCATION_NUMPAD){var n=t.code.toString(16);a.numpad_keycode.hasOwnProperty(n)&&(12===t.code&&"NumLock"===e.code||(t.code=a.numpad_keycode[n][0],e.key===a.numpad_keycode[n][1]||e.getModifierState&&!e.getModifierState("NumLock")||(t.shift=!0)))}return t},a.isModifier=function(e){switch(e){case 16:case 17:case 18:case 91:case 92:case 224:return!0}return!1},a.isHotkeyPressed=function(e,t){var n=a.convertNumpadKey(e),o=0;for(var i in e.altKey&&(o|=a.modifier.alt),e.ctrlKey&&(o|=a.modifier.ctrl),n.shift&&(o|=a.modifier.shift),e.metaKey&&(o|=a.modifier.meta),a.keys){var s=a.keys[i];if(null!==s.key&&n.code===s.key.code&&o===s.key.modifier&&"function"==typeof s.trigger)return t&&s.trigger(),e.stopPropagation(),e.preventDefault(),!0}return!1},a.onKeyUp=function(e){if(!a.isModifier(e.keyCode)){var t=e.target.tagName.toLowerCase();if("input"==t)switch(e.target.type.toLowerCase()){case"date":case"datetime":case"datetime-local":case"email":case"file":case"month":case"number":case"password":case"search":case"tel":case"text":case"time":case"url":case"week":return}else if("textarea"===t)return;a.isHotkeyPressed(e,!0)}},a.onInputKeyUp=function(e){if(e.stopPropagation(),e.preventDefault(),a.isModifier(e.keyCode)||!e.target.id)return!1;var t=e.target.id.replace(/-hotkey-input$/,""),n=a.convertNumpadKey(e),o={code:n.code,modifier:0,text:""};if(e.altKey&&(o.modifier|=a.modifier.alt,o.text+="Alt+"),e.ctrlKey&&(o.modifier|=a.modifier.ctrl,o.text+="Ctrl+"),n.shift&&(o.modifier|=a.modifier.shift,o.text+="Shift+"),e.metaKey&&(o.modifier|=a.modifier.meta,o.text+="+"),o.text+=e.code?e.code.replace(/^(Digit|Key)/i,""):e.key,27===n.code&&0===o.modifier)o=null;else for(var i in a.keys)if(i!==t){var s=a.keys[i];if(null!==s.key&&s.key.code===o.code&&s.key.modifier===o.modifier){o=null;break}}a.keys[t].key=o,config.options.hasOwnProperty("hotkeys")||(config.options.hotkeys={}),null===o?delete config.options.hotkeys[t]:config.options.hotkeys[t]=o,updateConfig("options"),e.target.value=null===o?"":o.text},window.addEventListener("keyup",a.onKeyUp),a.elements.all_hotkey_input.on1("keydown paste",function(e){return e.stopPropagation(),e.preventDefault(),!1}),a.elements.all_hotkey_input.each(function(e,t){t.addEventListener("keyup",a.onInputKeyUp)})}},config={},loadingState=!1,update_config=!0,loggedin=!1,unmuted=!1,voice_index=0,selfname_voice_index=-1,username_voice_index=-1,chat_platform_names=["twitch","youtube"],speechchat={display_name:"SpeechChat",name:"speechchat"};function ServiceIcon(){this.speechchat="<i class='"+speechchat.name+"-icon service-logo' tooltip='All platforms'></i>",this.google_drive="<i class='"+google_drive.name+"-icon service-logo' tooltip='"+google_drive.display_name+"'></i>";for(var e=0;e<chat_platforms.length;e++)this[chat_platforms[e].name]="<i class='"+window[chat_platform_names[e]].name+"-icon service-logo' tooltip='"+window[chat_platform_names[e]].display_name+"'></i>"}function ServiceTinyIcon(){this.speechchat="<i class='"+speechchat.name+"-icon service-logo tiny-icon' tooltip='All platforms'></i>",this.google_drive="<i class='"+google_drive.name+"-icon service-logo tiny-icon' tooltip='"+google_drive.display_name+"'></i>";for(var e=0;e<chat_platforms.length;e++)this[chat_platforms[e].name]="<i class='"+window[chat_platform_names[e]].name+"-icon service-logo tiny-icon' tooltip='"+window[chat_platform_names[e]].display_name+"'></i>"}name_colors=["Blue","BlueViolet","CadetBlue","Chocolate","Coral","DodgerBlue","Firebrick","GoldenRod","Green","HotPink","OrangeRed","Red","SeaGreen","SpringGreen","YellowGreen"];var chat_platforms=[];function initChatPlatforms(){for(var e=0;e<chat_platform_names.length;e++)window[chat_platform_names[e]]=window["create_"+chat_platform_names[e]]();for(e=0;e<chat_platform_names.length;e++)chat_platforms.push(window[chat_platform_names[e]]);service_icon=new ServiceIcon,service_tiny_icon=new ServiceTinyIcon,ui.initChatPlatformsUI(chat_platforms)}var updateConfigInterval=3e4,updateConfigTimeout=!1,updateConfigBuffered=[];function setTheme(e){$body.toggleClass("dark-theme",e),$(".fa-smile, .fa-comment-dots").toggleClass("fas",e).toggleClass("far",!e),(e&&"dark"!==config.options.theme||!e&&"dark"===config.options.theme)&&(config.options.theme=e?"dark":"",updateConfig("options"))}function toggleSystemLog(){$("#display-system-log").toggleClass("pressed"),$("#system-msg-div").toggleClass("show-dialog")}function initTheme(){var e=!config.options.hasOwnProperty("theme")||"dark"===config.options.theme;$body.toggleClass("dark-theme",e);var t=$("#dark-theme-checkbox");t.prop("checked",e),t.on1("change",function(e){setTheme(this.checked)})}function initDisplayOptions(){var e=function(e,t,n,o,i){config.options.hasOwnProperty(t)||(config.options[t]=e);var s=$("#"+n+"-checkbox");s.prop("checked",config.options[t]),s.on1("change",function(e){this.checked!==config.options[t]&&(config.options[t]=this.checked,updateConfig("options")),void 0!==o&&i(this.checked,$("#"+n+"-style"),n,o)}),s.trigger("change")},t=function(e,t,n,o){e&&t.length?t.remove():e||0!==t.length||$("head").append("<style id='"+n+"-style'>"+o+"{display:none;}</style>")},n=function(e,t,n,o){var i=chat.beginReduceMessageLines();e&&t.length?t.remove():e||0!==t.length||$("head").append("<style id='"+n+"-style'>"+o+"{display:none;}</style>"),$(o).replaceWith(e?function(){return"p"===this.nodeName.toLowerCase()?$("<li></li>").append($(this).children()).attr("class",this.className):this}:function(){return"li"===this.nodeName.toLowerCase()?$("<p></p>").append($(this).children()).attr("class",this.className):this}),chat.endReduceMessageLines(i),e&&chat.scrollToBottom()};e(!0,"alt_row_color","alt-row-color","#messages-ul>li",function(e,t,n,o){e&&t.length?t.remove():e||0!==t.length||$("head").append("<style id='"+n+"-style'>"+o+"{background-color:inherit !important;}</style>")}),e(!0,"display_chat_logo","display-chat-logo","#messages-ul i.service-logo",t),e(!1,"tiny_chat_logo","tiny-chat-logo","#messages-ul>li:not(.general-chat-li)>i.service-logo",function(e,t,n,o){!e&&t.length?t.remove():e&&0===t.length&&$("head").append("<style id='"+n+"-style'>"+o+"{width: 1em !important;}</style>")}),e(!1,"display_chat_time","display-chat-time",".chat-line-time",t),e(!0,"display_profile_pic","display-profile-pic",".profile-img",t),e(!0,"display_event_msg","display-event-msg","#messages-ul>.chat-line-event-msg",n),e(!0,"display_notice_msg","display-notice-msg","#messages-ul>.chat-line-notice-msg",n),e(!1,"display_system_msg","display-system-msg","#messages-ul>.chat-line-system-msg",n),$(".system-msg-close-button").on1("click",toggleSystemLog);e(!1,"remove_ads","remove-ads",".ads, .CANBMDDisplayAD",function(e,t,n,o){!e&&t.length?t.remove():e&&0===t.length&&($("head").append("<style id='"+n+"-style'>"+o+"{display: none !important;}</style>"),$(".CANBMDDisplayAD").remove())}),initChatFade(),initAlwaysScrollLock(),initSideBars()}function initChatFade(){config.options.hasOwnProperty("chat_fade")||(config.options.chat_fade=!1);var t=$("#chat-fade-checkbox");t.prop("checked",!1!==config.options.chat_fade);var n=$("#chat-fade-slider");n.val(!1!==config.options.chat_fade?config.options.chat_fade:30),t.on1("change",function(e){var t=!!this.checked&&parseInt(n.val());$("#chat-fade-fieldset")[0].disabled=!this.checked,t!==config.options.chat_fade&&(config.options.chat_fade=t,updateConfig("options"),chat.setChatFade(t))}),n.on1("input",function(e){var t,n=parseInt(this.value),o=m=h="",i=n;0<(t=Math.floor(i/3600))&&(h=t+"h",i%=3600),0<(t=Math.floor(i/60))&&(m=t+"m",i%=60),0<i&&(o=i+"s"),$("#chat-fade-value").html(h+m+o)}),n.on1("change",function(e){t.trigger("change")}),n.trigger("input"),t.trigger("change"),chat.setChatFade(!!t[0].checked&&parseInt(n.val()))}function initAlwaysScrollLock(){initCheckboxByConfig("always-scroll-lock-checkbox","always_scroll_lock","false",function(e){e&&chat.scrollLock(!0)})}function initSideBars(){elements.hide_h_button.toggleClass("show",config.options.hasOwnProperty("show_h_sidebar")&&!config.options.show_h_sidebar),elements.hide_v_button.toggleClass("show",config.options.hasOwnProperty("show_v_sidebar")&&!config.options.show_v_sidebar),elements.hide_h_button.on1("click",function(e){elements.hide_h_button.hasClass("show")?(elements.chat_div.css("width","calc(100% + "+elements.user_list_div.outerWidth()+"px)"),elements.hide_h_button_i.attr("class","fas fa-caret-left"),elements.hide_h_button.removeClass("show"),config.options.hasOwnProperty("show_h_sidebar")&&!config.options.show_h_sidebar||(config.options.show_h_sidebar=!1,updateConfig("options"))):(elements.chat_div.css("width","100%"),elements.hide_h_button_i.attr("class","fas fa-caret-right"),elements.hide_h_button.addClass("show"),config.options.hasOwnProperty("show_h_sidebar")&&(delete config.options.show_h_sidebar,updateConfig("options")))}),elements.hide_v_button.on1("click",function(e){elements.hide_v_button.hasClass("show")?(elements.chat_div.css("height","100%"),elements.hide_v_button_i.attr("class","fas fa-caret-up"),elements.hide_v_button.removeClass("show"),config.options.hasOwnProperty("show_v_sidebar")&&!config.options.show_v_sidebar||(config.options.show_v_sidebar=!1,updateConfig("options"),isMenuShow(elements.emoticon_list_tabs)&&toggleEmoticonMenu())):(elements.chat_div.css("height","calc(100% - "+(elements.status_div.outerHeight()+elements.send_div.outerHeight())+"px)"),elements.hide_v_button_i.attr("class","fas fa-caret-down"),elements.hide_v_button.addClass("show"),config.options.hasOwnProperty("show_v_sidebar")&&(delete config.options.show_v_sidebar,updateConfig("options"))),ui.setChatListHeight()}),elements.hide_h_button.trigger("click"),elements.hide_v_button.trigger("click"),chat.elements.send_textarea.on1("focus",function(e){elements.hide_v_button.hasClass("show")||elements.hide_v_button.trigger("click"),chat.send_text.setCaret(chat.send_text.current_sel)})}function updateTabHeight(e){$("#"+e).css("height",$("#"+e+">.tab>.tab-radio:checked~.tab-content").outerHeight(!0)+5)}function initTab(t){updateTabHeight(t),$("#"+t+">.tab>.tab-radio").on1("change",function(e){this.checked&&updateTabHeight(t)})}function initTabs(){initTab("tabs1-3-div"),initTab("tabs1-4-div")}function initRoomState(){twitch.initRoomState()}function initVoice(){speech_bot.init(),speech_bot.onload=loadVoiceFromConfig,speech_bot.onspeechstart=chat.onSpeechStart,speech_bot.onspeechend=chat.onSpeechEnd,speech_bot.loadVoices()||(chat.systemMessage("Your browser does not support speech feature."),ui.createNoticeDialog("Your browser does not support speech feature.",3e4))}function initUsernameVoice(){isEmpty(config.options.selfname_pron)&&(config.options.selfname_pron=""),$("#selfname-pronunciation-inputtext").val(config.options.selfname_pron),$("#selfname-pronunciation-inputtext").on1("change",function(){config.options.selfname_pron=$(this).val(),updateConfig("options")})}var voices_value=[],voice_select_list_1=[],voice_select_list_2=[];function loadVoiceFromConfig(e){voices_value=e,voice_select_list_1=[];for(var t=0;t<voices_value.length;t++)voice_select_list_1.push({html:voices_value[t].name,index:t});select_list.initSelectList(elements.voice_select_div,elements.voice_select,voice_select_list_1,function(e){isEmpty(config.options)||(voice_index=e.index,config.options.prefer_voice=e.html,speech_bot.setVoiceByName(e.html),updateConfig("options"))}),(voice_select_list_2=voice_select_list_1.slice()).unshift({html:"Same As Preferred Voice",index:-1}),select_list.initSelectList(elements.selfname_voice_select_div,elements.selfname_voice_select,voice_select_list_2,function(e){isEmpty(config.options)||(selfname_voice_index=e.index,config.options.selfname_voice=0<=e.index?e.html:"",updateConfig("options"))}),select_list.initSelectList(elements.username_voice_select_div,elements.username_voice_select,voice_select_list_2,function(e){isEmpty(config.options)||(username_voice_index=e.index,config.options.username_voice=0<=e.index?e.html:"",updateConfig("options"))}),initVoiceSelectedValue()}function initVoiceSelectedValue(){if(!isEmpty(config.options)){var t=config.options;defaultValue(t,"prefer_voice",""),defaultValue(t,"selfname_voice",""),defaultValue(t,"username_voice","");voices_value.length&&voices_value[0].name;isEmpty(voices_value)||(-1===(voice_index=findIndexArray(voices_value,function(e){return e.name===t.prefer_voice}))&&(voice_index=0),elements.voice_select.selectByIndex(voice_index),updateConfigValue(["options","prefer_voice"],elements.voice_select.text()),selfname_voice_index=findIndexArray(voices_value,function(e){return e.name===t.selfname_voice}),elements.selfname_voice_select.selectByIndex(selfname_voice_index+1),updateConfigValue(["options","selfname_voice"],-1===selfname_voice_index?"":elements.selfname_voice_select.text()),username_voice_index=findIndexArray(voices_value,function(e){return e.name===t.username_voice}),elements.username_voice_select.selectByIndex(username_voice_index+1),updateConfigValue(["options","username_voice"],-1===username_voice_index?"":elements.username_voice_select.text()),speech_bot.setVoiceByName(elements.voice_select.text()),initUsernameVoice())}}function initSpeech(){speech_bot.reset(),speech_bot.enableSpeech(initCheckboxByConfig("speech-checkbox","enable_speech",!0,function(e){speech_bot.enableSpeech(e),updateSpeechStatus()})),elements.pause_speech_button.toggleClass("button-on",speech_bot.isPaused()),elements.pause_speech_button.on1("click",function(e){speech_bot.pause(),$(this).toggleClass("button-on",speech_bot.isPaused()),updateSpeechStatus()}),updateSpeechStatus(),initCheckboxByConfig("personality-voice-checkbox","personality_voice"),speech_bot.autoEng(initCheckboxByConfig("auto-eng-checkbox","auto_eng",!0,speech_bot.autoEng))}function updateSpeechStatus(){elements.speech_status_div.html(speech_bot.isEnabled()?speech_bot.isPaused()?'<i class="fas fa-pause" tooltip="Speech paused"></i>':"":'<i class="fas fa-stop" tooltip="Speech disabled"></i>'),tooltip.applyTooltipAll(elements.speech_status_div)}function initCheckboxByConfig(e,t,n,o){var i=isEmpty(config.options[t])?void 0===n||!0===n:config.options[t],s=$("#"+e);return s[0].checked=i,s.on1("change",void 0!==o?function(e){config.options[t]=this.checked,updateConfig("options"),o(this.checked)}:function(e){config.options[t]=this.checked,updateConfig("options")}),i}var dropdown_menu_show_classname="dropdown-menu-show",dropdown_title_show_classname="dropdown-title-show";function showDropdownTitle(e){e.addClass(dropdown_title_show_classname)}function showDropdownMenu(e){e.addClass(dropdown_menu_show_classname)}function hideDropdownTitle(e){e.removeClass(dropdown_title_show_classname)}function hideDropdownMenu(e){e.removeClass(dropdown_menu_show_classname)}function showMenu(e,t,n){showDropdownTitle(e),showDropdownMenu(t),n&&t.css(getMenuOffset(e[0]))}function hideMenu(e,t){hideDropdownTitle(e),hideDropdownMenu(t)}function toggleMenu(e,t,n){isEmpty(n)&&(n=!isTitleShow(e)),hideAllMenu(),n?showMenu(e,t):hideMenu(e,t)}function isTitleShow(e){return e.hasClass(dropdown_title_show_classname)}function isMenuShow(e){return e.hasClass(dropdown_menu_show_classname)}function cancelEvent(e){e.stopPropagation()}function hideAllMenu(){hideMenu($(".dropdown-title-show:not(.user-group)"),$(".dropdown-menu-show")),points.show(!1)}function hideAllTopMenu(){hideMenu($(".top-title>.dropdown-title-show"),$(".top-title.dropdown-menu-show")),hideMenu($("#send-service-select"),$("#send-service-menu")),points.show(!1)}function hideAllServiceMenu(){hideMenu($(".service-option.dropdown-title-show"),$(".service-option.dropdown-menu-show")),hideGoogleDriveResetMenu()}function hideAllControlPanelSubMenu(){hideMenu($("#app-menu-controlpanel-div .dropdown-title-show:not(.user-group)"),$("#app-menu-controlpanel-div .dropdown-menu-show:not(.user-group)"))}function hideGoogleDriveResetMenu(){hideMenu($("#google_drive-reset-button"),$("#google_drive-reset-confirm-div"))}function toggleEmoticonMenu(){var e=!isMenuShow(elements.emoticon_list_tabs);if(e){"none"===elements.emoticon_list_tabs[0].style.display&&(elements.emoticon_list_tabs[0].style.display="",elements.emoticon_list_tabs.height());var t=elements.emoji_list_tabs.find("img");t.length&&t[0].hasAttribute("delayedsrc")&&t.each(function(){var e=$(this);e.attr("src",e.attr("delayedsrc")),e.removeAttr("delayedsrc")}),elements.emoticon_list_tabs.on1("click",cancelEvent)}toggleMenu(elements.emoticon_button,elements.emoticon_list_tabs),e||(hideMenu(elements.emoticon_button,elements.emoticon_list_tabs),elements.emoticon_list_tabs.off(e_transitionend),elements.emoticon_list_tabs.one(e_transitionend,function(e){elements.emoticon_list_tabs.hasClass(dropdown_menu_show_classname)||(elements.emoticon_list_tabs[0].style.display="none")}))}function setOptionMenuOffset(e,t){var n=e.offset();t.offset({left:n.left+e.outerWidth()-t.outerWidth(),top:n.top+e.outerHeight()-6})}function capturePointerdown(e){e.target.setPointerCapture(e.pointerId)}function capturePointerup(n){n.target.releasePointerCapture(n.pointerId),window.addEventListener("click",function e(t){window.removeEventListener("click",e,!0),document.elementFromPoint(t.clientX,t.clientY)!==n.target&&t.stopImmediatePropagation()},!0)}function initDropDownMenu(){$("#app-title-dropdown-title-div").on1("click",function(e){toggleMenu($("#app-title-div"),$("#app-menu-div")),points.show(isMenuShow($("#app-menu-div"))),cancelEvent(e)}),$(".app-menu-div").on1("click",function(e){cancelEvent(e)}),$("#app-menu-div").on1("click",function(e){hideAllMenu(),cancelEvent(e)}),$("#app-menu-controlpanel").on1("click",function(e){hideAllMenu(),showMenu($("#app-title-div"),$("#app-menu-controlpanel-div")),points.show(isMenuShow($("#app-menu-controlpanel-div"))),cancelEvent(e)}),$("#app-menu-forum").on1("click",function(e){window.open("https://forum.speechchat.com","_blank")}),$("#app-menu-about").on1("click",function(e){cancelEvent(e),hideAllMenu(),showMenu($("#app-title-div"),$("#app-menu-about-div")),points.show(isMenuShow($("#app-menu-about-div"))),$("#donation-list-container .name").html(""),$("#donation-list-container .amount").html(""),n=0,$("#donation-list-container .list").length&&$("#donation-list-container .list")[0].update_time>Date.now()-6e4?($("#donation-list-container .list").on1(e_animationend,o),$("#donation-list-container .list").trigger(e_animationend)):$.ajax({url:"donation_list.php?json"}).done(function(e){"object"==typeof e&&e.length&&(t=e,$("#donation-list-container .list")[0].update_time=Date.now(),$("#donation-list-container .list").on1(e_animationend,o),$("#donation-list-container .list").trigger(e_animationend))})});var t=[],n=0;function o(e){e.originalEvent&&"ani-list-donator2"!==e.originalEvent.animationName||(this.classList.remove("run-animation"),this.offsetHeight,"hidden"!==$(this).css("visibility")||isMenuShow($("#app-menu-about-div"))?(this.classList.add("run-animation"),$("#donation-list-container .name").html(t[n].display_name),$("#donation-list-container .amount").html("$"+t[n].amount),++n>=t.length&&(n=0)):$(this).off(e_animationend))}$("#about-statistics-div>i").on1("click",function(e){ui.createDCDialog({ajax:{url:"count_users.php",data:{count_users:!0},method:"post"},css:{width:250,height:35},fullscreen:!0})}),$("#app-menu-controlpanel-div").on1("click",function(e){user_group.hideAllUserGroupMenu(),hideAllControlPanelSubMenu(),cancelEvent(e)}),$("#connections-dropdown-title-div").on1("click",function(e){toggleMenu($("#connections-div"),$("#connections-menu-div")),points.show(isMenuShow($("#connections-menu-div"))),cancelEvent(e)}),$("#connections-menu-div").on1("click",function(e){hideAllServiceMenu(),cancelEvent(e)}),elements.emoticon_button.on1("click",function(e){toggleEmoticonMenu(),cancelEvent(e),chat.elements.send_textarea.focus()}),$(".emoticon-list-div").on1("click",cancelEvent),$("#send-service-select").on1("click",function(e){cancelEvent(e),toggleMenu($(this),$("#send-service-menu"))}),$("#send-service-menu").on1("click",cancelEvent),elements.loading_div.on1("click",cancelEvent),$win.on("click",function(e){"file"!==e.target.type&&null===select_list.current_open_list_obj&&hideAllMenu()}),$(".dropdown-menu").on1("pointerdown",capturePointerdown),$(".dropdown-menu").on1("pointerup",capturePointerup)}function initPlatformsOptionMenu(){$("#google_drive-reset-button").on1("click",function(e){if(!isEmpty(google_drive.access_token)){var t=$(this),n=$("#google_drive-reset-confirm-div");!isMenuShow(n)?showMenu(t,n):hideMenu(t,n)}cancelEvent(e)}),setOptionMenuOffset($("#google_drive-reset-button"),$("#google_drive-reset-confirm-div")),$("#google_drive-reset-confirm-div").on1("click",cancelEvent),$("#google_drive-reset-confirm-ok-button").on1("click",function(e){hideGoogleDriveResetMenu(),google_drive.deleteAllFiles(function(){unauthPlatformByCookie("google_drive"),onNotAuth()}),cancelEvent(e)}),$("#google_drive-reset-confirm-cancel-button").on1("click",function(e){hideGoogleDriveResetMenu(),cancelEvent(e)}),$("#google_drive-option-menu-div").on1("click.google_drive_option_menu",function(e){hideGoogleDriveResetMenu(),cancelEvent(e)}),$(".service-option.dropdown-menu").on1("click.service_option_menu",cancelEvent),$("#all-channel-status-set-button").on1("click",function(e){var t=$("#all-channel-title-textarea").val();youtube.isAuthed()&&t.length<1?showSetTitleWarningMessage("[YouTube] title must not be blank.",$(this)):(twitch.setChannelTitle(t),youtube.setChannelTitle(t))});var e=function(n){var o=$("#"+n+"-option-title-div"),i=$("#"+n+"-option-menu-div");o.on1("click",function(e){var t=!isEmpty(window[n].access_token)&&!isMenuShow(i);hideAllServiceMenu(),setOptionMenuOffset(o,i),t?showMenu(o,i):hideMenu(o,i),cancelEvent(e)})};e("google_drive"),e("twitch"),e("youtube")}var set_title_warning_message_timeout=!1;function showSetTitleWarningMessage(t,n){var o=$("#warning-message-div");o.css({"transition-duration":"0s"}).removeClass("show").delay(1).queue(function(){var e=n.offset();o.html(t).css({"transition-duration":".2s",left:e.left+n.outerWidth()-o.outerWidth(),top:e.top+n.outerHeight()+2}).addClass("show"),!1!==set_title_warning_message_timeout&&clearTimeout(set_title_warning_message_timeout),set_title_warning_message_timeout=setTimeout(function(){set_title_warning_message_timeout=!1,o.removeClass("show")},5e3),o.dequeue()})}function getMenuOffset(e){return{right:window.innerWidth-e.getBoundingClientRect().right,top:e.getBoundingClientRect().bottom+1}}function defaultValue(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function showExternalAudioMenu(e){elements.select_audio_external_menu_div.css(getMenuOffset(e[0])),showDropdownMenu(elements.select_audio_external_menu_div),elements.select_audio_external_link_inputtext.val(""),elements.select_audio_external_menu_div.on1("click",cancelEvent)}function initAudioElement(o){var i=o.cfg,e=o.id;i.audio_file=i.audio_file||"",i.audio_link=i.audio_link||"",i.volume=i.volume||100;var t=new Audio;isEmpty(i.audio_file)?t.src=i.audio_link:getAudioSrc(i.audio_file,function(e){t.src=e||""}),t.volume=i.volume/100,o.setAudio(t);var s=$("#audio-select-div-"+e),n=$("#select-audio-local-button-"+e),a=$("#select-audio-external-button-"+e),r=($("#audio-volume-tooltip-"+e),$("#audio-volume-slider-"+e)),l=$("#audio-test-div-"+e),u=$("#audio-inputtext-"+e),c=$("#audio-remove-button-"+e),d=elements.select_audio_inputfile;isEmpty(i.audio_file)&&isEmpty(i.audio_link)?s.addClass("select-audio"):s.removeClass("select-audio"),u.val(i.audio_link),r.val(i.volume),n.on1("click",function(e){cancelEvent(e),hideDropdownMenu(elements.select_audio_external_menu_div),d.trigger("click"),d.on1("change",function(e){if(d[0].files.length){var n=d[0].files[0];loading(!0,!0),setAudioFile(i.audio_file,n,o.getParents(),function(e){loading(!1,!0),d.val(""),null===e?e="":s.removeClass("select-audio"),i.audio_file=e,i.audio_link=n.name,i.volume=100,o.updateConfigAudio();var t=o.getAudio();t.pause(),getAudioSrc(i.audio_file,function(e){t.src=e||""}),t.volume=1,isNaN(t.duration)||(t.currentTime=0),u.val(i.audio_link),r.val(i.volume),p(),safeCall(o.callback)})}})}),a.on1("click",function(e){cancelEvent(e),showExternalAudioMenu(a),elements.select_audio_external_set_button.on1("click",function(e){cancelEvent(e),hideDropdownMenu(elements.select_audio_external_menu_div),""!==i.audio_file&&(google_drive.deleteFileId(i.audio_file),i.audio_file=""),i.audio_link=elements.select_audio_external_link_inputtext.val(),i.volume=100,o.updateConfigAudio();var t=o.getAudio();t.pause(),t.src=i.audio_link,t.volume=1,isNaN(t.duration)||(t.currentTime=0),u.val(i.audio_link),isEmpty(i.audio_link)||s.removeClass("select-audio"),r.val(i.volume),p(),safeCall(o.callback)})});var m=r.parent(".volume-slider-div"),p=function(){tooltip.updateTooltip(m,"Volume: "+r.val()+"%")};p(),r.on1("input",function(e){o.getAudio().volume=r.val()/100,p()}),r.on1("change",function(e){i.volume=r.val(),o.updateConfigAudio(),o.getAudio().volume=i.volume/100,safeCall(o.callback)}),l.on1("click",function(e){var t=o.getAudio();isNaN(t.duration)||(isNaN(t.duration)||(t.currentTime=0),t.play())}),c.on1("click",function(e){cancelEvent(e),removeAudioFile(i.audio_file);var t=o.getAudio();t.pause(),i.audio_link=i.audio_file=t.src="",o.updateConfigAudio(),u.val(""),s.addClass("select-audio"),safeCall(o.callback)})}function removeFileId(e){google_drive.deleteFileId(e)}function getAudioSrc(e,t){google_drive.getMediaURL(e,t)}function setAudioFile(e,t,n,o){""===e&&(e=null),google_drive.uploadFileId(e,t.name,t,n,o)}function removeAudioFile(e){isEmpty(e)||google_drive.deleteFileId(e)}function initPlatformToggle(t){"youtube"!==t?$("#connect-"+t+"-label").on1("click",function(e){authPlatform(t)}):$("#connect-"+t+"-label").on1("click",function(e){isEmpty(window[t].access_token)||!window[t].agreed()?showAgreement(function(){authPlatform(t)}):authPlatform(t)})}function initPlatformToggleByCookie(t){$("#connect-"+t+"-label").on1("click",function(e){authPlatformByCookie(t)}),$("#login-"+t+"-btn").on1("click",function(e){isEmpty(window[t].access_token)&&authPlatformByCookie(t)})}function showAgreement(o){var i=ui.createDCDialog({ajax:{url:"tos.248263e1.css"},css:{width:500,height:400},fullscreen:!0,done:function(){i.addClass("open-page-div");var t=$("<button disabled>I Agree</button>").on("click",function(e){config.options.youtube_agreement=Date.now(),updateConfig("options"),o(),i.close()}),e=$('<input type="checkbox" class="option-checkbox" id="dcdialog-agreement-checkbox">').on("change",function(e){t[0].disabled=!this.checked}),n=$('<div class="dcdialog-agreement-container"></div>').append(i.find(".dcdialog-container")).append($('<div class="dcdialog-agreement-input-container"></div>').append($("<div></div>").append(e,$('<label class="option-label checkbox-label" for="dcdialog-agreement-checkbox">I agree the SpeechChat Terms of Service and Privacy Policy</label>')),$("<div></div>").append(t)));i.append(n)}})}function onNewsRead(e){$(".news-trigger-read").off("change.newsread",onNewsRead),$(".news-icon").removeClass("unread"),config&&config.hasOwnProperty("options")&&(!config.options.hasOwnProperty("news_read")||config.options.news_read<news_date)&&(config.options.news_read=Date.now(),config.options.news_read<news_date&&(config.options.news_read=news_date),updateConfig("options"))}function initNews(){$(".news-icon").toggleClass("unread",!config.options.hasOwnProperty("news_read")||config.options.news_read<news_date),$(".news-trigger-read").on1("change.newsread",onNewsRead)}function updateId(e,t){if(!isEmpty(google_drive.user_id)){var n={};"undefined"!=typeof session&&session.hasOwnProperty(e)&&session[e].id===t||(n[e]=t,$.ajax({url:"update_id.php",method:"POST",data:n}))}}function updateUserGroupFolder(){for(var e=config.id.user_groups.length,t=new Array(e),n=0;n<e;n++)t[n]=config.id.user_groups[n].folder;google_drive.updateConfigFile(config.id.user_groups_folder.file,t)}function updateConfigFunc(e){if(isEmpty(e)&&(e=!1),clearTimeout(updateConfigTimeout),updateConfigTimeout=!1,updateConfigBuffered.length){if(loadingState&&!e)return;updateConfigBuffered=[],google_drive.updateConfigFile(),updateConfigTimeout=setTimeout(updateConfigFunc,updateConfigInterval)}}function addUpdateConfigBuffer(t,n){-1===findIndexArray(updateConfigBuffered,function(e){return e.module===t&&e.index===n})&&updateConfigBuffered.push({module:t,index:n})}function updateConfig(e,t){update_config&&config&&!config.no_save&&(defaultArg(e,"all"),defaultArg(t,0),"all"===e?(addUpdateConfigBuffer("options",0),addUpdateConfigBuffer("user_groups_folder",0)):addUpdateConfigBuffer(e,t),!1!==updateConfigTimeout&&"flush"!==e&&"add_user_group"!==e||updateConfigFunc())}function updateConfigValue(e,t){for(var n=config,o=e.length-1,i=0;i<o;i++)n=n[e[i]];n[e[o]]!==t&&(n[e[o]]=t,updateConfig("options"))}function onOpenConfigFile(e){if(null===e)return config={options:{},no_save:!0},chat.systemMessage(google_drive.name,"Failed to open config file. Any changes to settings will not be saved."),void ui.createNoticeDialog("Failed to open config file. Any changes to settings will not be saved.");(loggedin=!0,unmuted)||(ui._createDCDialog({fullscreen:!0,html:'<i class="fas fa-volume-up"></i><div>Click to unmute.</div>'}).attr("class","unmute-div").off("click").parent().addClass("pointer"),unmuted=!0);if(isEmpty((config=e).options)){config.user_groups=[{name:"Whitelist",show_message:!0,speech:!0,name_list:new user_group.USER_GROUP_NAME_LIST},{name:"Text only",show_message:!0,speech:!1,name_list:new user_group.USER_GROUP_NAME_LIST},{name:"Blacklist",show_message:!1,speech:!1,name_list:new user_group.USER_GROUP_NAME_LIST}];var t=config.user_groups[0].name_list.general;t.normal_user=t.self=t.moderator=t.subscriber=!0}var n=function(){if(loggedin){hotkey.initFromConfig(),initTheme(),initDisplayOptions(),initSpeech(),initVoiceSelectedValue(),chat.onLogin(),user_group.enable(),initSendServices(),initNews(),updateId(),$doc.trigger("login:");for(var e=0;e<chat_platforms.length;e++)chat_platforms[e].connect()}};isEmpty(window.session)||isEmpty(session.points)?points.onLogin(n):(points.onGetPoints(session.points),n())}function onLogout(){loggedin=!1,config={options:{}},window.session=void 0,delete window.session,points.reset(),user_group.disable();for(var e=0;e<chat_platforms.length;e++)unauthPlatform(chat_platforms[e].name);hideAllMenu()}function onNotAuth(){hideAllMenu()}function loading(e,t){isEmpty(t)&&(t=!1),t?e&&(loadingState=!0):(loadingState=e)||!1!==updateConfigTimeout||updateConfigFunc(),isEmpty(config)||isEmpty(config.options)||t?(loadingState&&(ui.showLoadingAnimate(),elements.loading_div[0].offsetHeight),elements.loading_div.toggleClass("loading",loadingState)):loadingState||elements.loading_div.removeClass("loading")}function initSendServices(){if(!isEmpty(config.options)&&!isEmpty(config.options.send_services)){for(var e=!0,t=0;t<chat_platforms.length;t++){var n=config.options.send_services[chat_platforms[t].name];n||(e=!1),$("#send-service-checkbox-"+chat_platforms[t].name)[0].checked=n}$("#send-service-checkbox-all")[0].checked=e}function o(e){if($(".send-service-checkbox").prop("checked",e),!isEmpty(config.options)&&!isEmpty(config.options.send_services))for(var t=0;t<chat_platforms.length;t++)config.options.send_services[chat_platforms[t].name]=e}$(".send-service-checkbox").prop("checked",!0),$("#send-service-checkbox-all").on1("change",function(e){o(this.checked),updateConfig("options")}),$(".send-service-checkbox:not(#send-service-checkbox-all)").on1("change",function(e){if(this.checked){var t=!0;$(".send-service-checkbox.service-connected:not(#send-service-checkbox-all)").each(function(){this.checked||(t=!1)}),t?o(!0):$("#send-service-checkbox-all")[0].checked=!1}else $("#send-service-checkbox-all")[0].checked=!1;isEmpty(config.options)||isEmpty(config.options.send_services)||(config.options.send_services[this.id.replace(/^send-service-checkbox-/,"")]=this.checked,updateConfig("options"))})}function initPlatform(){window.google_drive=create_google_drive(),initChatPlatforms(),google_drive.loading=loading,isEmpty(config)&&(config={options:{}}),initPlatformToggleByCookie("google_drive");for(var e=0;e<chat_platforms.length;e++)initPlatformToggle(chat_platforms[e].name);google_drive.connect()}function getNumByHash(e,t,n){return Math.abs(e^t)%n}function voiceValueString(e){return e<10?"0"+e:e.toString()}function calcVoiceByName(e){var t=murmurhash3_32_gc(e,5325187);return" !s"+voiceValueString(getNumByHash(t,53157613,40)+30)+voiceValueString(getNumByHash(t,87491275,30)+30)}function calcColorByName(e){var t=murmurhash3_32_gc(e);return name_colors[getNumByHash(t,4543801,name_colors.length-1)]}var charCount={key:"charCount",get:function(){return parseInt(getCookie(this.key))||0},inc:function(e){setCookie(this.key,this.get()+e,30)},add:function(e){this.inc(e.trim().length)},post:function(){var e=this,t=e.get();t&&$.ajax({url:"char_count.php",method:"POST",data:{count:t}}).done(function(){e.inc(-t)})}};function preventSelectNavBack(){for(var e=function(){window.onbeforeunload=function(){return""}},t=function(){window.onbeforeunload=null},n=document.getElementsByTagName("select"),o=0,i=n.length;o<i;o++)n[o].onfocus=e,n[o].onblur=t}function onLoadComplete(){7===window._loaded&&(window._loaded|=8,elements.onload(),ui.onload(),errorlog.onload(),points.onload(),donation.onload(),hotkey.onload(),initTabs(),chat.onload(),initPlatform(),user_group.onload(),initVoice(),initRoomState(),initDropDownMenu(),initPlatformsOptionMenu(),charCount.post(),$doc.trigger("load_complete:"))}function murmurhash3_32_gc(e,t){var n,o,i,s,a,r,l,u;for(n=3&e.length,o=e.length-n,i=t,a=3432918353,r=461845907,u=0;u<o;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*r+(((l>>>16)*r&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*r+(((l>>>16)*r&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}$win.on("beforeunload",function(e){updateConfigBuffered.length&&(elements.loading_div.css("transition","none"),elements.loading_div[0].offsetHeight,loading(!0),google_drive.async(!1),updateConfigFunc(!0),google_drive.async(!0),loading(!1))}),void 0===window._loaded&&(window._loaded=0),$win.on("load",function(){window._loaded|=1,onLoadComplete()});var name_list=new function(){var a=this;function s(e,t){var n=a.list[e].users;if(n.hasOwnProperty(t)){var o=n[t];isEmpty(o.timeout)||(o.timeout=!1,u(e,o))}}function r(e,t,n){var o=a.list[e];if(o.users.hasOwnProperty(t.id)){var i=o.users[t.id];isEmpty(i.timeout)||!1===i.timeout||(clearTimeout(i.timeout),isEmpty(t.timeout)?delete i.timeout:i.timeout=setTimeout(s,t.timeout,e,t.id))}else window[e].isViewer(t.id)&&(o.users[t.id]={display_name:isEmpty(t.display_name)?t.id:t.display_name},a.list[e].count++,isEmpty(t.timeout)||(o.users[t.id].timeout=setTimeout(s,t.timeout,e,t.id)),$("."+e+".chatters").append("<div id='"+e+"-chatter-"+t.id+"'>"+(isEmpty(t.full_name)?isEmpty(t.display_name)?t.id:t.display_name:t.full_name)+"</div>"),o.parted.hasOwnProperty(t.id)||$doc.trigger("events:viewer",{platform_name:e,user:t}),(void 0===n||n)&&c(e))}function l(e,t){var n=a.list[e].parted;n.hasOwnProperty(t)&&(isEmpty(n[t].timeout)||delete n[t])}function u(e,t,n){var o=a.list[e];o.parted.hasOwnProperty(t.id)||(o.parted[t.id]={});var i=o.parted[t.id];i.display_name=isEmpty(t.display_name)?t.id:t.display_name,isEmpty(t.full_name)||(i.full_name=t.full_name),isEmpty(i.timeout)||!1===i.timeout||(clearTimeout(i.timeout),i.timeout=!1),i.timeout=setTimeout(l,6e5,e,t.id),o.users.hasOwnProperty(t.id)&&(!1!==o.users[t.id].timeout&&clearTimeout(o.users[t.id].timeout),delete o.users[t.id],a.list[e].count--,$("#"+e+"-chatter-"+t.id).remove()),(void 0===n||n)&&c(e)}function c(e){var t=0;for(var n in a.list)a.list[n].on&&(t+=a.list[n].count);$("#chatter-count-div").html("Chatters: "+t),$("."+e+".chatter-count").html(a.list[e].count);var o=$("."+e+".chatters")[0];o&&(o.style.maxHeight=o.scrollHeight+"px")}a.list={},$doc.on("load_complete:",function(){for(var e=0;e<chat_platform_names.length;e++)a.list[chat_platform_names[e]]={users:{},parted:{},count:0,on:!1}}).on("name_list:names",function(e,t){!function(e,t){for(var n=a.list[e].users,o=$.extend({},n),i=0;i<t.length;++i)n.hasOwnProperty(t[i].id)?delete o[t[i].id]:r(e,t[i],!1);for(var s in o)u(e,{id:s},!1);c(e)}(t.platform_name,t.users)}).on("name_list:join",function(e,t){r(t.platform_name,t.user)}).on("name_list:part",function(e,t){u(t.platform_name,t.user)}).on("name_list:on",function(e,t){a.list[t.platform_name].on=!0,c(t.platform_name)}).on("name_list:off",function(e,t){a.list[t.platform_name].on=!1,c(t.platform_name)})},version="170811",news_date=1499374837619,scemoji=new function(){var f=this;f.config={img:"scemoji.png",icon_cols:50,icon_rows:44,icon_size:2,icon_spacing:.08333333,icon_unit:"em"},f.data={"#":["keycap: #",0],"*":["keycap: *",1],"0":["keycap: 0",2],"1":["keycap: 1",3],"2":["keycap: 2",4],"3":["keycap: 3",5],"4":["keycap: 4",6],"5":["keycap: 5",7],"6":["keycap: 6",8],"7":["keycap: 7",9],"8":["keycap: 8",10],"9":["keycap: 9",11],"":["mahjong red dragon",12],"":["joker",13],"":["A button (blood type)",14],"":["B button (blood type)",15],"":["O button (blood type)",16],"":["P button",17],"":["AB button (blood type)",18],"":["CL button",19],"":["COOL button",20],"":["FREE button",21],"":["ID button",22],"":["NEW button",23],"":["NG button",24],"":["OK button",25],"":["SOS button",26],"":["UP! button",27],"":["VS button",28],"":["",29],"":["",30],"":["",31],"":["",32],"":["",33],"":["",34],"":["",35],"":["",36],"":["",37],"":["",38],"":["",39],"":["",40],"":["",41],"":["",42],"":["",43],"":["",44],"":["",45],"":["",46],"":["",47],"":["",48],"":["",49],"":["",50],"":["",51],"":["",52],"":["",53],"":["",54],"":["Japanese here button",55],"":["Japanese service charge button",56],"":["Japanese free of charge button",57],"":["Japanese reserved button",58],"":["Japanese prohibited button",59],"":["Japanese vacancy button",60],"":["Japanese passing grade button",61],"":["Japanese no vacancy button",62],"":["Japanese not free of charge button",63],"":["Japanese monthly amount button",64],"":["Japanese application button",65],"":["Japanese discount button",66],"":["Japanese open for business button",67],"":["Japanese bargain button",68],"":["Japanese acceptable button",69],"":["cyclone",70],"":["foggy",71],"":["closed umbrella",72],"":["night with stars",73],"":["sunrise over mountains",74],"":["sunrise",75],"":["cityscape at dusk",76],"":["sunset",77],"":["rainbow",78],"":["bridge at night",79],"":["water wave",80],"":["volcano",81],"":["milky way",82],"":["globe showing Europe-Africa",83],"":["globe showing Americas",84],"":["globe showing Asia-Australia",85],"":["globe with meridians",86],"":["new moon",87],"":["waxing crescent moon",88],"":["first quarter moon",89],"":["waxing gibbous moon",90],"":["full moon",91],"":["waning gibbous moon",92],"":["last quarter moon",93],"":["waning crescent moon",94],"":["crescent moon",95],"":["new moon face",96],"":["first quarter moon face",97],"":["last quarter moon face",98],"":["full moon face",99],"":["sun with face",100],"":["glowing star",101],"":["shooting star",102],"":["thermometer",103],"":["sun behind small cloud",104],"":["sun behind large cloud",105],"":["sun behind rain cloud",106],"":["cloud with rain",107],"":["cloud with snow",108],"":["cloud with lightning",109],"":["tornado",110],"":["fog",111],"":["wind face",112],"":["hot dog",113],"":["taco",114],"":["burrito",115],"":["chestnut",116],"":["seedling",117],"":["evergreen tree",118],"":["deciduous tree",119],"":["palm tree",120],"":["cactus",121],"":["hot pepper",122],"":["tulip",123],"":["cherry blossom",124],"":["rose",125],"":["hibiscus",126],"":["sunflower",127],"":["blossom",128],"":["ear of corn",129],"":["sheaf of rice",130],"":["herb",131],"":["four leaf clover",132],"":["maple leaf",133],"":["fallen leaf",134],"":["leaf fluttering in wind",135],"":["mushroom",136],"":["tomato",137],"":["eggplant",138],"":["grapes",139],"":["melon",140],"":["watermelon",141],"":["tangerine",142],"":["lemon",143],"":["banana",144],"":["pineapple",145],"":["red apple",146],"":["green apple",147],"":["pear",148],"":["peach",149],"":["cherries",150],"":["strawberry",151],"":["hamburger",152],"":["pizza",153],"":["meat on bone",154],"":["poultry leg",155],"":["rice cracker",156],"":["rice ball",157],"":["cooked rice",158],"":["curry rice",159],"":["steaming bowl",160],"":["spaghetti",161],"":["bread",162],"":["french fries",163],"":["roasted sweet potato",164],"":["dango",165],"":["oden",166],"":["sushi",167],"":["fried shrimp",168],"":["fish cake with swirl",169],"":["soft ice cream",170],"":["shaved ice",171],"":["ice cream",172],"":["doughnut",173],"":["cookie",174],"":["chocolate bar",175],"":["candy",176],"":["lollipop",177],"":["custard",178],"":["honey pot",179],"":["shortcake",180],"":["bento box",181],"":["pot of food",182],"":["cooking",183],"":["fork and knife",184],"":["teacup without handle",185],"":["sake",186],"":["wine glass",187],"":["cocktail glass",188],"":["tropical drink",189],"":["beer mug",190],"":["clinking beer mugs",191],"":["baby bottle",192],"":["fork and knife with plate",193],"":["bottle with popping cork",194],"":["popcorn",195],"":["ribbon",196],"":["wrapped gift",197],"":["birthday cake",198],"":["jack-o-lantern",199],"":["Christmas tree",200],"":["Santa Claus",201,1],"":["fireworks",207],"":["sparkler",208],"":["balloon",209],"":["party popper",210],"":["confetti ball",211],"":["tanabata tree",212],"":["crossed flags",213],"":["pine decoration",214],"":["Japanese dolls",215],"":["carp streamer",216],"":["wind chime",217],"":["moon viewing ceremony",218],"":["backpack",219],"":["graduation cap",220],"":["military medal",221],"":["reminder ribbon",222],"":["studio microphone",223],"":["level slider",224],"":["control knobs",225],"":["film frames",226],"":["admission tickets",227],"":["carousel horse",228],"":["ferris wheel",229],"":["roller coaster",230],"":["fishing pole",231],"":["microphone",232],"":["movie camera",233],"":["cinema",234],"":["headphone",235],"":["artist palette",236],"":["top hat",237],"":["circus tent",238],"":["ticket",239],"":["clapper board",240],"":["performing arts",241],"":["video game",242],"":["direct hit",243],"":["slot machine",244],"":["pool 8 ball",245],"":["game die",246],"":["bowling",247],"":["flower playing cards",248],"":["musical note",249],"":["musical notes",250],"":["saxophone",251],"":["guitar",252],"":["musical keyboard",253],"":["trumpet",254],"":["violin",255],"":["musical score",256],"":["running shirt",257],"":["tennis",258],"":["skis",259],"":["basketball",260],"":["chequered flag",261],"":["snowboarder",262],"":["person running",263,1],"":["woman running",269,1],"":["man running",263,1],"":["person surfing",275,1],"":["woman surfing",281,1],"":["man surfing",275,1],"":["sports medal",287],"":["trophy",288],"":["horse racing",289],"":["american football",290],"":["rugby football",291],"":["person swimming",292,1],"":["woman swimming",298,1],"":["man swimming",292,1],"":["person lifting weights",304,1],"":["woman lifting weights",310,1],"":["man lifting weights",304,1],"":["person golfing",316],"":["woman golfing",317],"":["man golfing",316],"":["motorcycle",318],"":["racing car",319],"":["cricket game",320],"":["volleyball",321],"":["field hockey",322],"":["ice hockey",323],"":["ping pong",324],"":["snow-capped mountain",325],"":["camping",326],"":["beach with umbrella",327],"":["building construction",328],"":["houses",329],"":["cityscape",330],"":["derelict house",331],"":["classical building",332],"":["desert",333],"":["desert island",334],"":["national park",335],"":["stadium",336],"":["house",337],"":["house with garden",338],"":["office building",339],"":["Japanese post office",340],"":["post office",341],"":["hospital",342],"":["bank",343],"":["ATM sign",344],"":["hotel",345],"":["love hotel",346],"":["convenience store",347],"":["school",348],"":["department store",349],"":["factory",350],"":["red paper lantern",351],"":["Japanese castle",352],"":["castle",353],"":["white flag",354],"":["rainbow flag",355],"":["black flag",356],"":["rosette",357],"":["label",358],"":["badminton",359],"":["bow and arrow",360],"":["amphora",361],"":["",362],"":["",363],"":["",364],"":["",365],"":["",366],"":["rat",367],"":["mouse",368],"":["ox",369],"":["water buffalo",370],"":["cow",371],"":["tiger",372],"":["leopard",373],"":["rabbit",374],"":["cat",375],"":["dragon",376],"":["crocodile",377],"":["whale",378],"":["snail",379],"":["snake",380],"":["horse",381],"":["ram",382],"":["goat",383],"":["ewe",384],"":["monkey",385],"":["rooster",386],"":["chicken",387],"":["dog",388],"":["pig",389],"":["boar",390],"":["elephant",391],"":["octopus",392],"":["spiral shell",393],"":["bug",394],"":["ant",395],"":["honeybee",396],"":["lady beetle",397],"":["fish",398],"":["tropical fish",399],"":["blowfish",400],"":["turtle",401],"":["hatching chick",402],"":["baby chick",403],"":["front-facing baby chick",404],"":["bird",405],"":["penguin",406],"":["koala",407],"":["poodle",408],"":["camel",409],"":["two-hump camel",410],"":["dolphin",411],"":["mouse face",412],"":["cow face",413],"":["tiger face",414],"":["rabbit face",415],"":["cat face",416],"":["dragon face",417],"":["spouting whale",418],"":["horse face",419],"":["monkey face",420],"":["dog face",421],"":["pig face",422],"":["frog face",423],"":["hamster face",424],"":["wolf face",425],"":["bear face",426],"":["panda face",427],"":["pig nose",428],"":["paw prints",429],"":["chipmunk",430],"":["eyes",431],"":["eye",432],"":["eye in speech bubble",433],"":["ear",434,1],"":["nose",440,1],"":["mouth",446],"":["tongue",447],"":["backhand index pointing up",448,1],"":["backhand index pointing down",454,1],"":["backhand index pointing left",460,1],"":["backhand index pointing right",466,1],"":["oncoming fist",472,1],"":["waving hand",478,1],"":["OK hand",484,1],"":["thumbs up",490,1],"":["thumbs down",496,1],"":["clapping hands",502,1],"":["open hands",508,1],"":["crown",514],"":["womans hat",515],"":["glasses",516],"":["necktie",517],"":["t-shirt",518],"":["jeans",519],"":["dress",520],"":["kimono",521],"":["bikini",522],"":["womans clothes",523],"":["purse",524],"":["handbag",525],"":["clutch bag",526],"":["mans shoe",527],"":["running shoe",528],"":["high-heeled shoe",529],"":["womans sandal",530],"":["womans boot",531],"":["footprints",532],"":["bust in silhouette",533],"":["busts in silhouette",534],"":["boy",535,1],"":["girl",541,1],"":["man",547,1],"":["man farmer",553,1],"":["man cook",559,1],"":["man student",565,1],"":["man singer",571,1],"":["man artist",577,1],"":["man teacher",583,1],"":["man factory worker",589,1],"":["family: man, boy",595],"":["family: man, boy, boy",596],"":["family: man, girl",597],"":["family: man, girl, boy",598],"":["family: man, girl, girl",599],"":["family: man, man, boy",600],"":["family: man, man, boy, boy",601],"":["family: man, man, girl",602],"":["family: man, man, girl, boy",603],"":["family: man, man, girl, girl",604],"":["family: man, woman, boy",605],"":["family: man, woman, boy, boy",606],"":["family: man, woman, girl",607],"":["family: man, woman, girl, boy",608],"":["family: man, woman, girl, girl",609],"":["man technologist",610,1],"":["man office worker",616,1],"":["man mechanic",622,1],"":["man scientist",628,1],"":["man astronaut",634,1],"":["man firefighter",640,1],"":["man health worker",646,1],"":["man judge",652,1],"":["man pilot",658,1],"":["couple with heart: man, man",664],"":["kiss: man, man",665],"":["woman",666,1],"":["woman farmer",672,1],"":["woman cook",678,1],"":["woman student",684,1],"":["woman singer",690,1],"":["woman artist",696,1],"":["woman teacher",702,1],"":["woman factory worker",708,1],"":["family: woman, boy",714],"":["family: woman, boy, boy",715],"":["family: woman, girl",716],"":["family: woman, girl, boy",717],"":["family: woman, girl, girl",718],"":["family: woman, woman, boy",719],"":["family: woman, woman, boy, boy",720],"":["family: woman, woman, girl",721],"":["family: woman, woman, girl, boy",722],"":["family: woman, woman, girl, girl",723],"":["woman technologist",724,1],"":["woman office worker",730,1],"":["woman mechanic",736,1],"":["woman scientist",742,1],"":["woman astronaut",748,1],"":["woman firefighter",754,1],"":["woman health worker",760,1],"":["woman judge",766,1],"":["woman pilot",772,1],"":["couple with heart",778],"":["couple with heart: woman, man",778],"":["couple with heart: woman, woman",779],"":["kiss",780],"":["kiss: woman, man",780],"":["kiss: woman, woman",781],"":["family",782],"":["man and woman holding hands",783],"":["two men holding hands",784],"":["two women holding hands",785],"":["police officer",786,1],"":["woman police officer",792,1],"":["man police officer",786,1],"":["people with bunny ears",798],"":["women with bunny ears",798],"":["men with bunny ears",799],"":["bride with veil",800,1],"":["person: blond hair",806,1],"":["woman: blond hair",812,1],"":["man: blond hair",806,1],"":["man with Chinese cap",818,1],"":["person wearing turban",824,1],"":["woman wearing turban",830,1],"":["man wearing turban",824,1],"":["old man",836,1],"":["old woman",842,1],"":["baby",848,1],"":["construction worker",854,1],"":["woman construction worker",860,1],"":["man construction worker",854,1],"":["princess",866,1],"":["ogre",872],"":["goblin",873],"":["ghost",874],"":["baby angel",875,1],"":["alien",881],"":["alien monster",882],"":["angry face with horns",883],"":["skull",884],"":["person tipping hand",885,1],"":["woman tipping hand",885,1],"":["man tipping hand",891,1],"":["guard",897,1],"":["woman guard",903,1],"":["man guard",897,1],"":["woman dancing",909,1],"":["lipstick",915],"":["nail polish",916,1],"":["person getting massage",922,1],"":["woman getting massage",922,1],"":["man getting massage",928,1],"":["person getting haircut",934,1],"":["woman getting haircut",934,1],"":["man getting haircut",940,1],"":["barber pole",946],"":["syringe",947],"":["pill",948],"":["kiss mark",949],"":["love letter",950],"":["ring",951],"":["gem stone",952],"":["bouquet",953],"":["wedding",954],"":["beating heart",955],"":["broken heart",956],"":["two hearts",957],"":["sparkling heart",958],"":["growing heart",959],"":["heart with arrow",960],"":["blue heart",961],"":["green heart",962],"":["yellow heart",963],"":["purple heart",964],"":["heart with ribbon",965],"":["revolving hearts",966],"":["heart decoration",967],"":["diamond with a dot",968],"":["light bulb",969],"":["anger symbol",970],"":["bomb",971],"":["zzz",972],"":["collision",973],"":["sweat droplets",974],"":["droplet",975],"":["dashing away",976],"":["pile of poo",977],"":["flexed biceps",978,1],"":["dizzy",984],"":["speech balloon",985],"":["thought balloon",986],"":["white flower",987],"":["hundred points",988],"":["money bag",989],"":["currency exchange",990],"":["heavy dollar sign",991],"":["credit card",992],"":["yen banknote",993],"":["dollar banknote",994],"":["euro banknote",995],"":["pound banknote",996],"":["money with wings",997],"":["chart increasing with yen",998],"":["seat",999],"":["laptop computer",1e3],"":["briefcase",1001],"":["computer disk",1002],"":["floppy disk",1003],"":["optical disk",1004],"":["dvd",1005],"":["file folder",1006],"":["open file folder",1007],"":["page with curl",1008],"":["page facing up",1009],"":["calendar",1010],"":["tear-off calendar",1011],"":["card index",1012],"":["chart increasing",1013],"":["chart decreasing",1014],"":["bar chart",1015],"":["clipboard",1016],"":["pushpin",1017],"":["round pushpin",1018],"":["paperclip",1019],"":["straight ruler",1020],"":["triangular ruler",1021],"":["bookmark tabs",1022],"":["ledger",1023],"":["notebook",1024],"":["notebook with decorative cover",1025],"":["closed book",1026],"":["open book",1027],"":["green book",1028],"":["blue book",1029],"":["orange book",1030],"":["books",1031],"":["name badge",1032],"":["scroll",1033],"":["memo",1034],"":["telephone receiver",1035],"":["pager",1036],"":["fax machine",1037],"":["satellite antenna",1038],"":["loudspeaker",1039],"":["megaphone",1040],"":["outbox tray",1041],"":["inbox tray",1042],"":["package",1043],"":["e-mail",1044],"":["incoming envelope",1045],"":["envelope with arrow",1046],"":["closed mailbox with lowered flag",1047],"":["closed mailbox with raised flag",1048],"":["open mailbox with raised flag",1049],"":["open mailbox with lowered flag",1050],"":["postbox",1051],"":["postal horn",1052],"":["newspaper",1053],"":["mobile phone",1054],"":["mobile phone with arrow",1055],"":["vibration mode",1056],"":["mobile phone off",1057],"":["no mobile phones",1058],"":["antenna bars",1059],"":["camera",1060],"":["camera with flash",1061],"":["video camera",1062],"":["television",1063],"":["radio",1064],"":["videocassette",1065],"":["film projector",1066],"":["prayer beads",1067],"":["shuffle tracks button",1068],"":["repeat button",1069],"":["repeat single button",1070],"":["clockwise vertical arrows",1071],"":["counterclockwise arrows button",1072],"":["dim button",1073],"":["bright button",1074],"":["muted speaker",1075],"":["speaker low volume",1076],"":["speaker medium volume",1077],"":["speaker high volume",1078],"":["battery",1079],"":["electric plug",1080],"":["magnifying glass tilted left",1081],"":["magnifying glass tilted right",1082],"":["locked with pen",1083],"":["locked with key",1084],"":["key",1085],"":["locked",1086],"":["unlocked",1087],"":["bell",1088],"":["bell with slash",1089],"":["bookmark",1090],"":["link",1091],"":["radio button",1092],"":["BACK arrow",1093],"":["END arrow",1094],"":["ON! arrow",1095],"":["SOON arrow",1096],"":["TOP arrow",1097],"":["no one under eighteen",1098],"":["keycap: 10",1099],"":["input latin uppercase",1100],"":["input latin lowercase",1101],"":["input numbers",1102],"":["input symbols",1103],"":["input latin letters",1104],"":["fire",1105],"":["flashlight",1106],"":["wrench",1107],"":["hammer",1108],"":["nut and bolt",1109],"":["kitchen knife",1110],"":["pistol",1111],"":["microscope",1112],"":["telescope",1113],"":["crystal ball",1114],"":["dotted six-pointed star",1115],"":["Japanese symbol for beginner",1116],"":["trident emblem",1117],"":["black square button",1118],"":["white square button",1119],"":["red circle",1120],"":["blue circle",1121],"":["large orange diamond",1122],"":["large blue diamond",1123],"":["small orange diamond",1124],"":["small blue diamond",1125],"":["red triangle pointed up",1126],"":["red triangle pointed down",1127],"":["upwards button",1128],"":["downwards button",1129],"":["om",1130],"":["dove",1131],"":["kaaba",1132],"":["mosque",1133],"":["synagogue",1134],"":["menorah",1135],"":["one oclock",1136],"":["two oclock",1137],"":["three oclock",1138],"":["four oclock",1139],"":["five oclock",1140],"":["six oclock",1141],"":["seven oclock",1142],"":["eight oclock",1143],"":["nine oclock",1144],"":["ten oclock",1145],"":["eleven oclock",1146],"":["twelve oclock",1147],"":["one-thirty",1148],"":["two-thirty",1149],"":["three-thirty",1150],"":["four-thirty",1151],"":["five-thirty",1152],"":["six-thirty",1153],"":["seven-thirty",1154],"":["eight-thirty",1155],"":["nine-thirty",1156],"":["ten-thirty",1157],"":["eleven-thirty",1158],"":["twelve-thirty",1159],"":["candle",1160],"":["mantelpiece clock",1161],"":["hole",1162],"":["man in suit levitating",1163],"":["detective",1164,1],"":["woman detective",1170,1],"":["man detective",1164,1],"":["sunglasses",1176],"":["spider",1177],"":["spider web",1178],"":["joystick",1179],"":["man dancing",1180,1],"":["linked paperclips",1186],"":["pen",1187],"":["fountain pen",1188],"":["paintbrush",1189],"":["crayon",1190],"":["hand with fingers splayed",1191,1],"":["middle finger",1197,1],"":["vulcan salute",1203,1],"":["black heart",1209],"":["desktop computer",1210],"":["printer",1211],"":["computer mouse",1212],"":["trackball",1213],"":["framed picture",1214],"":["card index dividers",1215],"":["card file box",1216],"":["file cabinet",1217],"":["wastebasket",1218],"":["spiral notepad",1219],"":["spiral calendar",1220],"":["clamp",1221],"":["old key",1222],"":["rolled-up newspaper",1223],"":["dagger",1224],"":["speaking head",1225],"":["left speech bubble",1226],"":["right anger bubble",1227],"":["ballot box with ballot",1228],"":["world map",1229],"":["mount fuji",1230],"":["Tokyo tower",1231],"":["Statue of Liberty",1232],"":["map of Japan",1233],"":["moai",1234],"":["grinning face",1235],"":["beaming face with smiling eyes",1236],"":["face with tears of joy",1237],"":["grinning face with big eyes",1238],"":["grinning face with smiling eyes",1239],"":["grinning face with sweat",1240],"":["grinning squinting face",1241],"":["smiling face with halo",1242],"":["smiling face with horns",1243],"":["winking face",1244],"":["smiling face with smiling eyes",1245],"":["face savoring food",1246],"":["relieved face",1247],"":["smiling face with heart-eyes",1248],"":["smiling face with sunglasses",1249],"":["smirking face",1250],"":["neutral face",1251],"":["expressionless face",1252],"":["unamused face",1253],"":["downcast face with sweat",1254],"":["pensive face",1255],"":["confused face",1256],"":["confounded face",1257],"":["kissing face",1258],"":["face blowing a kiss",1259],"":["kissing face with smiling eyes",1260],"":["kissing face with closed eyes",1261],"":["face with tongue",1262],"":["winking face with tongue",1263],"":["squinting face with tongue",1264],"":["disappointed face",1265],"":["worried face",1266],"":["angry face",1267],"":["pouting face",1268],"":["crying face",1269],"":["persevering face",1270],"":["face with steam from nose",1271],"":["sad but relieved face",1272],"":["frowning face with open mouth",1273],"":["anguished face",1274],"":["fearful face",1275],"":["weary face",1276],"":["sleepy face",1277],"":["tired face",1278],"":["grimacing face",1279],"":["loudly crying face",1280],"":["face with open mouth",1281],"":["hushed face",1282],"":["anxious face with sweat",1283],"":["face screaming in fear",1284],"":["astonished face",1285],"":["flushed face",1286],"":["sleeping face",1287],"":["dizzy face",1288],"":["face without mouth",1289],"":["face with medical mask",1290],"":["grinning cat face with smiling eyes",1291],"":["cat face with tears of joy",1292],"":["grinning cat face",1293],"":["smiling cat face with heart-eyes",1294],"":["cat face with wry smile",1295],"":["kissing cat face",1296],"":["pouting cat face",1297],"":["crying cat face",1298],"":["weary cat face",1299],"":["slightly frowning face",1300],"":["slightly smiling face",1301],"":["upside-down face",1302],"":["face with rolling eyes",1303],"":["person gesturing NO",1304,1],"":["woman gesturing NO",1304,1],"":["man gesturing NO",1310,1],"":["person gesturing OK",1316,1],"":["woman gesturing OK",1316,1],"":["man gesturing OK",1322,1],"":["person bowing",1328,1],"":["woman bowing",1334,1],"":["man bowing",1328,1],"":["see-no-evil monkey",1340],"":["hear-no-evil monkey",1341],"":["speak-no-evil monkey",1342],"":["person raising hand",1343,1],"":["woman raising hand",1343,1],"":["man raising hand",1349,1],"":["raising hands",1355,1],"":["person frowning",1361,1],"":["woman frowning",1361,1],"":["man frowning",1367,1],"":["person pouting",1373,1],"":["woman pouting",1373,1],"":["man pouting",1379,1],"":["folded hands",1385,1],"":["rocket",1391],"":["helicopter",1392],"":["locomotive",1393],"":["railway car",1394],"":["high-speed train",1395],"":["bullet train",1396],"":["train",1397],"":["metro",1398],"":["light rail",1399],"":["station",1400],"":["tram",1401],"":["tram car",1402],"":["bus",1403],"":["oncoming bus",1404],"":["trolleybus",1405],"":["bus stop",1406],"":["minibus",1407],"":["ambulance",1408],"":["fire engine",1409],"":["police car",1410],"":["oncoming police car",1411],"":["taxi",1412],"":["oncoming taxi",1413],"":["automobile",1414],"":["oncoming automobile",1415],"":["sport utility vehicle",1416],"":["delivery truck",1417],"":["articulated lorry",1418],"":["tractor",1419],"":["monorail",1420],"":["mountain railway",1421],"":["suspension railway",1422],"":["mountain cableway",1423],"":["aerial tramway",1424],"":["ship",1425],"":["person rowing boat",1426,1],"":["woman rowing boat",1432,1],"":["man rowing boat",1426,1],"":["speedboat",1438],"":["horizontal traffic light",1439],"":["vertical traffic light",1440],"":["construction",1441],"":["police car light",1442],"":["triangular flag",1443],"":["door",1444],"":["prohibited",1445],"":["cigarette",1446],"":["no smoking",1447],"":["litter in bin sign",1448],"":["no littering",1449],"":["potable water",1450],"":["non-potable water",1451],"":["bicycle",1452],"":["no bicycles",1453],"":["person biking",1454,1],"":["woman biking",1460,1],"":["man biking",1454,1],"":["person mountain biking",1466,1],"":["woman mountain biking",1472,1],"":["man mountain biking",1466,1],"":["person walking",1478,1],"":["woman walking",1484,1],"":["man walking",1478,1],"":["no pedestrians",1490],"":["children crossing",1491],"":["mens room",1492],"":["womens room",1493],"":["restroom",1494],"":["baby symbol",1495],"":["toilet",1496],"":["water closet",1497],"":["shower",1498],"":["person taking bath",1499,1],"":["bathtub",1505],"":["passport control",1506],"":["customs",1507],"":["baggage claim",1508],"":["left luggage",1509],"":["couch and lamp",1510],"":["person in bed",1511],"":["shopping bags",1512],"":["bellhop bell",1513],"":["bed",1514],"":["place of worship",1515],"":["stop sign",1516],"":["shopping cart",1517],"":["hammer and wrench",1518],"":["shield",1519],"":["oil drum",1520],"":["motorway",1521],"":["railway track",1522],"":["motor boat",1523],"":["small airplane",1524],"":["airplane departure",1525],"":["airplane arrival",1526],"":["satellite",1527],"":["passenger ship",1528],"":["kick scooter",1529],"":["motor scooter",1530],"":["canoe",1531],"":["zipper-mouth face",1532],"":["money-mouth face",1533],"":["face with thermometer",1534],"":["nerd face",1535],"":["thinking face",1536],"":["face with head-bandage",1537],"":["robot face",1538],"":["hugging face",1539],"":["sign of the horns",1540,1],"":["call me hand",1546,1],"":["raised back of hand",1552,1],"":["left-facing fist",1558,1],"":["right-facing fist",1564,1],"":["handshake",1570,1],"":["crossed fingers",1576,1],"":["cowboy hat face",1582],"":["clown face",1583],"":["nauseated face",1584],"":["rolling on the floor laughing",1585],"":["drooling face",1586],"":["lying face",1587],"":["person facepalming",1588,1],"":["woman facepalming",1588,1],"":["man facepalming",1594,1],"":["sneezing face",1600],"":["pregnant woman",1601,1],"":["selfie",1607,1],"":["prince",1613,1],"":["man in tuxedo",1619,1],"":["Mrs. Claus",1625,1],"":["person shrugging",1631,1],"":["woman shrugging",1631,1],"":["man shrugging",1637,1],"":["person cartwheeling",1643,1],"":["woman cartwheeling",1649,1],"":["man cartwheeling",1643,1],"":["person juggling",1655,1],"":["woman juggling",1661,1],"":["man juggling",1655,1],"":["person fencing",1667],"":["people wrestling",1668,1],"":["women wrestling",1674,1],"":["men wrestling",1668,1],"":["person playing water polo",1680,1],"":["woman playing water polo",1686,1],"":["man playing water polo",1680,1],"":["person playing handball",1692,1],"":["woman playing handball",1698,1],"":["man playing handball",1692,1],"":["wilted flower",1704],"":["drum",1705],"":["clinking glasses",1706],"":["tumbler glass",1707],"":["spoon",1708],"":["goal net",1709],"":["1st place medal",1710],"":["2nd place medal",1711],"":["3rd place medal",1712],"":["boxing glove",1713],"":["martial arts uniform",1714],"":["croissant",1715],"":["avocado",1716],"":["cucumber",1717],"":["bacon",1718],"":["potato",1719],"":["carrot",1720],"":["baguette bread",1721],"":["green salad",1722],"":["shallow pan of food",1723],"":["stuffed flatbread",1724],"":["egg",1725],"":["glass of milk",1726],"":["peanuts",1727],"":["kiwi fruit",1728],"":["pancakes",1729],"":["crab",1730],"":["lion face",1731],"":["scorpion",1732],"":["turkey",1733],"":["unicorn face",1734],"":["eagle",1735],"":["duck",1736],"":["bat",1737],"":["shark",1738],"":["owl",1739],"":["fox face",1740],"":["butterfly",1741],"":["deer",1742],"":["gorilla",1743],"":["lizard",1744],"":["rhinoceros",1745],"":["shrimp",1746],"":["squid",1747],"":["cheese wedge",1748],"":["double exclamation mark",1749],"":["exclamation question mark",1750],"":["",1751],"":["trade mark",1752],"":["information",1753],"":["left-right arrow",1754],"":["up-down arrow",1755],"":["up-left arrow",1756],"":["up-right arrow",1757],"":["down-right arrow",1758],"":["down-left arrow",1759],"":["right arrow curving left",1760],"":["left arrow curving right",1761],"":["watch",1762],"":["hourglass done",1763],"":["keyboard",1764],"":["eject button",1765],"":["fast-forward button",1766],"":["fast reverse button",1767],"":["fast up button",1768],"":["fast down button",1769],"":["next track button",1770],"":["last track button",1771],"":["play or pause button",1772],"":["alarm clock",1773],"":["stopwatch",1774],"":["timer clock",1775],"":["hourglass not done",1776],"":["pause button",1777],"":["stop button",1778],"":["record button",1779],"":["circled M",1780],"":["black small square",1781],"":["white small square",1782],"":["play button",1783],"":["reverse button",1784],"":["white medium square",1785],"":["black medium square",1786],"":["white medium-small square",1787],"":["black medium-small square",1788],"":["sun",1789],"":["cloud",1790],"":["umbrella",1791],"":["snowman",1792],"":["comet",1793],"":["telephone",1794],"":["ballot box with check",1795],"":["umbrella with rain drops",1796],"":["hot beverage",1797],"":["shamrock",1798],"":["index pointing up",1799,1],"":["skull and crossbones",1805],"":["radioactive",1806],"":["biohazard",1807],"":["orthodox cross",1808],"":["star and crescent",1809],"":["peace symbol",1810],"":["yin yang",1811],"":["wheel of dharma",1812],"":["frowning face",1813],"":["smiling face",1814],"":["female sign",1815],"":["male sign",1816],"":["Aries",1817],"":["Taurus",1818],"":["Gemini",1819],"":["Cancer",1820],"":["Leo",1821],"":["Virgo",1822],"":["Libra",1823],"":["Scorpio",1824],"":["Sagittarius",1825],"":["Capricorn",1826],"":["Aquarius",1827],"":["Pisces",1828],"":["spade suit",1829],"":["club suit",1830],"":["heart suit",1831],"":["diamond suit",1832],"":["hot springs",1833],"":["recycling symbol",1834],"":["wheelchair symbol",1835],"":["hammer and pick",1836],"":["anchor",1837],"":["crossed swords",1838],"":["medical symbol",1839],"":["balance scale",1840],"":["alembic",1841],"":["gear",1842],"":["atom symbol",1843],"":["fleur-de-lis",1844],"":["warning",1845],"":["high voltage",1846],"":["white circle",1847],"":["black circle",1848],"":["coffin",1849],"":["funeral urn",1850],"":["soccer ball",1851],"":["baseball",1852],"":["snowman without snow",1853],"":["sun behind cloud",1854],"":["cloud with lightning and rain",1855],"":["Ophiuchus",1856],"":["pick",1857],"":["rescue workers helmet",1858],"":["chains",1859],"":["no entry",1860],"":["shinto shrine",1861],"":["church",1862],"":["mountain",1863],"":["umbrella on ground",1864],"":["fountain",1865],"":["flag in hole",1866],"":["ferry",1867],"":["sailboat",1868],"":["skier",1869],"":["ice skate",1870],"":["person bouncing ball",1871,1],"":["woman bouncing ball",1877,1],"":["man bouncing ball",1871,1],"":["tent",1883],"":["fuel pump",1884],"":["scissors",1885],"":["white heavy check mark",1886],"":["airplane",1887],"":["envelope",1888],"":["raised fist",1889,1],"":["raised hand",1895,1],"":["victory hand",1901,1],"":["writing hand",1907,1],"":["pencil",1913],"":["black nib",1914],"":["heavy check mark",1915],"":["heavy multiplication x",1916],"":["latin cross",1917],"":["star of David",1918],"":["sparkles",1919],"":["eight-spoked asterisk",1920],"":["eight-pointed star",1921],"":["snowflake",1922],"":["sparkle",1923],"":["cross mark",1924],"":["cross mark button",1925],"":["question mark",1926],"":["white question mark",1927],"":["white exclamation mark",1928],"":["exclamation mark",1929],"":["heavy heart exclamation",1930],"":["red heart",1931],"":["heavy plus sign",1932],"":["heavy minus sign",1933],"":["heavy division sign",1934],"":["right arrow",1935],"":["curly loop",1936],"":["double curly loop",1937],"":["right arrow curving up",1938],"":["right arrow curving down",1939],"":["left arrow",1940],"":["up arrow",1941],"":["down arrow",1942],"":["black large square",1943],"":["white large square",1944],"":["star",1945],"":["heavy large circle",1946],"":["wavy dash",1947],"":["part alternation mark",1948],"":["Japanese congratulations button",1949],"":["Japanese secret button",1950],"":["Ascension Island",1951],"":["Andorra",1952],"":["United Arab Emirates",1953],"":["Afghanistan",1954],"":["Antigua & Barbuda",1955],"":["Anguilla",1956],"":["Albania",1957],"":["Armenia",1958],"":["Angola",1959],"":["Antarctica",1960],"":["Argentina",1961],"":["American Samoa",1962],"":["Austria",1963],"":["Australia",1964],"":["Aruba",1965],"":["land Islands",1966],"":["Azerbaijan",1967],"":["Bosnia & Herzegovina",1968],"":["Barbados",1969],"":["Bangladesh",1970],"":["Belgium",1971],"":["Burkina Faso",1972],"":["Bulgaria",1973],"":["Bahrain",1974],"":["Burundi",1975],"":["Benin",1976],"":["Bermuda",1977],"":["Brunei",1978],"":["Bolivia",1979],"":["Brazil",1980],"":["Bahamas",1981],"":["Bhutan",1982],"":["Bouvet Island",1983],"":["Botswana",1984],"":["Belarus",1985],"":["Belize",1986],"":["Canada",1987],"":["Cocos (Keeling) Islands",1988],"":["Congo - Kinshasa",1989],"":["Central African Republic",1990],"":["Congo - Brazzaville",1991],"":["Switzerland",1992],"":["Cte dIvoire",1993],"":["Cook Islands",1994],"":["Chile",1995],"":["Cameroon",1996],"":["China",1997],"":["Colombia",1998],"":["Clipperton Island",1999],"":["Costa Rica",2e3],"":["Cuba",2001],"":["Cape Verde",2002],"":["Curaao",2003],"":["Christmas Island",2004],"":["Cyprus",2005],"":["Czechia",2006],"":["Germany",2007],"":["Djibouti",2008],"":["Denmark",2009],"":["Dominica",2010],"":["Dominican Republic",2011],"":["Algeria",2012],"":["Ecuador",2013],"":["Estonia",2014],"":["Egypt",2015],"":["Eritrea",2016],"":["Spain",2017],"":["Ethiopia",2018],"":["European Union",2019],"":["Finland",2020],"":["Fiji",2021],"":["Micronesia",2022],"":["Faroe Islands",2023],"":["France",1999],"":["Gabon",2024],"":["United Kingdom",2025],"":["Grenada",2026],"":["Georgia",2027],"":["Guernsey",2028],"":["Ghana",2029],"":["Gibraltar",2030],"":["Greenland",2031],"":["Gambia",2032],"":["Guinea",2033],"":["Equatorial Guinea",2034],"":["Greece",2035],"":["Guatemala",2036],"":["Guam",2037],"":["Guinea-Bissau",2038],"":["Guyana",2039],"":["Hong Kong SAR China",2040],"":["Heard & McDonald Islands",1964],"":["Honduras",2041],"":["Croatia",2042],"":["Haiti",2043],"":["Hungary",2044],"":["Canary Islands",2045],"":["Indonesia",2046],"":["Ireland",2047],"":["Israel",2048],"":["Isle of Man",2049],"":["India",2050],"":["British Indian Ocean Territory",2051],"":["Iraq",2052],"":["Iran",2053],"":["Iceland",2054],"":["Italy",2055],"":["Jersey",2056],"":["Jamaica",2057],"":["Jordan",2058],"":["Japan",2059],"":["Kenya",2060],"":["Kyrgyzstan",2061],"":["Cambodia",2062],"":["Kiribati",2063],"":["Comoros",2064],"":["St. Kitts & Nevis",2065],"":["North Korea",2066],"":["South Korea",2067],"":["Kuwait",2068],"":["Cayman Islands",2069],"":["Kazakhstan",2070],"":["Laos",2071],"":["Lebanon",2072],"":["St. Lucia",2073],"":["Liechtenstein",2074],"":["Sri Lanka",2075],"":["Liberia",2076],"":["Lesotho",2077],"":["Lithuania",2078],"":["Luxembourg",2079],"":["Latvia",2080],"":["Libya",2081],"":["Morocco",2082],"":["Monaco",2083],"":["Moldova",2084],"":["Montenegro",2085],"":["Madagascar",2086],"":["Marshall Islands",2087],"":["Macedonia",2088],"":["Mali",2089],"":["Myanmar (Burma)",2090],"":["Mongolia",2091],"":["Macau SAR China",2092],"":["Northern Mariana Islands",2093],"":["Mauritania",2094],"":["Montserrat",2095],"":["Malta",2096],"":["Mauritius",2097],"":["Maldives",2098],"":["Malawi",2099],"":["Mexico",2100],"":["Malaysia",2101],"":["Mozambique",2102],"":["Namibia",2103],"":["Niger",2104],"":["Norfolk Island",2105],"":["Nigeria",2106],"":["Nicaragua",2107],"":["Netherlands",2108],"":["Norway",1983],"":["Nepal",2109],"":["Nauru",2110],"":["Niue",2111],"":["New Zealand",2112],"":["Oman",2113],"":["Panama",2114],"":["Peru",2115],"":["French Polynesia",2116],"":["Papua New Guinea",2117],"":["Philippines",2118],"":["Pakistan",2119],"":["Poland",2120],"":["Pitcairn Islands",2121],"":["Puerto Rico",2122],"":["Palestinian Territories",2123],"":["Portugal",2124],"":["Palau",2125],"":["Paraguay",2126],"":["Qatar",2127],"":["Romania",2128],"":["Serbia",2129],"":["Russia",2130],"":["Rwanda",2131],"":["Saudi Arabia",2132],"":["Solomon Islands",2133],"":["Seychelles",2134],"":["Sudan",2135],"":["Sweden",2136],"":["Singapore",2137],"":["St. Helena",2138],"":["Slovenia",2139],"":["Svalbard & Jan Mayen",1983],"":["Slovakia",2140],"":["Sierra Leone",2141],"":["San Marino",2142],"":["Senegal",2143],"":["Somalia",2144],"":["Suriname",2145],"":["South Sudan",2146],"":["So Tom & Prncipe",2147],"":["El Salvador",2148],"":["Sint Maarten",2149],"":["Syria",2150],"":["Swaziland",2151],"":["Tristan da Cunha",2152],"":["Turks & Caicos Islands",2153],"":["Chad",2154],"":["Togo",2155],"":["Thailand",2156],"":["Tajikistan",2157],"":["Tokelau",2158],"":["Timor-Leste",2159],"":["Turkmenistan",2160],"":["Tunisia",2161],"":["Tonga",2162],"":["Turkey",2163],"":["Trinidad & Tobago",2164],"":["Tuvalu",2165],"":["Taiwan",2166],"":["Tanzania",2167],"":["Ukraine",2168],"":["Uganda",2169],"":["U.S. Outlying Islands",2170],"":["United Nations",2171],"":["United States",2170],"":["Uruguay",2172],"":["Uzbekistan",2173],"":["Vatican City",2174],"":["St. Vincent & Grenadines",2175],"":["Venezuela",2176],"":["British Virgin Islands",2177],"":["U.S. Virgin Islands",2178],"":["Vietnam",2179],"":["Vanuatu",2180],"":["Samoa",2181],"":["Yemen",2182],"":["South Africa",2183],"":["Zambia",2184],"":["Zimbabwe",2185],"":["England",2186],"":["Scotland",2187],"":["Wales",2188]},f.broad_phase_patt=/([\ud800-\udbff][\udc00-\udfff]|[\u2000-\u3fff]|(#|\*|[0-9])\ufe0f?\u20e3)/g,f.special_patt=/^((#|\*|[0-9])\ufe0f?\u20e3|\ud83c[\udde6-\uddff]\ud83c[\udde6-\uddff]|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40(\udc65\udb40\udc6e\udb40\udc67|\udc73\udb40\udc63\udb40\udc74|\udc77\udb40\udc6c\udb40\udc73)\udb40\udc7f)/,f.purify_patt=/\ufe0f/g;var u=function(e,t,n){i(t);var o=document.createElement(e);return o.id=t,n&&n.appendChild(o),o},i=function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)},c=function(e,t){i(e),document.head.insertAdjacentHTML("beforeend","<style id='"+e+"'>"+t+"<\/script>")};f.initIconSize=function(){var e=f.config;e.icon_outer_spacing=e.icon_size+e.icon_spacing,e.icon_x_divisor=e.icon_cols-1,e.icon_y_divisor=e.icon_rows-1,e.img_bg_size=e.icon_outer_spacing*e.icon_cols,e.icon_offset=1-e.icon_spacing/e.img_bg_size,c("scemoji-style",".scemoji-icon {width: "+e.icon_size+e.icon_unit+";height: "+e.icon_size+e.icon_unit+";background-image: url('"+e.img+"');background-size: "+e.img_bg_size+e.icon_unit+";display: inline-block;vertical-align: middle;}")},f.init=function(e){var t=f.config;if("object"==typeof e)for(var n in e)t[n]=e[n];f.initIconSize()},f.toPercentPos=function(e,t){var n=f.config;return{x:0<n.icon_x_divisor?e/n.icon_x_divisor*n.icon_offset*100:0,y:0<n.icon_y_divisor?t/n.icon_y_divisor*n.icon_offset*100:0}},f.defaultReplacer=function(e,t,n,o,i){var s=f.toPercentPos(t,n);return"<span class='scemoji-icon' style='background-position: "+s.x+"% "+s.y+"%;' alt='"+e+"' tooltip='"+o+"'></span>"},f.replacer=f.defaultReplacer,f.parse=function(e,t,n){if("string"!=typeof e)return e;void 0===t&&(t=f.replacer);var o,i,s,a,r,l,u,c,d="",m=0,p=e.length;for(f.broad_phase_patt.lastIndex=0;null!==(o=f.broad_phase_patt.exec(e));){if(d+=e.substring(m,o.index),i=o[0],a=f.broad_phase_patt.lastIndex,r=0,f.special_patt.lastIndex=0,null!==(s=f.special_patt.exec(e.substring(o.index,o.index+14))))i=s[0].replace(f.purify_patt,""),a=o.index+s[0].length;else for(;a<p;)if(65039===(l=e.charCodeAt(a)))a++;else if(8205===l){if(p<=a+1)break;if(55296<=(u=e.charCodeAt(a+1))&&u<=56319){if(p<=a+2)break;u=3}else u=2;i+=e.substring(a,a+u),a+=u}else{if(55356!==l)break;if(p<=a+1)break;if(!(57338<(u=e.charCodeAt(a+1))&&u<57344))break;r=u-57338,a+=2}f.data.hasOwnProperty(i)?(l=f.config,c=(u=f.data[i])[1],u.length>w&&(c+=r),d+=t(e.substring(o.index,a),c%l.icon_cols,Math.floor(c/l.icon_cols),u[0],n)):d+=e.substring(o.index,a),f.broad_phase_patt.lastIndex=a,m=f.broad_phase_patt.lastIndex}return 0===m?e:(m<e.length&&(d+=e.substring(m)),d)},f.config.catalog=[{name:"People",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Nature",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Food",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Activities",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Travel",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Objects",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Symbols",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","#","*","0","1","2","3","4","5","6","7","8","9","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Flags",icon:"",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}];var d=null,m=null,p=null,g=null,_=null,h=null,v={},b=null,y={},w=2,n="scemoji-nav-selected",a=!1;f.skintone_picked=0,f.catalogNavReplacer=function(e,t,n,o,i){var s=f.toPercentPos(t,n);return"<span class='scemoji-icon' style='background-position: "+s.x+"% "+s.y+"%;' alt='"+i+"' tooltip='"+i+"'></span>"},f.menuOnScroll=function(){var e=null;if(""===_.value)for(var t in v){if(!(v[t].offsetTop-d.offsetHeight-g.offsetHeight<=p.scrollTop))break;e=v[t]}null!==e&&(e=y[e.getAttribute("data-catalog")]).classList.add(n),b!==e&&(b&&b.classList.remove(n),b=e)},f.navOnClick=function(e){_&&""!==_.value&&(_.value="",_.dispatchEvent(new Event("input")));var t=v[e.currentTarget.getAttribute("data-catalog")].offsetTop-d.offsetHeight-g.offsetHeight;p.scroll?p.scroll({top:t,behavior:"smooth"}):p.scrollTop=t},f.iconOnClick=function(e){var t=e.currentTarget.querySelector(".scemoji-icon");m.dispatchEvent(new CustomEvent("pick",{detail:{emoji:t.getAttribute("alt")}}))};var r=function(e,t){for(var n=p.querySelectorAll(e),o=0;o<n.length;o++)n[o].classList.remove(t)};f.searchOnInput=function(e){var t=!1;if(""===e.currentTarget.value)a&&(t=!(a=!1),m.classList.remove("searching"),r(".scemoji-menu-icons>div","hide"),r("#scemoji-menu-search-not-found","show"));else{var n,o,i,s;for(a||(a=!0,m.classList.add("searching")),t=!0,i=p.querySelectorAll(".scemoji-menu-icons .scemoji-icon"),n=o=0;n<i.length;n++)-1!==(s=i[n]).getAttribute("tooltip").toLowerCase().indexOf(e.currentTarget.value.toLowerCase())?(s.parentNode.classList.remove("hide"),o++):s.parentNode.classList.add("hide");n=document.getElementById("scemoji-menu-search-not-found").classList,0===o?n.add("show"):n.remove("show")}t&&(p.scrollTop=0,f.menuOnScroll())},f.skintoneReplacer=function(e,t,n,o,i){var s=f.toPercentPos(t,n);return i.style.backgroundPosition=s.x+"% "+s.y+"%",i.setAttribute("alt",e),null},f.skintonePick=function(e){var t,n,o,i,s,a,r;if(isNaN(e)||e<1||5<e?(e=0,i=""):i=String.fromCharCode(55356,57338+e),f.skintone_picked!==e)for(f.skintone_picked=e,document.getElementById("scemoji-menu-skintone").className="scemoji-skintone-"+f.skintone_picked,t=p.querySelectorAll(".scemoji-menu-icons .scemoji-icon"),n=0;n<t.length;n++)55295<(s=(o=t[n].getAttribute("alt")).charCodeAt(0))&&s<56320?(a=o[0]+o[1],s=o.charCodeAt(3),r=o.substring(55356===o.charCodeAt(2)&&57338<s&&s<57344?4:2)):(a=o[0],s=o.charCodeAt(2),r=o.substring(55356===o.charCodeAt(1)&&57338<s&&s<57344?3:1)),f.data[a+r].length>w&&f.parse(a+i+r,f.skintoneReplacer,t[n])},f.skintoneMenuOnClick=function(e){h.classList.contains("show")?f.closeSkintoneMenu():(h.classList.add("show"),window.addEventListener("click",f.closeSkintoneMenu,!0),window.addEventListener("resize",f.closeSkintoneMenu),m.addEventListener("click",f.closeSkintoneMenu)),e.stopPropagation()},f.skintonePickerOnClick=function(e){f.skintonePick(parseInt(e.currentTarget.className.slice(-1))),f.closeSkintoneMenu(),e.stopPropagation()},f.closeSkintoneMenu=function(e){h.classList.remove("show"),window.removeEventListener("click",f.closeSkintoneMenu,!0),window.removeEventListener("resize",f.closeSkintoneMenu),m.removeEventListener("click",f.closeSkintoneMenu)},f.buildMenu=function(e){var t,n,o,i,s,a,r,l=f.config;for(c("scemoji-menu-style","#scemoji-menu {font-size: 12px;width: 22.5em;position: relative;}#scemoji-menu-nav {font-size: 10px;padding: .3em .5em 0 .5em;background: #223;position: relative;}#scemoji-menu-nav>div {display: inline-block;padding: .5em;border-bottom: .3em solid transparent;cursor: pointer;}#scemoji-menu-nav>.scemoji-nav-selected {border-color: #f60;}#scemoji-menu-container {height: 22.5em;overflow-x: hidden;overflow-y: auto;}#scemoji-menu-search-container {display: inline-block;width: 100%;}#scemoji-menu-search-input {width: calc(100% - 1em);margin: .5em;box-sizing: border-box;vertical-align: middle;}#scemoji-menu-search-not-found {display: none;text-align: center;padding: 1em 0;position: absolute;width: 100%;}#scemoji-menu-skintone {display: inline-block;font-size: 16px;width: 1em;height: 1em;vertical-align: middle;position: relative;cursor: pointer;background: #fabf35;margin-left: .2em;}#scemoji-menu-skintone-picker {position: absolute;z-index: 1;display: none;}#scemoji-menu-skintone-picker>div {width: 1em;height: 1em;cursor: pointer;}#scemoji-menu-skintone-picker.show {display: block;}#scemoji-menu .scemoji-skintone-0 {background: #fabf35;}#scemoji-menu .scemoji-skintone-1 {background: #fbddb9;}#scemoji-menu .scemoji-skintone-2 {background: #dfba93;}#scemoji-menu .scemoji-skintone-3 {background: #b18664;}#scemoji-menu .scemoji-skintone-4 {background: #a2683c;}#scemoji-menu .scemoji-skintone-5 {background: #6d4c42;}.scemoji-menu-catalog-title {position: -webkit-sticky;position: sticky;top: 0;height: 1.5em;line-height: 1.5em;padding: .3em .6em;background: rgba(0,0,0,.5);color: rgba(255,255,255,.9);}.scemoji-menu-icons {padding: 0 .4em;}.scemoji-menu-icons>div {display: inline-block;padding: .2em;margin: .084em;border-radius: .42em;cursor: pointer;}.scemoji-menu-icons>div:hover {background-color: rgba(128,128,128,.3);}#scemoji-menu.searching #scemoji-menu-container {padding: 0 .4em;}#scemoji-menu.searching .scemoji-menu-catalog-title {display: none;}#scemoji-menu.searching .scemoji-menu-catalog {display: inline;}#scemoji-menu.searching .scemoji-menu-icons {padding: 0;display: inline;}.scemoji-menu-icons>div.hide {display: none;}#scemoji-menu-search-not-found.show {display: block;}"),m=u("div","scemoji-menu",e),d=u("div","scemoji-menu-nav",m),g=u("div","scemoji-menu-top-bar",m),p=u("div","scemoji-menu-container",m),g.insertAdjacentHTML("beforeend","<div id='scemoji-menu-search-container'><input id='scemoji-menu-search-input' placeholder='Search' spellcheck='false'><div id='scemoji-menu-search-not-found'>No Results</div></div>"),(_=document.getElementById("scemoji-menu-search-input")).addEventListener("input",f.searchOnInput),v={},t=0;t<l.catalog.length;t++)for(o=l.catalog[t],(r=document.createElement("div")).setAttribute("data-catalog",o.name),r.innerHTML=f.parse(o.icon,f.catalogNavReplacer,o.name),r.addEventListener("click",f.navOnClick),d.appendChild(r),y[o.name]=r,(r=document.createElement("div")).className="scemoji-menu-catalog",r.setAttribute("data-catalog",o.name),p.appendChild(r),v[o.name]=r,(r=document.createElement("div")).className="scemoji-menu-catalog-title",r.innerHTML=o.name,v[o.name].appendChild(r),(s=document.createElement("div")).className="scemoji-menu-icons",v[o.name].appendChild(s),i=o.emojis,n=0;n<i.length;n++)(r=document.createElement("div")).innerHTML=f.parse(i[n],f.defaultReplacer),r.addEventListener("click",f.iconOnClick),s.appendChild(r);for(n="<span id='scemoji-menu-skintone' tooltip='Skin tone'><div id='scemoji-menu-skintone-picker'>",t=0;t<6;t++)n+="<div class='scemoji-skintone-"+t+"'></div>";for(n+="</div></span>",d.insertAdjacentHTML("beforeend",n),document.getElementById("scemoji-menu-skintone").addEventListener("click",f.skintoneMenuOnClick),a=d.querySelectorAll("#scemoji-menu-skintone-picker>div"),t=0;t<a.length;t++)a[t].addEventListener("click",f.skintonePickerOnClick);h=document.getElementById("scemoji-menu-skintone-picker"),f.skintone_picked=0,(b=d.firstChild).classList.add("scemoji-nav-selected"),p.addEventListener("scroll",f.menuOnScroll)},f.on=function(e,t){m&&m.addEventListener(e,t)},f.off=function(e,t){m&&m.removeEventListener(e,t)}},select_list=new function(){this.current_open_list_obj=null};function platform(e,t){var a=this;a.name=e,a.display_name=t,a.initPlatform=function(){a.access_token="",a.scope="",a.refresh_token="",a.expires_in="",a.expires_at="",a.api_headers={},a.api_links={},a.online_status=!1,a.live_time=null,a.viewers=0,a.followers=0},a.initPlatform(),a.cookie={access_token:a.name+"_access_token",scope:a.name+"_scope",refresh_token:a.name+"_refresh_token",expires_in:a.name+"_expires_in",expires_at:a.name+"_expires_at"},a.clearTimeout=function(e){!1!==a.timeout[e]&&(clearTimeout(a.timeout[e]),a.timeout[e]=!1)},a.clearAllTimeout=function(){for(var e in a.timeout)a.clearTimeout(e)},a.authSuccess=function(e){var t=null;try{t=JSON.parse(e)}catch(e){return}if(null!==t&&t.hasOwnProperty("access_token")&&t.hasOwnProperty("scope")){"undefined"==typeof session&&(session={}),session.hasOwnProperty(a.name)||(session[a.name]={});var n=session[a.name];n.access_token=t.access_token,n.scope=t.scope,t.hasOwnProperty("expires_in")&&(n.expires_in=t.expires_in),t.hasOwnProperty("refresh_token")&&(n.refresh_token=t.refresh_token),a.connect()}},a.isAuthed=function(){return""!==a.access_token},a.checkScope=function(e,t){var n=null;if(scope[a.name]!==a.scope&&(n="["+a.display_name+"] Permission scopes of this platform has been changed. Please reconnect to this platform."),isEmpty(a.access_token)&&(n="["+a.display_name+"] No access token. Please reconnect to this platform."),!isEmpty(n))return ui.createNoticeDialog(n),unauthPlatform(a.name),void safeCall(e,null,!1);safeCall(a.onChangeToken,a),t.addClass("service-connected"),safeCall(e,null,!0)},a.api=function(e,t){return""!==a.access_token||""!==e&&a.api_links.hasOwnProperty(e)?(void 0===t&&(t={}),a.api_links.hasOwnProperty(e)&&(t.url=a.api_links[e]),t.headers=a.api_headers,$.ajax(t)):new function(){var t=this;t.done=function(e){return t},t.fail=function(e){return e(),t},t.always=function(e){return e(),t}}},a.setApiHeaders=function(e){a.api_headers=e},a.setApiLinks=function(e){a.api_links=e},a.setApiLink=function(e,t){a.api_links[e]=t},a.toggleConnectStatus=function(e){var t=$(e?"<div></div>":"<ul></ul>").append(a.elements.live_info_div.children()).attr({id:a.elements.live_info_div[0].id,class:a.elements.live_info_div[0].className});a.elements.live_info_div.replaceWith(t),a.elements.live_info_div=t},a.toggleOnlineStatus=function(e){a.online_status!==e&&(a.elements.live_status_div.toggleClass("online",e),e||a.hideLiveTime(),a.updateLiveInfoDivWidth()),a.online_status=e},a.showViewerCounter=function(e){a.viewers=e,a.elements.viewer_user_count.html(e||"0"),a.updateLiveInfoDivWidth()},a.showFollowerCounter=function(e){a.followers=e,a.elements.follower_user_counut.html(e||"0"),a.updateLiveInfoDivWidth()},a.showLiveTime=function(e){isEmpty(e)?a.hideLiveTime():(a.live_time=new Date(e),a.elements.live_time_div.addClass("show"),tooltip.updateTooltip(a.elements.live_time_div,"Stream Uptime Since: "+a.live_time.toLocaleString()),a.updateLiveTime()),a.updateLiveInfoDivWidth()},a.hideLiveTime=function(){a.elements.live_time_div.removeClass("show"),a.timer.update_live_time.stop()},a.updateLiveTime=function(){var e=Date.now()-a.live_time;e<0&&(e=0);var t=e%1e3,n=(e=(e-t)/1e3)%60,o=(e=(e-n)/60)%60,i=(e=(e-o)/60)%24,s=(e-i)/24;a.elements.live_time_div;a.elements.live_time_div.addClass("show"),a.elements.live_up_time.html((0<s?s+"d ":"")+UT(i,":")+UT(o,":")+UT(n,"")),a.timer.update_live_time.start(1e3-t)},a.updateLiveInfoDivWidth=function(){var e=a.elements.live_info_div.children().last(),t=e.position().left+e.width()+parseInt(a.elements.live_info_div.css("padding-right"));a.elements.live_info_div.outerWidth(a.elements.live_info_div.hasClass("hide")?0:t)},a.toggleEmotIconDiv=function(e){$("#"+a.name+"-emoticon-div").replaceWith(function(){return $(e?"<div></div>":"<ul></ul>").append($(this).children()).attr({id:this.id,class:this.className})}),!e&&$("#"+a.name+"-emoticon-div>.tab-radio").prop("checked")&&$("#emoticon-list-tabs>div.tab:first-of-type>.tab-radio").prop("checked",!0)},a.toggleNameList=function(e){$("#"+a.name+"-chatter-list-div").toggleClass("hide",void 0!==e?!e:isEmpty(a.access_token)),$doc.trigger("name_list:"+(e?"on":"off"),{platform_name:a.name})},$("#"+a.name+"-chatter-count").on1("click",function(e){$("."+a.name+".chatters, ."+a.name+".chatter-list-sign").toggleClass("hide")}),a.timer={refresh_token:new Timer,update_live_time:new Timer(a.updateLiveTime),refresh_tries:new Timer,stopAll:function(){for(var e in a.timer)a.timer.hasOwnProperty(e)&&"function"==typeof a.timer[e].stop&&a.timer[e].stop()}}}function UT(e,t){return e<10?"0"+e+t:e+t}function authPlatform(t){checkAuth(t,function(e){if(e)unauthPlatform(t);else window.open(t+"?connect","speechchat_auth_window","width=800, height=800")})}function authPlatformByCookie(t){checkAuthByCookie(t,function(e){if(e)unauthPlatformByCookie(t);else window.open(t+"?connect","speechchat_auth_window","width=800, height=800")})}function checkAuthByCookie(e,t){var n=window[e],o=$("#connect-"+e+"-label, #file-services-div"+(n===google_drive?", #homepage-div":""));if(isEmpty(n.access_token)||isEmpty(n.scope)){if("undefined"!=typeof session&&!isEmpty(session)&&!isEmpty(session[e])){var i=session[e];n.access_token=i.access_token,n.scope=i.scope,n.refresh_token=i.refresh_token,isEmpty(i.expires_in)||(n.expires_at=1e3*i.expires_in+Date.now())}if(isEmpty(n.access_token)||isEmpty(n.scope))return o.removeClass("service-connected"),void safeCall(t,null,!1)}n.checkScope(t,o)}function checkAuth(e,t){isEmpty(config.options.services)&&(config.options.services={}),isEmpty(config.options.services[e])&&(config.options.services[e]={});var n=window[e],o=$("#connect-"+e+"-label, #send-service-checkbox-"+e),i=config.options.services[e];if("object"==typeof session&&!isEmpty(session[e])&&!isEmpty(session[e].access_token)){var s=session[e];i.access_token=s.access_token,i.scope=s.scope,i.refresh_token=s.refresh_token||"";var a=s.expires_in||"";i.expires_at=isEmpty(a)?"":1e3*Number(a)+Date.now()}if(isEmpty(i)||isEmpty(i.access_token)||isEmpty(i.scope))return unauthPlatform(e),void safeCall(t,null,!1);updateConfig("options"),n.access_token=i.access_token||"",n.scope=i.scope||"",n.refresh_token=i.refresh_token||"",n.expires_at=i.expires_at||"",n.checkScope(t,o)}function checkTokenExpireByCookie(e,t){var n=window[e];n.timer.refresh_token.stop();var o=Number(n.expires_at)-Date.now()-6e4;o<=0?refreshTokenByCookie(e,t):(safeCall(t,null,!0),n.timer.refresh_token.start(function(){refreshTokenByCookie(e)},o))}function refreshTokenByCookie(o,i){var s=window[o];s.timer.refresh_token.stop(),isEmpty(s.refresh_token)?ui.createNoticeDialog("["+s.display_name+"] Failed to refresh the authorization token. You may need to reconnect to this platform."):$.ajax({url:o+"/index.php",data:{get_refresh_token:"",refresh_token:s.refresh_token,scope:s.scope},method:"POST",success:function(e,t,n){return isEmpty(e.expires_in)||e.expires_in<61?(unauthPlatformByCookie(o),ui.createNoticeDialog("["+s.display_name+"] Failed to refresh the authorization token. Please reconnect to this platform."),void safeCall(i,null,!1)):(s.access_token=e.access_token,isEmpty(e.refresh_token)||(s.refresh_token=e.refresh_token),s.expires_at=(1e3*Number(e.expires_in)+Date.now()).toString(),safeCall(s.onChangeToken,s),isEmpty(s.access_token)?(unauthPlatformByCookie(o),ui.createNoticeDialog("["+s.display_name+"] Failed to refresh the access token. Please reconnect to this platform."),void safeCall(i,null,!1)):(safeCall(i,null,!0),void s.timer.refresh_token.start(function(){refreshTokenByCookie(o)},1e3*Number(e.expires_in)-6e4)))},error:function(e,t,n){chat.systemMessage(o,"Error on retrieving refresh token. Probably the server is down currently."),safeCall(i,null,!1)}})}function checkTokenExpire(e,t){var n=window[e];n.timer.refresh_token.stop();var o=Number(n.expires_at)-Date.now()-6e4;o<=0?refreshToken(e,t):(safeCall(t,null,!0),n.timer.refresh_token.start(function(){refreshToken(e)},o))}function refreshToken(n,o,i){var s=window[n];if(s.timer.refresh_token.stop(),s.timer.refresh_tries.isFinished()){if(void 0===i&&(i=0),isEmpty(s.refresh_token)||3<i)return ui.createNoticeDialog("["+s.display_name+"] Failed to refresh the authorization token. Please reconnect to this platform."),unauthPlatform(n),void safeCall(o,null,!1);$.ajax({url:n+"/index.php",data:{get_refresh_token:isEmpty(google_drive.user_id)?"":google_drive.user_id,refresh_token:s.refresh_token,scope:s.scope},method:"POST"}).always(function(e){if(isEmpty(e)||isEmpty(e.expires_in)||e.expires_in<61||isEmpty(e.access_token))s.timer.refresh_tries.start(function(){refreshToken(n,o,++i)},3e4);else{s.access_token=e.access_token,isEmpty(e.refresh_token)||(s.refresh_token=e.refresh_token),s.expires_at=(1e3*Number(e.expires_in)+Date.now()).toString(),"object"!=typeof config.options.services&&(config.options.services={}),"object"!=typeof config.options.services[n]&&(config.options.services[n]={});var t=config.options.services[n];t.access_token=s.access_token,t.scope=s.scope,t.refresh_token=s.refresh_token,t.expires_at=s.expires_at,updateConfig("options"),safeCall(s.onChangeToken,s),safeCall(o,null,!0),s.timer.refresh_token.start(function(){refreshToken(n)},1e3*Number(e.expires_in)-6e4)}})}}function unauthPlatformByCookie(e){var t=window[e];isEmpty(t.access_token)||$.ajax({url:"logout.php",method:"post"}),"undefined"!=typeof session&&delete window.session,t.initPlatform(),t.timer.stopAll(),t===google_drive&&($("#homepage-div").removeClass("service-connected"),$.ajax({url:"count_users.php",method:"POST",data:{count_users:"true"}}).done(function(e){$(".total-users").html(e)})),$("#connect-"+e+"-label, #file-services-div").removeClass("service-connected"),tooltip.removeTooltip($("#connect-"+e+"-label")),t.disconnect()}function unauthPlatform(e){var t=window[e];"object"==typeof session&&session.hasOwnProperty(e)&&delete session[e],t.initPlatform(),t.timer.stopAll(),isEmpty(config.options)||isEmpty(config.options.services)||isEmpty(config.options.services[e])||(delete config.options.services[e],updateConfig("options")),$("#connect-"+e+"-label, #send-service-checkbox-"+e).removeClass("service-connected"),tooltip.removeTooltip($("#connect-"+e+"-label")),chat.clearSelfUsername(e),t.disconnect()}function create_twitch(){var r=new platform("twitch","Twitch");r.api_url="https://api.twitch.tv/helix/",r.next_follower_link="",r.name_colors=["Blue","BlueViolet","CadetBlue","Chocolate","Coral","DodgerBlue","Firebrick","GoldenRod","Green","HotPink","OrangeRed","Red","SeaGreen","SpringGreen","YellowGreen"],r.user_color_list={},r.elements={connect_label:$("#connect-twitch-label"),live_info_div:$("#twitch-live-info-div"),live_status_div:$("#twitch-live-status-div"),viewer_user_count:$("#twitch-live-status-div>.viewer-count-div>.user-count"),follower_user_counut:$("#twitch-live-info-div>.follower-count-div>.user-count"),live_time_div:$("#twitch-live-status-div>.live-time-div"),live_up_time:$("#twitch-live-status-div>.live-time-div>.up-time"),emoticon_list_padding:$("#twitch-emoticon-list-padding"),channel_title_textarea:$("#twitch-channel-title-textarea"),channel_game_inputtext:$("#twitch-channel-game-inputtext"),channel_game_list_ul:$("#twitch-channel-game-list-ul"),channel_status_set_button:$("#twitch-channel-status-set-button"),channel_status_refresh_button:$("#twitch-channel-status-refresh-button"),follower_only_mode_select_div:$("#twitch-follower-only-mode-select-div"),follower_only_mode_select:$("#twitch-follower-only-mode-select"),follower_only_mode_fieldset:$("#twitch-follower-only-mode-fieldset"),follower_only_mode_inputnumber:$("#twitch-follower-only-mode-inputnumber"),follower_only_mode_set_button:$("#twitch-follower-only-mode-set-button"),slow_mode_inputnumber:$("#twitch-slow-mode-inputnumber"),slow_mode_set_button:$("#twitch-slow-mode-set-button"),subs_only_mode_checkbox:$("#twitch-subs-only-mode-checkbox"),r9k_mode_checkbox:$("#twitch-r9k-mode-checkbox"),emote_only_mode_checkbox:$("#twitch-emote-only-mode-checkbox"),clear_chat_button:$("#twitch-clear-chat-button")},r.init=function(){r.user_name="",r.user_display_name="",r.user_id="",r.channel_id="",r.game_id="",r.room_state={},r.badges={},r.emotes_lookup={},r.emotes_url_template="",r._emotIconPatt=/0^/,r.last_follower_date=0},r.init(),r.initApiEndpoints=function(){r.setApiLinks({channels:r.api_url+"channels?broadcaster_id="+r.user_id,streams:r.api_url+"streams?user_id="+r.user_id,search_categories:r.api_url+"search/categories",chat_emotes_global:r.api_url+"chat/emotes/global",chat_emotes_set:r.api_url+"chat/emotes/set",badges_global:r.api_url+"chat/badges/global",badges_channels:r.api_url+"chat/badges?broadcaster_id="+r.user_id,chatters:"https://tmi.twitch.tv/group/user/"+r.channel_id+"/chatters",users:r.api_url+"users",follows:r.api_url+"channels/followers?broadcaster_id="+r.user_id,subscriptions:r.api_url+"subscriptions?broadcaster_id="+r.user_id})},r.onChangeToken=function(){r.setApiHeaders({authorization:"Bearer "+r.access_token,"client-id":"fffnedqecymkccdvj42mwp2v9clcr76"})},r.follower_only_mode_list=[{html:"off",value:-1},{html:"0 minute",value:0},{html:"10 minutes",value:10},{html:"30 minutes",value:30},{html:"1 hour",value:60},{html:"1 day",value:1440},{html:"1 week",value:10080},{html:"1 month",value:43200},{html:"3 months",value:129600},{html:"custom",value:-2}],r.connect=function(){checkAuth(r.name,function(e){e&&(""===r.user_name?r.api("",{url:r.api_url+"users"}).done(function(e){if(e&&e.data&&e.data.length){var t=e.data[0];r.user_name=t.login,t.id&&(r.user_id=t.id),r.channel_id=r.user_name,r.user_display_name=t.display_name,updateId(r.name,r.channel_id),chat.addSelfUsername(r.name,r.user_name),chat.addSelfUsername(r.name,r.user_display_name),r.initApiEndpoints(),r.initChatBadges(),tooltip.applyTooltip(r.elements.connect_label,r.user_name),chat.systemMessage(r.name,'Connecting to channel "'+r.channel_id+'"...'),r.ircConnect()}else chat.systemMessage(r.name,"Failed to retrieve user name."),r.timer.connect.start()}).fail(function(){chat.systemMessage(r.name,"Failed to retrieve user name."),r.timer.connect.start()}):r.ircConnect())})},r.disconnect=function(){isEmpty(r.tmi_client)||"CLOSED"===r.tmi_client.readyState()||r.tmi_client.disconnect(),r.init(),r.toggleNameList(!1),r.stopFollowerAlert()},r.isConnected=function(){if(void 0!==r.tmi_client)return"OPEN"===r.tmi_client.readyState()},r.ircConnect=function(){if(void 0===r.tmi_client){var e={connection:{reconnect:!0,secure:"https:"===location.protocol},identity:{username:r.user_name,password:"oauth:"+r.access_token},channels:[r.channel_id]};r.tmi_client=new tmi.client(e);var t=r.tmi_client;t.on("connected",function(e,t){r.onConnected(e,t)}),t.on("disconnected",function(e){r.onDisconnected(e)}),t.on("reconnect",function(){r.onReconnect()}),t.on("message",function(e,t,n,o){r.onMessage(e,t,n,o)}),t.on("cheer",function(e,t,n){r.onMessage(e,t,n,!1)}),t.on("names",function(e,t){r.onNames(t)}),t.on("join",function(e,t){r.onJoin(t)}),t.on("part",function(e,t){r.onPart(t)}),t.on("emotesets",function(e){r.onEmoteSets(e)}),t.on("clearchat",function(e){r.onClearChat(e)}),t.on("notice",function(e,t,n){r.onNotice(n)}),t.on("slowmode",function(e,t,n){r.onNotice(t?"This room is now in slow mode. You may send messages every "+n+" seconds.":"This room is no longer in slow mode."),r.elements.slow_mode_inputnumber.val(t?n:"")}),t.on("followersonly",function(e,t,n){var o;if(n=~~n,t)for(o=1;o<r.follower_only_mode_list.length-1&&r.follower_only_mode_list[o].value!==n;++o);else o=0;r.elements.follower_only_mode_select.html(r.follower_only_mode_list[o].html),r.elements.follower_only_mode_fieldset.toggleClass("show",o===r.follower_only_mode_list.length-1),r.elements.follower_only_mode_inputnumber.val(o===r.follower_only_mode_list.length-1?n:"")}),t.on("subscribers",function(e,t){r.onNotice(t?"This room is now in subscribers-only mode.":"This room is no longer in subscribers-only mode."),r.elements.subs_only_mode_checkbox[0].checked=t}),t.on("r9kbeta",function(e,t){r.onNotice(t?"This room is now in r9k mode.":"This room is no longer in r9k mode."),r.elements.r9k_mode_checkbox[0].checked=t}),t.on("emoteonly",function(e,t){r.onNotice(t?"This room is now in emote-only mode.":"This room is no longer in emote-only mode."),r.elements.emote_only_mode_checkbox[0].checked=t}),t.on("hosting",function(e,t,n){r.onNotice(e+" now hosting "+(compareNames(t,r.channel_id)?"you":t)+" for "+n+" viewers.")}),t.on("unhost",function(e,t){r.onNotice(e+" exited host mode.")}),t.on("mods",function(e,t){r.onNotice("The moderators of this room are: "+t.join(", "))}),t.on("hosted",function(e,t,n){r.onHosted(t,n)}),t.on("raided",function(e,t,n,o){r.onRaided(t,n)}),t.on("subscription",function(e,t,n,o,i){r.onSubscription(t,o,i)}),t.on("resub",function(e,t,n,o,i,s){r.onResub(t,n,o,i)}),t.on("subgift",function(e,t,n,o,i,s){r.onSubgift(t,o,r.getIRCMessage(s))}),t.on("anonsubgift",function(e,t,n,o,i){r.onAnonsubgift(n,r.getIRCMessage(i))}),t.on("roomstate",function(e,t){r.onRoomstate(e,t)})}else{(e=r.tmi_client.getOptions()).identity.username=r.user_name,e.identity.password="oauth:"+r.access_token,e.channels=[r.channel_id]}r.tmi_client.connect()};var n=/\\([sn:r\\])/g,o=function(e,t){return this.chars.hasOwnProperty(t)?this.chars[t]:t};r.getIRCMessage=function(e){var t=e["system-msg"];return t?t.replace(n,o):""},r.initChatBadges=function(){r.getChatBadges(),r.getChannelBadges()},r.onConnected=function(e,t){chat.systemMessage(r.name,"Connected successfully."),void 0===r.init_channel_once&&(r.init_channel_once=!0),r.getStreamStatus(),r.getChannelInfo(),r.startFollowerAlert(),r.timer.chatter_list.stop(),r.toggleConnectStatus(!0),r.toggleNameList(!0)},r.onDisconnected=function(e){chat.systemMessage(r.name,"Disconnected."),r.toggleConnectStatus(!1),r.timer.stopAll(),r.toggleNameList(!1),r.onNames([]),r.clearEmotIcons(),r.stopFollowerAlert()},r.onReconnect=function(){chat.systemMessage(r.name,"Reconnecting..."),r.toggleNameList(!1)},r.onRoomstate=function(e,t){if($.extend(!0,r.room_state,t),t.hasOwnProperty("followers-only")){var n,o=~~t["followers-only"];if(0<=o)for(n=1;n<r.follower_only_mode_list.length-1&&r.follower_only_mode_list[n].value!==o;n++);else n=0;r.elements.follower_only_mode_select.html(r.follower_only_mode_list[n].html),r.elements.follower_only_mode_fieldset.toggleClass("show",n===r.follower_only_mode_list.length-1),r.elements.follower_only_mode_inputnumber.val(n===r.follower_only_mode_list.length-1?o:"")}t.hasOwnProperty("slow")&&r.elements.slow_mode_inputnumber.val(!1!==t.slow?~~t.slow:""),t.hasOwnProperty("subs-only")&&(r.elements.subs_only_mode_checkbox[0].checked=t["subs-only"]),t.hasOwnProperty("r9k")&&(r.elements.r9k_mode_checkbox[0].checked=t.r9k),t.hasOwnProperty("emote-only")&&(r.elements.emote_only_mode_checkbox[0].checked=t["emote-only"])},r.onMessage=function(e,t,n,o){var i=o;isEmpty(t.username)&&(t.username=o?r.user_name:"Anonymous"),t.username.toLowerCase()===r.user_name.toLowerCase()&&(o=!0),isEmpty(t["display-name"])&&(t["display-name"]=t.username);var s={user:t,message:r.filterMessage(n,o,t.emotes),formatted_message:o&&!t.emotes?r.replaceEmotIcons(n):r.formatEmotes(n,t.emotes),badge:r.formatBadges(t),self:o,id:i?{id:r.send_message_current_id,finish:!0}:null};if(s.user.roles=t.badges,s.user.roles&&(s.user.roles.hasOwnProperty("founder")||s.user.roles.hasOwnProperty("vip"))&&!s.user.roles.hasOwnProperty("subscriber")&&(s.user.roles.subscriber=1),o){if(s.formatted_message=trimSpaces(s.formatted_message),0===s.formatted_message.length)return}else{var a={id:t.username,timeout:6e5};t.username!==t["display-name"]&&(a.display_name=t["display-name"],a.full_name=t["display-name"]+"("+t.username+")"),$doc.trigger("name_list:join",{platform_name:r.name,user:a})}chat.onMessage(r.name,s)},r.filterMessage=function(e,t,n){return chat.keyword_filter.isMuteEmoticons()?t?r.filterEmotIcons(e):r.filterEmotes(e,n):e};var c=function(e){for(var t=new Array(e);e--;)t[e]="";return t};r.formatEmotes=function(e,t){if("string"!=typeof e)return e;var n,o,i,s,a,r,l,u=e.split("");for(n=0;n<u.length;n++)u[n]=escapeHTML(u[n]);for(n in t)for(i=t[n],o=0;o<i.length;o++)"string"==typeof(s=i[o])&&(s=s.split("-"),r=parseInt(s[0]),l=parseInt(s[1]),a=e.substring(r,l+1),u=u.slice(0,r).concat("<span tooltip='"+a+"'><img class='emoticon' src='https://static-cdn.jtvnw.net/emoticons/v2/"+n+"/static/light/1.0' alt='"+a+"'></span>",c(l-r),u.slice(l+1)));return u.join("")};var l=function(e,t){if(t<1)return"";for(var n="";1<t;)1&t&&(n+=e),t>>=1,e+=e;return n+e};function t(e,t,n){return r._emotIconPatt.lastIndex--,n&&r.emotes_lookup.hasOwnProperty(n)?t+'<span tooltip="'+n+'"><img src="'+r.emotes_url_template.replace(/{{id}}/g,r.emotes_lookup[n])+'" alt="'+n+'"></span>':e}function i(e,t){e=unescapeHTML(e);var n=$("<span></span>").attr({style:"background-image: url('"+r.emotes_url_template.replace(/{{id}}/g,t)+"');","data-emotcode":e,tooltip:e,class:"hoverhand"});r.elements.emoticon_list_padding.append(n),tooltip.applyTooltip(n),n.on("click",r.postEmotIcon)}return r.filterEmotes=function(e,t){if("string"!=typeof e)return e;var n,o,i,s,a,r;for(n in t)for(i=t[n],o=0;o<i.length;o++)"string"==typeof(s=i[o])&&(s=s.split("-"),a=parseInt(s[0]),r=parseInt(s[1]),e=e.substring(0,a)+l(" ",r-a+1)+e.substring(r+1));return e},r.bitsURL="//static-cdn.jtvnw.net/bits/dark/animated/",r.formatBits=function(o){o.replace(/(^|\s)cheer\d+(\s|$)/g,function(e){var t=parseInt(o.match(/d{1,}/)),n=1e4<=t?"red":5e3<=t?"blue":1e3<=t?"green":100<=t?"purple":"gray";return"<span class='chat-bits "+n+"'><img class='chat-bits-img' src='"+r.bitsURL+n+"/1'>"+t+"</span>"})},r.formatBadges=function(e){var t="";if(e&&e.hasOwnProperty("badges"))for(var n in e.badges)t+=r.getBadgeImg(n,e.badges[n]);return t},r.getBadgeImg=function(e,t){return r.badges[e]&&r.badges[e][t]?"<span tooltip='"+e+"'><img src='"+r.badges[e][t]+"' class='badge-img twitch'></span>":""},r.setBadges=function(e){if(e&&e.data&&e.data.length){var t,n,o,i,s,a={};for(t=0;t<e.data.length;t++){for(o=e.data[t],s={},n=0;n<o.versions.length;n++)s[(i=o.versions[n]).id]=i.image_url_1x;a[o.set_id]=s}r.badges=$.extend({},r.badges,a)}},r.getChatBadges=function(){r.channel_id&&r.api("badges_global").done(function(e){r.setBadges(e)})},r.getChannelBadges=function(){r.user_id&&r.api("badges_channels").done(function(e){r.setBadges(e)})},r.send_message_current_id=null,r.send_message_queue=[],r.send_message_sending=!1,r.sendMessage=function(n){if(r.isConnected()){var o=!!n.hasOwnProperty("event")&&n.event;return stringSlice(n.msg,500,function(e,t){r.send_message_queue.push({msg:e,id:n.id,complete:t,output:n.output,event:o}),!1===r.send_message_sending&&(r.send_message_sending=!0,r.processSendMessageQueue())}),!0}return!1},r.processSendMessageQueue=function(){var e=r.tmi_client.getChannels();if(r.send_message_queue.length<=0||!e.length||!r.tmi_client.userstate.hasOwnProperty(e[0]))r.send_message_sending=!1;else{var t=r.send_message_queue.shift();if(r.tmi_client.raw("PRIVMSG "+e[0]+" :"+t.msg),t.output){var n=r.tmi_client.userstate[e[0]],o={user:n,message:r.filterMessage(t.msg,!0,null),formatted_message:trimSpaces(r.replaceEmotIcons(t.msg)),badge:r.formatBadges(n),self:!0,sent:{id:t.id,complete:t.complete}};if(t.hasOwnProperty("event")&&(o.event=t.event),0===o.formatted_message.length)return;chat.onMessage(r.name,o)}else t.complete&&chat.onMessageSentComplete(r.name,t.id);r.timer.send_message_queue.start()}},r.onNotice=function(e){chat.noticeMessage(r.name,e)},r.onClearChat=function(){chat.clearMessage(r.name),r.onNotice("Chat was cleared by a moderator")},r.onNames=function(t){if(""!==r.user_name){for(var e=0;e<t.length;e++)t[e]===r.user_name&&t.splice(e,1);if(0!==t.length){var i=[];r.api("",{url:r.api_url+"users?login="+t.join("&login=")}).done(function(e){if(e&&e.data&&e.data.length)for(var t=0;t<e.data.length;t++){var n=e.data[t];if(!isEmpty(n.login)){var o={id:n.login};compareNames(n.login,n.display_name)||(o.display_name=n.display_name,o.full_name=n.display_name+"("+n.login+")"),i.push(o)}}}).always(function(){if(0===i.length&&0!==t.length)for(var e=0;e<t.length;e++)i.push({id:t[e]});$doc.trigger("name_list:names",{platform_name:r.name,users:i})})}}},r.onJoin=function(e){if(""!==r.user_name&&r.user_name!==e){var n=null;r.api("users",{data:{login:e}}).done(function(e){if(e&&e.data&&e.data.length&&e.data[0].display_name){var t=e.data[0];n=compareNames(t.login,t.display_name)?{id:t.login}:{id:t.login,display_name:t.display_name,full_name:t.display_name+"("+t.login+")"}}}).always(function(){$doc.trigger("name_list:join",{platform_name:r.name,user:n||{id:e}})})}},r.onPart=function(e){if(""!==r.channel_id){var n=null;r.api("users",{data:{login:e}}).done(function(e){if(e&&e.data&&e.data.length&&e.data[0].display_name){var t=e.data[0];n=compareNames(t.login,t.display_name)?{id:t.login}:{id:t.login,display_name:t.display_name,full_name:t.display_name+"("+t.login+")"}}}).always(function(){$doc.trigger("name_list:part",{platform_name:r.name,user:n||{id:e}})})}},r.listChatters=function(){""!==r.channel_id&&r.api("chatters").done(function(e){var t=e.data;if(t){var n=[];for(var o in t.chatters)for(var i=t.chatters[o].length,s=0;s<i;++s)n.push(t.chatters[o][s]);assignChatterList(r.name,n)}r.timer.chatter_list.start(6e4)}).fail(function(){r.timer.chatter_list.start(3e4)})},r.getStreamStatus=function(){""===r.channel_id?r.toggleOnlineStatus(!1):r.api("streams").done(function(e,t,n){if(e&&e.data&&e.data.length){var o=e.data[0];r.toggleOnlineStatus(!0),r.showLiveTime(new Date(o.started_at)-(new Date(n.getResponseHeader("date")||Date.now())-Date.now())),r.showViewerCounter(o.viewer_count)}else r.toggleOnlineStatus(!1)}).fail(function(){r.toggleOnlineStatus(!1),chat.systemMessage(r.name,"Failed to retrieve stream status.")}),r.timer.get_stream_status.start()},r.setChannelTitle=function(t){""!==r.channel_id&&r.api("channels",{data:{title:t},method:"patch"}).done(function(e){r.elements.channel_title_textarea.val(t),chat.systemMessage(r.name,"Channel information updated successfully. Title: "+t)}).fail(function(){chat.systemMessage(r.name,"Failed to update channel title.")})},r.elements.channel_status_set_button.on1("click",function(e){r.setChannelInfo()}),r.elements.channel_status_refresh_button.on1("click",function(e){r.getChannelInfo()}),r.setChannelInfo=function(){if(""!==r.channel_id){var t=r.elements.channel_title_textarea.val(),n=r.elements.channel_game_inputtext.val(),e={title:t};r.game_id&&(e.game_id=r.game_id),r.api("channels",{data:e,method:"patch"}).done(function(e){chat.systemMessage(r.name,"Channel information updated successfully. Title: "+t+" , Game Name: "+n)}).fail(function(){chat.systemMessage(r.name,"Failed to update channel title and game.")})}},r.processChannelInfo=function(e){e.done(function(e){if(e&&e.data&&e.data.length){var t=e.data[0];t.title&&r.elements.channel_title_textarea.val(t.title),t.game_name&&r.elements.channel_game_inputtext.val(t.game_name),t.game_id&&(r.game_id=t.game_id)}}),e.fail(function(){chat.systemMessage(r.name,"Failed to retrieve channel title and game.")})},r.getChannelInfo=function(){if(""===r.channel_id)return r.elements.channel_title_textarea.val(""),void r.elements.channel_game_inputtext.val("");r.processChannelInfo(r.api("channels"))},r.getGameList=function(){var e=r.elements.channel_game_inputtext.val();isEmpty(e)||isEmpty(r.access_token)?r.closeGameList():(r.get_game_list_queue=!0,r.timer.get_game_list.isFinished()&&(r.get_game_list_queue=!1,r.timer.get_game_list.start(),r.api("search_categories",{data:{query:e}}).done(function(n){if(n&&n.data&&n.data.length){for(var e=[],t=0;t<n.data.length;t++)e.push({html:n.data[t].name});select_list.openList(r.elements.channel_game_inputtext,e,function(e,t){null!==e&&(r.elements.channel_game_inputtext.val(e.html),r.elements.channel_game_inputtext.focus(),r.game_id=n.data[t].id),r.get_game_list_queue=!1})}})))},r.closeGameList=function(){r.get_game_list_queue=!1,select_list.closeList()},r.elements.channel_game_inputtext.on1("input click",function(e){r.getGameList()}),r.elements.channel_game_inputtext.on1("blur",function(e){r.closeGameList()}),r.elements.channel_game_inputtext.on1("mousedown",function(e){e.stopPropagation()}),r.onEmoteSets=function(e){if(""!==r.channel_id&&isEmpty(r.emotes_lookup)&&"string"==typeof e){r.emotes_lookup={};var t=e.replace(/,/g,"&emote_set_id=");r.api("",{url:r.api_url+"chat/emotes/set?emote_set_id="+t}).done(function(e){if(e&&e.data&&e.data.length){r.emotes_url_template=e.template.replace(/{{format}}/g,"static").replace(/{{theme_mode}}/g,"light").replace(/{{scale}}/g,"1.0");for(var t=[],n=0;n<e.data.length;n++){var o=e.data[n];r.emotes_lookup[o.name]=o.id,t.push(escapeRegex(o.name))}r._emotIconPatt=new RegExp("(\\s|^)("+t.join("|")+")(?=(\\s|$))","g"),r.buildEmotIconList(e)}}).fail(function(){})}},r.replaceEmotIcons=function(e){return e=escapeHTML(e),isEmpty(r.emotes_lookup)?e:e.replace(r._emotIconPatt,t)},r.filterEmotIcons=function(e){return e=escapeHTML(e),isEmpty(r.emotes_lookup)?e:e.replace(r._emotIconPatt,"")},r.buildEmotIconList=function(e){if(r.elements.emoticon_list_padding.empty(),e&&e.data&&e.data.length){var t,n;for(t=0;t<e.data.length;t++)"smilies"!==(n=e.data[t]).emote_type&&i(n.name,n.id);var o=["R)",";P",":P",";)",":\\","<3",":O","B)","O_o",":|",">(",":D",":(",":)"];for(t=0;t<o.length;t++)r.emotes_lookup.hasOwnProperty(o[t])&&i(o[t],r.emotes_lookup[o[t]]);r.toggleEmotIconDiv(!0)}},r.clearEmotIcons=function(){r._emotIconPatt=/0^/,r.emotes_lookup={},r.elements.emoticon_list_padding.empty(),r.toggleEmotIconDiv(!1)},r.postEmotIcon=function(e){chat.postEmotIcon(e.target)},r.isViewer=function(e){return e.toUpperCase()!==r.user_name.toUpperCase()},r.max_follower_result=5,r.startFollowerAlert=function(){r.timer.follower_alert.stop(),r.api("follows",{data:{first:"1"}}).done(function(e){r.last_follower_date=0,e&&(e.data&&e.data.length&&e.data[0].followed_at&&(r.last_follower_date=new Date(e.data[0].followed_at)),r.showFollowerCounter(e.total)),r.timer.follower_alert.start(r.pollingFollower)}).fail(function(){chat.systemMessage(r.name,"Failed to retrieve followers data."),r.timer.follower_alert.start(r.startFollowerAlert)})},r.pollingFollower=function(){r.api("follows",{data:{first:"1"}}).done(function(e){e&&(e.data&&e.data.length&&e.data[0].followed_at&&new Date(e.data[0].followed_at)>r.last_follower_date&&r.pollingNewFollowers(),r.showFollowerCounter(e.total)),r.timer.follower_alert.start(r.pollingFollower)}).fail(function(){r.timer.follower_alert.start(r.pollingFollower)})},r.pollingNewFollowers=function(){r.api("follows",{data:{first:r.max_follower_result}}).done(function(e){if(e){if(e.data&&e.data.length){var t,n,o,i=r.new_follower_date;for(o=e.data.length-1;0<=o;o--)(t=e.data[o]).followed_at&&(i<(n=new Date(t.followed_at))&&(i=n),n>r.last_follower_date&&t.user_login&&t.user_name&&$doc.triggerHandler("events:follower",{platform_name:r.name,username:t.user_name,id:t.user_login})&&0);r.last_follower_date=i}r.showFollowerCounter(e.total)}})},r.stopFollowerAlert=function(){r.timer.follower_alert.stop()},r.onHosted=function(e,t){$doc.trigger("events:host",{platform_name:r.name,username:e,viewers:t})},r.onRaided=function(e,t){$doc.trigger("events:raid",{platform_name:r.name,username:e,viewers:t})},r.onSubscription=function(e,t,n){var o=n?n.emotes:null,i=isEmpty(t)?null:{user:n,message:r.filterMessage(t,!1,o),formatted_message:r.formatEmotes(t,o),badge:r.formatBadges(n),_this:!1};$doc.trigger("events:subscriber",{platform_name:r.name,username:e,message:i})},r.onResub=function(e,t,n,o){if(t){var i=o?o.emotes:null,s=isEmpty(n)?null:{user:o,message:r.filterMessage(n,!1,i),formatted_message:r.formatEmotes(n,i),badge:r.formatBadges(o),_this:!1};$doc.trigger("events:resub",{platform_name:r.name,username:e,months:t,message:s})}else r.onSubscription(e,n,o)},r.onSubgift=function(e,t,n){$doc.trigger("events:subgift",{platform_name:r.name,username:e,recipient:t,message:n})},r.onAnonsubgift=function(e,t){$doc.trigger("events:anonsubgift",{platform_name:r.name,recipient:e,message:t})},r.initRoomState=function(){var o=function(){};select_list.initSelectList(r.elements.follower_only_mode_select_div,r.elements.follower_only_mode_select,r.follower_only_mode_list,function(e){if(r.isConnected())switch(e.value){case-1:r.elements.follower_only_mode_fieldset.removeClass("show"),r.tmi_client.followersonlyoff(r.channel_id).catch(o);break;case-2:r.elements.follower_only_mode_fieldset.addClass("show"),r.elements.follower_only_mode_inputnumber.val("");break;default:r.elements.follower_only_mode_fieldset.removeClass("show"),r.tmi_client.followersonly(r.channel_id,e.value).catch(o)}}),r.elements.follower_only_mode_set_button.on1("click",function(e){if(r.isConnected()){var t=r.elements.follower_only_mode_inputnumber.val();r.elements.follower_only_mode_inputnumber[0].validity.valid&&""!==t?r.tmi_client.followersonly(r.channel_id,t).catch(o):r.tmi_client.followersonlyoff(r.channel_id).catch(o)}}),r.elements.slow_mode_set_button.on1("click",function(e){var t=r.elements.slow_mode_inputnumber[0],n=t.value;t.validity.rangeOverflow?n=t.max:(!t.validity.valid||t.value<1)&&(n=!1),r.isConnected()&&(n?r.tmi_client.slow(r.channel_id,n).catch(o):r.tmi_client.slowoff(r.channel_id).catch(o))}),r.elements.slow_mode_inputnumber.on1("input",function(e){"0"===this.value&&(this.value="")}),r.elements.subs_only_mode_checkbox.on1("change",function(e){r.isConnected()&&(this.checked?r.tmi_client.subscribers(r.channel_id).catch(o):r.tmi_client.subscribersoff(r.channel_id).catch(o))}),r.elements.r9k_mode_checkbox.on1("change",function(e){r.isConnected()&&(this.checked?r.tmi_client.r9kbeta(r.channel_id).catch(o):r.tmi_client.r9kbetaoff(r.channel_id).catch(o))}),r.elements.emote_only_mode_checkbox.on1("change",function(e){r.isConnected()&&(this.checked?r.tmi_client.emoteonly(r.channel_id).catch(o):r.tmi_client.emoteonlyoff(r.channel_id).catch(o))}),r.elements.clear_chat_button.on1("click",function(e){r.isConnected()&&r.tmi_client.clear(r.channel_id).catch(o)})},r.getFollowers=function(t){r.api("follows",{data:{first:"1"}}).done(function(e){e?(t(e.total||0),r.showFollowerCounter(e.total)):chat.systemMessage(r.name,"Failed to retrieve number of followers.")}).fail(function(){chat.systemMessage(r.name,"Failed to retrieve number of followers.")})},r.getSubscribers=function(t){r.api("subscriptions",{data:{first:"1"}}).done(function(e){e?t(e.total||0):(t(0),chat.systemMessage(r.name,"Failed to retrieve number of subscribers."))}).fail(function(){t(0),chat.systemMessage(r.name,"Failed to retrieve number of subscribers.")})},r.timer.connect=new Timer(r.connect,3e4),r.timer.chatter_list=new Timer(r.listChatters),r.timer.get_stream_status=new Timer(r.getStreamStatus,6e4),r.timer.get_game_list=new Timer(function(){r.get_game_list_queue&&r.getGameList()},3e3),r.timer.follower_alert=new Timer(6e4),r.timer.send_message_queue=new Timer(r.processSendMessageQueue,350),r}select_list.openList=function(t,n,o){var e=elements.select_list_ul;select_list.closeList(),select_list.current_open_list_obj=t;for(var i=0;i<n.length;++i)e.append($("<li></li>").html(n[i].html));e.addClass("show"),e.scrollTop(0);var s=t.offset(),a=s.top+t.outerHeight();a+e.outerHeight()>window.innerHeight&&(a=window.innerHeight-e.outerHeight()),e.css({left:s.left,top:a,width:t.outerWidth()});var r=e.children();r.on1("click",function(e){t.current_selected=r.index(this),o(n[t.current_selected],t.current_selected),select_list.closeList(),e.stopPropagation()}),r.on1("mousedown",function(e){return e.stopPropagation(),!1}),t.on1("mousedown",function(e){e.stopPropagation()}),e.on1("mousedown",function(e){return e.stopPropagation(),!1}),$win.on1("mousedown.open_list",function(e){return o(null),select_list.closeList(),e.stopPropagation(),!1})},select_list.closeList=function(){var e=elements.select_list_ul;e.removeClass("show"),e.empty(),e.off("mousedown"),$win.off("mousedown.open_list"),select_list.current_open_list_obj&&(select_list.current_open_list_obj.off("mousedown"),select_list.current_open_list_obj=null)},select_list.initSelectList=function(e,n,o,i){o.length&&n.html(o[0].selected_html||o[0].html),n.select_list=o,n.current_selected=0,n.getSelected=function(){return o[n.current_selected]},n.selectByIndex=function(e){o.length&&(e<0&&e>=n.select_list&&(e=0),n.current_selected=e,n.html(o[e].selected_html||o[e].html))},n.selectByIndexTrigger=function(e){n.selectByIndex(e),i(o[e])},n.selectByText=function(e){for(var t=n.current_selected=0;t<o.length;++t)if(e===o[t].selected_html||e===o[t].html){n.current_selected=t;break}n.html(o[n.current_selected].selected_html||o[n.current_selected].html)},e.on1("click",function(e){var t="show";n.toggleClass(t),n.hasClass(t)?select_list.openList(n,o,function(e){n.removeClass(t),null!==e&&(n.html(e.selected_html||e.html),i(e))}):select_list.closeList()})},function s(a,r,l){function u(t,e){if(!r[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=r[t]={exports:{}};a[t][0].call(i.exports,function(e){return u(a[t][1][e]||e)},i,i.exports,s,a,r,l)}return r[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,n){"use strict";t.exports={client:e("./lib/client"),Client:e("./lib/client")}},{"./lib/client":3}],2:[function(e,t,n){"use strict";var l=e("request"),u=e("./utils");t.exports=function(e,t){var n=void 0!==e.url?e.url:e.uri;if(u.isURL(n)||(n="https://api.twitch.tv/kraken"+("/"===n[0]?n:"/"+n)),u.isNode()){var o=u.merge({method:"GET",json:!0},e,{url:n});l(o,t)}else if(u.isExtension()||u.isReactNative()){e=u.merge({url:n,method:"GET",headers:{}},e);var i=new XMLHttpRequest;for(var s in i.open(e.method,e.url,!0),e.headers)i.setRequestHeader(s,e.headers[s]);i.responseType="json",i.addEventListener("load",function(e){4==i.readyState&&(200!=i.status?t(i.status,null,null):t(null,null,i.response))}),i.send()}else{var a=document.createElement("script"),r="jsonp_callback_"+Math.round(1e5*Math.random());window[r]=function(e){delete window[r],document.body.removeChild(a),t(null,null,e)},a.src=n+(n.includes("?")?"&":"?")+"callback="+r,document.body.appendChild(a)}}},{"./utils":9,request:10}],3:[function(l,u,e){(function(e){"use strict";var t=l("./api"),n=l("./commands"),o=l("./events").EventEmitter,i=l("./logger"),q=l("./parser"),W=l("./timer"),s=(void 0!==e?e:"undefined"!=typeof window?window:{}).WebSocket||l("ws"),K=l("./utils"),a=function e(t){if(this instanceof e==0)return new e(t);this.opts=K.get(t,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=K.get(this.opts.options.clientId,null),this.maxReconnectAttempts=K.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=K.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=K.get(this.opts.connection.reconnect,!1),this.reconnectDecay=K.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=K.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=K.get(this.opts.connection.secure,!1),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;var n="error";this.opts.options.debug&&(n="info"),this.log=this.opts.logger||i;try{i.setLevel(n)}catch(e){}this.opts.channels.forEach(function(e,t,n){n[t]=K.channel(e)}),o.call(this),this.setMaxListeners(0)};for(var r in K.inherits(a,o),a.prototype.emits=function(e,t){for(var n=0;n<e.length;n++){var o=n<t.length?t[n]:t[t.length-1];this.emit.apply(this,[e[n]].concat(o))}},a.prototype.off=a.prototype.removeListener,a.prototype.api=t,n)a.prototype[r]=n[r];a.prototype.handleMessage=function(t){var n=this;if(!K.isNull(t)){this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(t)),t);var e=K.channel(K.get(t.params[0],null)),o=K.get(t.params[1],null),i=K.get(t.tags["msg-id"],null);if(t.tags=q.badges(q.badgeInfo(q.emotes(t.tags))),t.tags){var s=t.tags;for(var a in s)if("emote-sets"!==a&&"ban-duration"!==a&&"bits"!==a){var r=s[a];K.isBoolean(r)?r=null:"1"===r?r=!0:"0"===r?r=!1:K.isString(r)&&(r=K.unescapeIRC(r)),s[a]=r}}if(K.isNull(t.prefix))switch(t.command){case"PING":this.emit("ping"),K.isNull(this.ws)||1!==this.ws.readyState||this.ws.send("PONG");break;case"PONG":var l=new Date;this.currentLatency=(l.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn("Could not parse message with no prefix:\n"+JSON.stringify(t,null,4))}else if("tmi.twitch.tv"===t.prefix)switch(t.command){case"002":case"003":case"004":case"375":case"376":case"CAP":break;case"001":this.username=t.params[0];break;case"372":this.log.info("Connected to server."),this.userstate["#tmijs"]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(function(){K.isNull(n.ws)||1!==n.ws.readyState||n.ws.send("PING"),n.latency=new Date,n.pingTimeout=setTimeout(function(){K.isNull(n.ws)||(n.wasCloseCalled=!1,n.log.error("Ping timeout."),n.ws.close(),clearInterval(n.pingLoop),clearTimeout(n.pingTimeout))},K.get(n.opts.connection.timeout,9999))},6e4);var u=K.get(this.opts.options.joinInterval,2e3);u<300&&(u=300);var c=new W.queue(u),d=K.union(this.opts.channels,this.channels);this.channels=[];for(var m=function(){var e=d[p];c.add(function(){K.isNull(n.ws)||1!==n.ws.readyState||n.join(e).catch(function(e){return n.log.error(e)})})},p=0;p<d.length;p++)m();c.run();break;case"NOTICE":var f=[null],g=[e,i,o],_=[e,!0],h=[e,!1],v=[g,f],b=[g,[i]],y="["+e+"] "+o;switch(i){case"subs_on":this.log.info("["+e+"] This room is now in subscribers-only mode."),this.emits(["subscriber","subscribers","_promiseSubscribers"],[_,_,f]);break;case"subs_off":this.log.info("["+e+"] This room is no longer in subscribers-only mode."),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[h,h,f]);break;case"emote_only_on":this.log.info("["+e+"] This room is now in emote-only mode."),this.emits(["emoteonly","_promiseEmoteonly"],[_,f]);break;case"emote_only_off":this.log.info("["+e+"] This room is no longer in emote-only mode."),this.emits(["emoteonly","_promiseEmoteonlyoff"],[h,f]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":case"already_followers_off":case"usage_followers_off":case"already_followers_on":case"usage_followers_on":this.emit("notice",e,i,o);break;case"r9k_on":this.log.info("["+e+"] This room is now in r9k mode."),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[_,_,f]);break;case"r9k_off":this.log.info("["+e+"] This room is no longer in r9k mode."),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[h,h,f]);break;case"room_mods":var w=o.split(": ")[1].toLowerCase().split(", ").filter(function(e){return e});this.emits(["_promiseMods","mods"],[[null,w],[e,w]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[e,[]]]);break;case"vips_success":o.endsWith(".")&&(o=o.slice(0,-1));var k=o.split(": ")[1].toLowerCase().split(", ").filter(function(e){return e});this.emits(["_promiseVips","vips"],[[null,k],[e,k]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[e,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(y),this.emits(["notice","_promiseBan"],b);break;case"ban_success":this.log.info(y),this.emits(["notice","_promiseBan"],v);break;case"usage_clear":this.log.info(y),this.emits(["notice","_promiseClear"],b);break;case"usage_mods":this.log.info(y),this.emits(["notice","_promiseMods"],[g,[i,[]]]);break;case"mod_success":this.log.info(y),this.emits(["notice","_promiseMod"],v);break;case"usage_vips":this.log.info(y),this.emits(["notice","_promiseVips"],[g,[i,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_achievement_incomplete":this.log.info(y),this.emits(["notice","_promiseVip"],[g,[i,[]]]);break;case"vip_success":this.log.info(y),this.emits(["notice","_promiseVip"],v);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(y),this.emits(["notice","_promiseMod"],b);break;case"unmod_success":this.log.info(y),this.emits(["notice","_promiseUnmod"],v);break;case"unvip_success":this.log.info(y),this.emits(["notice","_promiseUnvip"],v);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(y),this.emits(["notice","_promiseUnmod"],b);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(y),this.emits(["notice","_promiseUnvip"],b);break;case"color_changed":this.log.info(y),this.emits(["notice","_promiseColor"],v);break;case"usage_color":case"turbo_only_color":this.log.info(y),this.emits(["notice","_promiseColor"],b);break;case"commercial_success":this.log.info(y),this.emits(["notice","_promiseCommercial"],v);break;case"usage_commercial":case"bad_commercial_error":this.log.info(y),this.emits(["notice","_promiseCommercial"],b);break;case"hosts_remaining":this.log.info(y);var x=isNaN(o[0])?0:parseInt(o[0]);this.emits(["notice","_promiseHost"],[g,[null,~~x]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(y),this.emits(["notice","_promiseHost"],[g,[i,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(y),this.emits(["notice","_promiseR9kbeta"],b);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(y),this.emits(["notice","_promiseR9kbetaoff"],b);break;case"timeout_success":this.log.info(y),this.emits(["notice","_promiseTimeout"],v);break;case"delete_message_success":this.log.info("["+e+" "+o+"]"),this.emits(["notice","_promiseDeletemessage"],v);case"already_subs_off":case"usage_subs_off":this.log.info(y),this.emits(["notice","_promiseSubscribersoff"],b);break;case"already_subs_on":case"usage_subs_on":this.log.info(y),this.emits(["notice","_promiseSubscribers"],b);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(y),this.emits(["notice","_promiseEmoteonlyoff"],b);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(y),this.emits(["notice","_promiseEmoteonly"],b);break;case"usage_slow_on":this.log.info(y),this.emits(["notice","_promiseSlow"],b);break;case"usage_slow_off":this.log.info(y),this.emits(["notice","_promiseSlowoff"],b);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(y),this.emits(["notice","_promiseTimeout"],b);break;case"untimeout_success":case"unban_success":this.log.info(y),this.emits(["notice","_promiseUnban"],v);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(y),this.emits(["notice","_promiseUnban"],b);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(y),this.emits(["notice","_promiseDeletemessage"],b);break;case"usage_unhost":case"not_hosting":this.log.info(y),this.emits(["notice","_promiseUnhost"],b);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(y),this.emits(["notice","_promiseWhisper"],b);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(y),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff"],[g,[i,e]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(y),this.emit("automod",e,i,o);break;case"unrecognized_cmd":this.log.info(y),this.emit("notice",e,i,o);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(y),this.emit("notice",e,i,o);break;case"host_on":case"host_off":break;default:o.includes("Login unsuccessful")||o.includes("Login authentication failed")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=o,this.log.error(this.reason),this.ws.close()):o.includes("Error logging in")||o.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=o,this.log.error(this.reason),this.ws.close()):o.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn("Could not parse NOTICE from tmi.twitch.tv:\n"+JSON.stringify(t,null,4)),this.emit("notice",e,i,o))}break;case"USERNOTICE":var C=t.tags["display-name"]||t.tags.login,E=t.tags["msg-param-sub-plan"]||"",S=K.unescapeIRC(K.get(t.tags["msg-param-sub-plan-name"],""))||null,T={prime:E.includes("Prime"),plan:E,planName:S},$=t.tags,M=~~(t.tags["msg-param-streak-months"]||0),A=t.tags["msg-param-recipient-display-name"]||t.tags["msg-param-recipient-user-name"],P=~~t.tags["msg-param-mass-gift-count"];switch($["message-type"]=i){case"resub":this.emits(["resub","subanniversary"],[[e,C,M,o,$,T]]);break;case"sub":this.emit("subscription",e,C,T,o,$);break;case"subgift":this.emit("subgift",e,C,M,A,T,$);break;case"anonsubgift":this.emit("anonsubgift",e,M,A,T,$);break;case"submysterygift":this.emit("submysterygift",e,C,P,T,$);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",e,P,T,$);break;case"primepaidupgrade":this.emit("primepaidupgrade",e,C,T,$);break;case"giftpaidupgrade":var O=t.tags["msg-param-sender-name"]||t.tags["msg-param-sender-login"];this.emit("giftpaidupgrade",e,C,O,$);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",e,C,$);break;case"raid":C=t.tags["msg-param-displayName"]||t.tags["msg-param-login"];var I=+t.tags["msg-param-viewerCount"];this.emit("raided",e,C,I,$)}break;case"HOSTTARGET":var L=o.split(" ");I=~~L[1]||0;"-"===L[0]?(this.log.info("["+e+"] Exited host mode."),this.emits(["unhost","_promiseUnhost"],[[e,I],[null]])):(this.log.info("["+e+"] Now hosting "+L[0]+" for "+I+" viewer(s)."),this.emit("hosting",e,L[0],I));break;case"CLEARCHAT":if(1<t.params.length){var N=K.get(t.tags["ban-duration"],null);K.isNull(N)?(this.log.info("["+e+"] "+o+" has been banned."),this.emit("ban",e,o,null,t.tags)):(this.log.info("["+e+"] "+o+" has been timed out for "+N+" seconds."),this.emit("timeout",e,o,null,~~N,t.tags))}else this.log.info("["+e+"] Chat was cleared by a moderator."),this.emits(["clearchat","_promiseClear"],[[e],[null]]);break;case"CLEARMSG":if(1<t.params.length){C=t.tags.login;var D=o;($=t.tags)["message-type"]="messagedeleted",this.log.info("["+e+"] "+C+"'s message has been deleted."),this.emit("messagedeleted",e,C,D,$)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info("Disconnecting and reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.disconnect(),setTimeout(function(){return n.connect()},this.reconnectTimer);break;case"USERSTATE":t.tags.username=this.username,"mod"===t.tags["user-type"]&&(this.moderators[this.lastJoined]||(this.moderators[this.lastJoined]=[]),this.moderators[this.lastJoined].includes(this.username)||this.moderators[this.lastJoined].push(this.username)),K.isJustinfan(this.getUsername())||this.userstate[e]||(this.userstate[e]=t.tags,this.lastJoined=e,this.channels.push(e),this.log.info("Joined "+e),this.emit("join",e,K.username(this.getUsername()),!0)),t.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(t.tags["emote-sets"]),this.userstate[e]=t.tags;break;case"GLOBALUSERSTATE":this.globaluserstate=t.tags,void 0!==t.tags["emote-sets"]&&this._updateEmoteset(t.tags["emote-sets"]);break;case"ROOMSTATE":if(K.channel(this.lastJoined)===e&&this.emit("_promiseJoin",null,e),t.tags.channel=e,this.emit("roomstate",e,t.tags),!t.tags.hasOwnProperty("subs-only")){if(t.tags.hasOwnProperty("slow"))if("boolean"!=typeof t.tags.slow||t.tags.slow){var U=[e,!0,~~t.tags.slow];this.log.info("["+e+"] This room is now in slow mode."),this.emits(["slow","slowmode","_promiseSlow"],[U,U,[null]])}else{var j=[e,!1,0];this.log.info("["+e+"] This room is no longer in slow mode."),this.emits(["slow","slowmode","_promiseSlowoff"],[j,j,[null]])}if(t.tags.hasOwnProperty("followers-only"))if("-1"===t.tags["followers-only"]){j=[e,!1,0];this.log.info("["+e+"] This room is no longer in followers-only mode."),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[j,j,[null]])}else{U=[e,!0,~~t.tags["followers-only"]];this.log.info("["+e+"] This room is now in follower-only mode."),this.emits(["followersonly","followersmode","_promiseFollowers"],[U,U,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn("Could not parse message from tmi.twitch.tv:\n"+JSON.stringify(t,null,4))}else if("jtv"===t.prefix)switch(t.command){case"MODE":"+o"===o?(this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(t.params[2])||this.moderators[e].push(t.params[2]),this.emit("mod",e,t.params[2])):"-o"===o&&(this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].filter(function(e){return e!=t.params[2]}),this.emit("unmod",e,t.params[2]));break;default:this.log.warn("Could not parse message from jtv:\n"+JSON.stringify(t,null,4))}else switch(t.command){case"353":this.emit("names",t.params[2],t.params[3].split(" "));break;case"366":break;case"JOIN":var F=t.prefix.split("!")[0];K.isJustinfan(this.getUsername())&&this.username===F&&(this.lastJoined=e,this.channels.push(e),this.log.info("Joined "+e),this.emit("join",e,F,!0)),this.username!==F&&this.emit("join",e,F,!1);break;case"PART":var R,B=!1;F=t.prefix.split("!")[0];if(this.username===F)B=!0,this.userstate[e]&&delete this.userstate[e],-1!==(R=this.channels.indexOf(e))&&this.channels.splice(R,1),-1!==(R=this.opts.channels.indexOf(e))&&this.opts.channels.splice(R,1),this.log.info("Left "+e),this.emit("_promisePart",null);this.emit("part",e,F,B);break;case"WHISPER":F=t.prefix.split("!")[0];this.log.info("[WHISPER] <"+F+">: "+o),t.tags.hasOwnProperty("username")||(t.tags.username=F),t.tags["message-type"]="whisper";var G=K.channel(t.tags.username);this.emits(["whisper","message"],[[G,t.tags,o,!1]]);break;case"PRIVMSG":if(t.tags.username=t.prefix.split("!")[0],"jtv"===t.tags.username){var H=K.username(o.split(" ")[0]),V=o.includes("auto");if(o.includes("hosting you for")){var z=K.extractNumber(o);this.emit("hosted",e,H,z,V)}else o.includes("hosting you")&&this.emit("hosted",e,H,0,V)}else{var J=K.actionMessage(o);t.tags["message-type"]=J?"action":"chat",o=J?J[1]:o,t.tags.hasOwnProperty("bits")?this.emit("cheer",e,t.tags,o):J?(this.log.info("["+e+"] *<"+t.tags.username+">: "+o),this.emits(["action","message"],[[e,t.tags,o,!1]])):(this.log.info("["+e+"] <"+t.tags.username+">: "+o),this.emits(["chat","message"],[[e,t.tags,o,!1]]))}break;default:this.log.warn("Could not parse message:\n"+JSON.stringify(t,null,4))}}},a.prototype.connect=function(){var o=this;return new Promise(function(t,n){o.server=K.get(o.opts.connection.server,"irc-ws.chat.twitch.tv"),o.port=K.get(o.opts.connection.port,80),o.secure&&(o.port=443),443===o.port&&(o.secure=!0),o.reconnectTimer=o.reconnectTimer*o.reconnectDecay,o.reconnectTimer>=o.maxReconnectInterval&&(o.reconnectTimer=o.maxReconnectInterval),o._openConnection(),o.once("_promiseConnect",function(e){e?n(e):t([o.server,~~o.port])})})},a.prototype._openConnection=function(){this.ws=new s((this.secure?"wss":"ws")+"://"+this.server+":"+this.port+"/","irc"),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},a.prototype._onOpen=function(){var n=this;K.isNull(this.ws)||1!==this.ws.readyState||(this.log.info("Connecting to "+this.server+" on port "+this.port+".."),this.emit("connecting",this.server,~~this.port),this.username=K.get(this.opts.identity.username,K.justinfan()),this._getToken().then(function(e){var t=K.password(e);n.log.info("Sending authentication to server.."),n.emit("logon"),n.ws.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership"),t&&n.ws.send("PASS "+t),n.ws.send("NICK "+n.username)}).catch(function(e){n.emits(["_promiseConnect","disconnected"],[[e],["Could not get a token."]])}))},a.prototype._getToken=function(){var e=this.opts.identity.password,t=void 0;return"function"==typeof e?(t=e())instanceof Promise?t:Promise.resolve(t):Promise.resolve(e)},a.prototype._onMessage=function(e){var t=this;e.data.split("\r\n").forEach(function(e){K.isNull(e)||t.handleMessage(q.msg(e))})},a.prototype._onError=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.reason=K.isNull(this.ws)?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.emit("reconnect"),setTimeout(function(){e.reconnecting=!1,e.connect()},this.reconnectTimer)),this.ws=null},a.prototype._onClose=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Could not connect to server. Reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.emit("reconnect"),setTimeout(function(){e.reconnecting=!1,e.connect()},this.reconnectTimer))),this.ws=null},a.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},a.prototype._sendCommand=function(o,i,s,a){var r=this;return new Promise(function(e,t){if(K.isNull(r.ws)||1!==r.ws.readyState)return t("Not connected to server.");if("number"==typeof o&&K.promiseDelay(o).then(function(){return t("No response from Twitch.")}),K.isNull(i))r.log.info("Executing command: "+s),r.ws.send(s);else{var n=K.channel(i);r.log.info("["+n+"] Executing command: "+s),r.ws.send("PRIVMSG "+n+" :"+s)}a(e,t)})},a.prototype._sendMessage=function(r,l,u,c){var d=this;return new Promise(function(e,t){if(K.isNull(d.ws)||1!==d.ws.readyState)return t("Not connected to server.");if(K.isJustinfan(d.getUsername()))return t("Cannot send anonymous messages.");var n=K.channel(l);if(d.userstate[n]||(d.userstate[n]={}),500<=u.length){var o=K.splitLine(u,500);u=o[0],setTimeout(function(){d._sendMessage(r,l,o[1],function(){})},350)}d.ws.send("PRIVMSG "+n+" :"+u);var i={};Object.keys(d.emotesets).forEach(function(e){return d.emotesets[e].forEach(function(e){return(K.isRegex(e.code)?q.emoteRegex:q.emoteString)(u,e.code,e.id,i)})});var s=K.merge(d.userstate[n],q.emotes({emotes:q.transformEmotes(i)||null})),a=K.actionMessage(u);a?(s["message-type"]="action",d.log.info("["+n+"] *<"+d.getUsername()+">: "+a[1]),d.emits(["action","message"],[[n,s,a[1],!0]])):(s["message-type"]="chat",d.log.info("["+n+"] <"+d.getUsername()+">: "+u),d.emits(["chat","message"],[[n,s,u,!0]])),c(e,t)})},a.prototype._updateEmoteset=function(e){this.emotes=e,this.emit("emotesets",e)},a.prototype.getUsername=function(){return this.username},a.prototype.getOptions=function(){return this.opts},a.prototype.getChannels=function(){return this.channels},a.prototype.isMod=function(e,t){var n=K.channel(e);return this.moderators[n]||(this.moderators[n]=[]),this.moderators[n].includes(K.username(t))},a.prototype.readyState=function(){return K.isNull(this.ws)?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},a.prototype.disconnect=function(){var n=this;return new Promise(function(e,t){K.isNull(n.ws)||3===n.ws.readyState?(n.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),t("Cannot disconnect from server. Socket is not opened or connection is already closing.")):(n.wasCloseCalled=!0,n.log.info("Disconnecting from server.."),n.ws.close(),n.once("_promiseDisconnect",function(){return e([n.server,~~n.port])}))})},void 0!==u&&u.exports&&(u.exports=a),"undefined"!=typeof window&&(window.tmi={},window.tmi.client=a,window.tmi.Client=a)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./api":2,"./commands":4,"./events":5,"./logger":6,"./parser":7,"./timer":8,"./utils":9,ws:10}],4:[function(e,t,n){"use strict";function o(o,i){var e=this;return o=c.channel(o),i=c.get(i,30),this._sendCommand(this._getPromiseDelay(),o,"/followers "+i,function(t,n){e.once("_promiseFollowers",function(e){e?n(e):t([o,~~i])})})}function i(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/followersoff",function(t,n){e.once("_promiseFollowersoff",function(e){e?n(e):t([o])})})}function s(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),null,"PART "+o,function(t,n){e.once("_promisePart",function(e){e?n(e):t([o])})})}function a(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/r9kbeta",function(t,n){e.once("_promiseR9kbeta",function(e){e?n(e):t([o])})})}function r(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/r9kbetaoff",function(t,n){e.once("_promiseR9kbetaoff",function(e){e?n(e):t([o])})})}function l(o,i){var e=this;return o=c.channel(o),i=c.get(i,300),this._sendCommand(this._getPromiseDelay(),o,"/slow "+i,function(t,n){e.once("_promiseSlow",function(e){e?n(e):t([o,~~i])})})}function u(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/slowoff",function(t,n){e.once("_promiseSlowoff",function(e){e?n(e):t([o])})})}var c=e("./utils");t.exports={action:function(n,o){return n=c.channel(n),o="ACTION "+o+"",this._sendMessage(this._getPromiseDelay(),n,o,function(e,t){e([n,o])})},ban:function(o,i,s){var e=this;return o=c.channel(o),i=c.username(i),s=c.get(s,""),this._sendCommand(this._getPromiseDelay(),o,"/ban "+i+" "+s,function(t,n){e.once("_promiseBan",function(e){e?n(e):t([o,i,s])})})},clear:function(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/clear",function(t,n){e.once("_promiseClear",function(e){e?n(e):t([o])})})},color:function(e,o){var i=this;return o=c.get(o,e),this._sendCommand(this._getPromiseDelay(),"#tmijs","/color "+o,function(t,n){i.once("_promiseColor",function(e){e?n(e):t([o])})})},commercial:function(o,i){var e=this;return o=c.channel(o),i=c.get(i,30),this._sendCommand(this._getPromiseDelay(),o,"/commercial "+i,function(t,n){e.once("_promiseCommercial",function(e){e?n(e):t([o,~~i])})})},deletemessage:function(o,e){var i=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/delete "+e,function(t,n){i.once("_promiseDeletemessage",function(e){e?n(e):t([o])})})},emoteonly:function(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/emoteonly",function(t,n){e.once("_promiseEmoteonly",function(e){e?n(e):t([o])})})},emoteonlyoff:function(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/emoteonlyoff",function(t,n){e.once("_promiseEmoteonlyoff",function(e){e?n(e):t([o])})})},followersonly:o,followersmode:o,followersonlyoff:i,followersmodeoff:i,host:function(i,s){var e=this;return i=c.channel(i),s=c.username(s),this._sendCommand(2e3,i,"/host "+s,function(n,o){e.once("_promiseHost",function(e,t){e?o(e):n([i,s,~~t])})})},join:function(r){var l=this;return r=c.channel(r),this._sendCommand(null,null,"JOIN "+r,function(o,i){var s="_promiseJoin",a=!1;l.on(s,function e(t,n){r===c.channel(n)&&(l.removeListener(s,e),a=!0,t?i(t):o([r]))});var e=l._getPromiseDelay();c.promiseDelay(e).then(function(){a||l.emit(s,"No response from Twitch.",r)})})},mod:function(o,i){var e=this;return o=c.channel(o),i=c.username(i),this._sendCommand(this._getPromiseDelay(),o,"/mod "+i,function(t,n){e.once("_promiseMod",function(e){e?n(e):t([o,i])})})},mods:function(i){var s=this;return i=c.channel(i),this._sendCommand(this._getPromiseDelay(),i,"/mods",function(n,o){s.once("_promiseMods",function(e,t){e?o(e):(t.forEach(function(e){s.moderators[i]||(s.moderators[i]=[]),s.moderators[i].includes(e)||s.moderators[i].push(e)}),n(t))})})},part:s,leave:s,ping:function(){var n=this;return this._sendCommand(this._getPromiseDelay(),null,"PING",function(t,e){n.latency=new Date,n.pingTimeout=setTimeout(function(){null!==n.ws&&(n.wasCloseCalled=!1,n.log.error("Ping timeout."),n.ws.close(),clearInterval(n.pingLoop),clearTimeout(n.pingTimeout))},c.get(n.opts.connection.timeout,9999)),n.once("_promisePing",function(e){return t([parseFloat(e)])})})},r9kbeta:a,r9kmode:a,r9kbetaoff:r,r9kmodeoff:r,raw:function(n){return this._sendCommand(this._getPromiseDelay(),null,n,function(e,t){e([n])})},say:function(n,o){return n=c.channel(n),o.startsWith(".")&&!o.startsWith("..")||o.startsWith("/")||o.startsWith("\\")?"me "===o.substr(1,3)?this.action(n,o.substr(4)):this._sendCommand(this._getPromiseDelay(),n,o,function(e,t){e([n,o])}):this._sendMessage(this._getPromiseDelay(),n,o,function(e,t){e([n,o])})},slow:l,slowmode:l,slowoff:u,slowmodeoff:u,subscribers:function(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/subscribers",function(t,n){e.once("_promiseSubscribers",function(e){e?n(e):t([o])})})},subscribersoff:function(o){var e=this;return o=c.channel(o),this._sendCommand(this._getPromiseDelay(),o,"/subscribersoff",function(t,n){e.once("_promiseSubscribersoff",function(e){e?n(e):t([o])})})},timeout:function(o,i,s,a){var e=this;return o=c.channel(o),i=c.username(i),c.isNull(s)||c.isInteger(s)||(a=s,s=300),s=c.get(s,300),a=c.get(a,""),this._sendCommand(this._getPromiseDelay(),o,"/timeout "+i+" "+s+" "+a,function(t,n){e.once("_promiseTimeout",function(e){e?n(e):t([o,i,~~s,a])})})},unban:function(o,i){var e=this;return o=c.channel(o),i=c.username(i),this._sendCommand(this._getPromiseDelay(),o,"/unban "+i,function(t,n){e.once("_promiseUnban",function(e){e?n(e):t([o,i])})})},unhost:function(o){var e=this;return o=c.channel(o),this._sendCommand(2e3,o,"/unhost",function(t,n){e.once("_promiseUnhost",function(e){e?n(e):t([o])})})},unmod:function(o,i){var e=this;return o=c.channel(o),i=c.username(i),this._sendCommand(this._getPromiseDelay(),o,"/unmod "+i,function(t,n){e.once("_promiseUnmod",function(e){e?n(e):t([o,i])})})},unvip:function(o,i){var e=this;return o=c.channel(o),i=c.username(i),this._sendCommand(this._getPromiseDelay(),o,"/unvip "+i,function(t,n){e.once("_promiseUnvip",function(e){e?n(e):t([o,i])})})},vip:function(o,i){var e=this;return o=c.channel(o),i=c.username(i),this._sendCommand(this._getPromiseDelay(),o,"/vip "+i,function(t,n){e.once("_promiseVip",function(e){e?n(e):t([o,i])})})},vips:function(e){var t=this;return e=c.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/vips",function(n,o){t.once("_promiseVips",function(e,t){e?o(e):n(t)})})},whisper:function(i,s){var a=this;return(i=c.username(i))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(this._getPromiseDelay(),"#tmijs","/w "+i+" "+s,function(e,t){var n=c.channel(i),o=c.merge({"message-type":"whisper","message-id":null,"thread-id":null,username:a.getUsername()},a.globaluserstate);a.emits(["whisper","message"],[[n,o,s,!0],[n,o,s,!0]]),e([i,s])})}}},{"./utils":9}],5:[function(e,t,n){"use strict";function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(e){return"function"==typeof e}function u(e){return"object"===(void 0===e?"undefined":i(e))&&null!==e}function r(e){return void 0===e}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};((t.exports=o).EventEmitter=o).prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.prototype.emit=function(e){var t,n,o,i,s,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r(n=this._events[e]))return!1;if(l(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(u(n))for(i=Array.prototype.slice.call(arguments,1),o=(a=n.slice()).length,s=0;s<o;s++)a[s].apply(this,i);return!0},o.prototype.on=o.prototype.addListener=function(e,t){var n;if(!l(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,l(t.listener)?t.listener:t),this._events[e]?u(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,u(this._events[e])&&!this._events[e].warned&&((n=r(this._maxListeners)?o.defaultMaxListeners:this._maxListeners)&&0<n&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},o.prototype.once=function(e,t){function n(){"_"!==e.charAt(0)||isNaN(e.substr(e.length-1))||(e=e.substring(0,e.length-1)),this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!l(t))throw TypeError("listener must be a function");var o=!1;if(this._events.hasOwnProperty(e)&&"_"===e.charAt(0)){var i=1,s=e;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(s)&&i++;e+=i}return n.listener=t,this.on(e,n),this},o.prototype.removeListener=function(e,t){var n,o,i,s;if(!l(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(n=this._events[e]).length,o=-1,n===t||l(n.listener)&&n.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&"_"===e.charAt(0)){var a=e;for(var r in this._events)this._events.hasOwnProperty(r)&&r.startsWith(a)&&(isNaN(parseInt(r.substr(r.length-1)))||(this._events[e+parseInt(r.substr(r.length-1)-1)]=this._events[r],delete this._events[r]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(u(n)){for(s=i;0<s--;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},o.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(l(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},o.prototype.listeners=function(e){return this._events&&this._events[e]?l(this._events[e])?[this._events[e]]:this._events[e].slice():[]},o.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(l(t))return 1;if(t)return t.length}return 0},o.listenerCount=function(e,t){return e.listenerCount(t)}},{}],6:[function(e,t,n){"use strict";function o(t){return function(e){a[s]<=a[t]&&console.log("["+i.formatDate(new Date)+"] "+t+": "+e)}}var i=e("./utils"),s="info",a={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};t.exports={setLevel:function(e){s=e},trace:o("trace"),debug:o("debug"),info:o("info"),warn:o("warn"),error:o("error"),fatal:o("fatal")}},{"./utils":9}],7:[function(e,t,n){"use strict";function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:",",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"/",i=arguments[4],s=e[t];if(void 0===s)return e;var a=d.isString(s);if(e[t+"-raw"]=a?s:null,!0===s)return e[t]=null,e;if(e[t]={},a)for(var r=s.split(n),l=0;l<r.length;l++){var u=r[l].split(o),c=u[1];void 0!==i&&c&&(c=c.split(i)),e[t][u[0]]=c||null}return e}var d=e("./utils"),a=/\S+/g;t.exports={badges:function(e){return o(e,"badges")},badgeInfo:function(e){return o(e,"badge-info")},emotes:function(e){return o(e,"emotes","/",":",",")},emoteRegex:function(e,t,n,o){a.lastIndex=0;for(var i,s=new RegExp("(\\b|^|s)"+d.unescapeHtml(t)+"(\\b|$|s)");null!==(i=a.exec(e));)s.test(i[0])&&(o[n]=o[n]||[],o[n].push([i.index,a.lastIndex-1]))},emoteString:function(e,t,n,o){a.lastIndex=0;for(var i;null!==(i=a.exec(e));)i[0]===d.unescapeHtml(t)&&(o[n]=o[n]||[],o[n].push([i.index,a.lastIndex-1]))},transformEmotes:function(t){var n="";return Object.keys(t).forEach(function(e){n=n+e+":",t[e].forEach(function(e){return n=n+e.join("-")+","}),n=n.slice(0,-1)+"/"}),n.slice(0,-1)},msg:function(e){var t={raw:e,tags:{},prefix:null,command:null,params:[]},n=0,o=0;if(64===e.charCodeAt(0)){if(-1===(o=e.indexOf(" ")))return null;for(var i=e.slice(1,o).split(";"),s=0;s<i.length;s++){var a=i[s],r=a.split("=");t.tags[r[0]]=a.substring(a.indexOf("=")+1)||!0}n=o+1}for(;32===e.charCodeAt(n);)n++;if(58===e.charCodeAt(n)){if(-1===(o=e.indexOf(" ",n)))return null;for(t.prefix=e.slice(n+1,o),n=o+1;32===e.charCodeAt(n);)n++}if(-1===(o=e.indexOf(" ",n)))return e.length>n?(t.command=e.slice(n),t):null;for(t.command=e.slice(n,o),n=o+1;32===e.charCodeAt(n);)n++;for(;n<e.length;){if(o=e.indexOf(" ",n),58===e.charCodeAt(n)){t.params.push(e.slice(n+1));break}if(-1===o){if(-1===o){t.params.push(e.slice(n));break}}else for(t.params.push(e.slice(n,o)),n=o+1;32===e.charCodeAt(n);)n++}return t}}},{"./utils":9}],8:[function(e,t,n){"use strict";function o(e){this.queue=[],this.index=0,this.defaultDelay=e||3e3}o.prototype.add=function(e,t){this.queue.push({fn:e,delay:t})},o.prototype.run=function(e){(e||0===e)&&(this.index=e),this.next()},o.prototype.next=function(){var e=this,t=this.index++,n=this.queue[t],o=this.queue[this.index];n&&(n.fn(),o&&setTimeout(function(){e.next()},o.delay||this.defaultDelay))},o.prototype.reset=function(){this.index=0},o.prototype.clear=function(){this.index=0,this.queue=[]},n.queue=o},{}],9:[function(e,l,t){(function(e){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=/^\u0001ACTION ([^\u0001]+)\u0001$/,i=/^(justinfan)(\d+$)/,s=/\\([sn:r\\])/g,a={s:" ",n:"",":":";",r:""},r=l.exports={get:function(e,t){return void 0===e?t:e},isBoolean:function(e){return"boolean"==typeof e},isFinite:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){return isFinite(e)&&!isNaN(parseFloat(e))}),isInteger:function(e){return!isNaN(r.toNumber(e,0))},isJustinfan:function(e){return i.test(e)},isNull:function(e){return null===e},isRegex:function(e){return/[\|\\\^\$\*\+\?\:\#]/.test(e)},isString:function(e){return"string"==typeof e},isURL:function(e){return new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(e)},justinfan:function(){return"justinfan"+Math.floor(8e4*Math.random()+1e3)},token:function(e){return e?e.toLowerCase().replace("oauth:",""):""},password:function(e){var t=r.token(e);return t?"oauth:"+t:""},promiseDelay:function(t){return new Promise(function(e){return setTimeout(e,t)})},replaceAll:function(e,t){if(null==e)return null;for(var n in t)e=e.replace(new RegExp(n,"g"),t[n]);return e},unescapeHtml:function(e){return e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'")},unescapeIRC:function(e){return e&&e.includes("\\")?e.replace(s,function(e,t){return t in a?a[t]:t}):e},actionMessage:function(e){return e.match(o)},addWord:function(e,t){return e.length?e+" "+t:e+t},channel:function(e){var t=(e||"").toLowerCase();return"#"===t[0]?t:"#"+t},extractNumber:function(e){for(var t=e.split(" "),n=0;n<t.length;n++)if(r.isInteger(t[n]))return~~t[n];return 0},formatDate:function(e){var t=e.getHours(),n=e.getMinutes();return(t=(t<10?"0":"")+t)+":"+(n=(n<10?"0":"")+n)},inherits:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},isNode:function(){try{return"object"===(void 0===e?"undefined":t(e))&&"[object process]"===Object.prototype.toString.call(e)}catch(e){}return!1},isExtension:function(){try{return window.chrome&&chrome.runtime&&chrome.runtime.id}catch(e){}return!1},isReactNative:function(){try{return navigator&&"ReactNative"==navigator.product}catch(e){}return!1},merge:Object.assign,splitLine:function(e,t){var n=e.substring(0,t).lastIndexOf(" ");return-1===n&&(n=t-1),[e.substring(0,n),e.substring(n+1)]},toNumber:function(e,t){if(null===e)return 0;var n=Math.pow(10,r.isFinite(t)?t:0);return Math.round(e*n)/n},union:function(e,t){return[].concat(n(new Set([].concat(n(e),n(t)))))},username:function(e){var t=(e||"").toLowerCase();return"#"===t[0]?t.slice(1):t}}}).call(this,e("_process"))},{_process:11}],10:[function(e,t,n){},{}],11:[function(e,t,n){function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(t){if(c===setTimeout)return setTimeout(t,0);if((c===o||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(){g&&p&&(g=!1,p.length?f=p.concat(f):_=-1,f.length&&r())}function r(){if(!g){var e=s(a);g=!0;for(var t=f.length;t;){for(p=f,f=[];++_<t;)p&&p[_].run();_=-1,t=f.length}p=null,g=!1,function(t){if(d===clearTimeout)return clearTimeout(t);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c,d,m=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:o}catch(e){c=o}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var p,f=[],g=!1,_=-1;m.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new l(e,t)),1!==f.length||g||s(r)},l.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=u,m.addListener=u,m.once=u,m.off=u,m.removeListener=u,m.removeAllListeners=u,m.emit=u,m.prependListener=u,m.prependOnceListener=u,m.listeners=function(e){return[]},m.binding=function(e){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(e){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},{}]},{},[1]);var ui={onload:function(){var a=this;a.initDialogPages=function(){a.initDialogPage(".dialog-page-credits","credits.dc720190.css",450,250),a.initDialogPage(".dialog-page-tos","tos.248263e1.css",500,400),a.initDialogPage("#app-menu-announcements","https://forum.speechchat.com/getpost.php?pid=8",500,400)},a.initChatPlatformsUI=function(e){for(var t,n,o=0;o<e.length;++o)n=e[o],$("#live-info-div").append('<ul id="'+n.name+'-live-info-div" class="service-live-info-div"><i class="'+n.name+'-icon service-logo" tooltip="'+n.display_name+'"></i><div id="'+n.name+'-live-status-div" class="live-status-div"><div class="viewer-count-div user-count-div" tooltip="'+n.display_name+' current viewers"><i class="fas fa-user" aria-hidden="true"></i><div class="user-count"></div></div><div class="live-time-div" tooltip="Stream uptime"><i class="far fa-clock" aria-hidden="true"></i><div class="up-time"></div></div></div><div class="follower-count-div user-count-div" tooltip="'+n.display_name+' followers"><i class="fas fa-heart" aria-hidden="true"></i><div class="user-count"></div></div></ul>'),tooltip.applyTooltip($("#"+n.name+"-live-info-div [tooltip]")),n.elements.live_info_div=$("#"+n.name+"-live-info-div"),n.elements.live_status_div=$("#"+n.name+"-live-status-div"),n.elements.viewer_user_count=$("#"+n.name+"-live-status-div>.viewer-count-div>.user-count"),n.elements.follower_user_counut=$("#"+n.name+"-live-info-div>.follower-count-div>.user-count"),n.elements.live_time_div=$("#"+n.name+"-live-status-div>.live-time-div"),n.elements.live_up_time=$("#"+n.name+"-live-status-div>.live-time-div>.up-time"),t=e[o],$("#send-service-menu").append('<input id="send-service-checkbox-'+t.name+'" class="option-checkbox send-service-checkbox" type="checkbox"><label for="send-service-checkbox-'+t.name+'" class="option-label checkbox-label"><i class="'+t.name+'-icon service-logo" tooltip="'+t.display_name+'"></i></label>');$("#live-info-div").on1("click",".service-live-info-div",function(e){$(this).toggleClass("hide"),window[this.id.substring(0,this.id.indexOf("-"))].updateLiveInfoDivWidth()})},a.setChatListHeight=function(){var e=0;elements.hide_v_button.hasClass("show")&&(e+=elements.send_div.outerHeight()+elements.status_div.outerHeight()),elements.chatter_list_div.siblings(".dropdown-title-div").each(function(){e+=$(this).outerHeight(!0)}),elements.chatter_names_div.siblings().each(function(){e+=$(this).outerHeight(!0)}),elements.chatter_names_div.height($body.outerHeight()-e-5-2)},a._createDCDialog=function(t){var n=$("<div class='dcdialog bg-color'>");if(isEmpty(t.css)||n.css(t.css),isEmpty(t.html)||n.html(t.html),t.fullscreen){var o=$("<div class='fullscreen-bg'></div>"),e=$("<div class='center-align-div'></div>");!(n.close=function(){if(o.hasClass("show")){safeCall(t.onClose),o.removeClass("show");var e=$._data(o[0],"events");void 0!==e&&e.hasOwnProperty(e_transitionend)||o.one(e_transitionend,function(e){o.hasClass("show")||(o.remove(),void 0!==n.timeout&&!1!==n.timeout&&clearTimeout(n.timeout))})}})!==t.close_on_click?(o.on1("click.close_dialog",function(e){cancelEvent(e),document.elementFromPoint(e.clientX,e.clientY)===o[0]&&n.close()}),n.on1("pointerdown",capturePointerdown),n.on1("pointerup",capturePointerup)):o.on1("click",cancelEvent),n.on1("click",cancelEvent),o.append(n).append(e),$body.append(o),o[0].offsetHeight,o.addClass("show"),n.addClass("show")}else n.close=function(){if(n.hasClass("show")){safeCall(t.onClose),n.removeClass("show");var e=$._data(n[0],"events");void 0!==e&&e.hasOwnProperty(e_transitionend)||n.one(e_transitionend,function(e){n.hasClass("show")||(n.remove(),void 0!==n.timeout&&!1!==n.timeout&&clearTimeout(n.timeout),n=null)})}},n.on1("click",cancelEvent),isEmpty(t.parent)?$body.append(n):t.parent.append(n),n[0].offsetHeight,n.addClass("show");var i=n.find(".dcdialog-close-button");return i.length&&i.one("click",function(e){n.close()}),isEmpty(t.duration)||(n.timeout=setTimeout(function(){isEmpty(n)||(n.timeout=!1,n.close())},t.duration)),safeCall(t.done,null,n),safeCall(t.always,null,n),n},a.loading_html=$("#loading-div").html(),a._createAjaxDialog=function(e){var t=e.css;e.css=null,e.html=a.loading_html;var o=e.done;delete e.done;var n=e.fail;delete e.fail;var i=e.always;delete e.always;var s=a._createDCDialog(e);return $.ajax(e.ajax).done(function(n){s.addClass("loaded"),s.css(t),s.one(e_transitionend,function(e){s.html($("<div class='dcdialog-container'></div>").html(n)),s[0].offsetHeight,s.addClass("ready"),safeCall(o,null,s);var t=s.find(".dcdialog-close-button");t.length&&t.one("click",function(e){s.close()})})}).fail(function(){s.addClass("loaded"),s.css({width:200,height:70,"text-align":"center"}),s.html("<div class='dcdialog-container'><p>An error occurred.</p><button class='dcdialog-close-button'>OK</button></div>"),s.one(e_transitionend,function(e){s.addClass("ready"),safeCall(n,null,s);var t=s.find(".dcdialog-close-button");t.length&&t.one("click",function(e){s.close()})})}).always(function(){safeCall(i,null,s)}),s},a.createDCDialog=function(e){return isEmpty(e.ajax)?a._createDCDialog(e):a._createAjaxDialog(e)},a.createNoticeDialog=function(e,t){var n={html:"<div class='notice-dialog'><i class='notice-dialog-icon fas fa-exclamation-circle'></i><div class='notice-dialog-message'>"+e+"</div><div class='dcdialog-close-button notice-dialog-close-button'><i class='fas fa-times-circle'></i></div></div><div class='center-align-div'></div>",css:{width:400,height:35,top:0,left:0,right:0,margin:"0 auto",position:"fixed"}};return isEmpty(t)||(n.duration=t),a.createDCDialog(n)},a.initDialogPage=function(e,n,o,i){$(e).on1("click",function(e){var t=a.createDCDialog({ajax:{url:n},css:{width:o,height:i},fullscreen:!0,done:function(){t.addClass("open-page-div")}});return!1})},a.onClickOpenDialog=function(e,t,n){var o=a.createDCDialog({ajax:{url:e},css:{width:t,height:n},fullscreen:!0,done:function(){o.addClass("open-page-div")}});return!1},a.textareaCharCounterSetup=function(t){t.after("<div class='char-counter-container'><span class='char-counter-num'>"+t.val().length+"</span>/<span class='char-counter-max'>"+t[0].maxLength+"</span></div>"),t.on("input",function(e){t.next(".char-counter-container").find(".char-counter-num").text(t.val().length)})},a.initTextareaCharCounter=function(){$(".char-counter").each(function(){a.textareaCharCounterSetup($(this))})},a.autoHideLoadingAnimate=function(){elements.loading_div.on(e_transitionend,function(e){$("body.loading, #loading-div.loading").length||elements.loading_div.css("display","none")})},a.showLoadingAnimate=function(){elements.loading_div.css("display","")},a.createIframe=function(e,t,n){var o=$("<iframe></iframe>").prop("src",e).css(t).css({"vertical-align":"middle",border:"none"});if(n)n.append(o);else{n=$("<div class='fullscreen-bg'></div>");var i=$("<div class='center-align-div'></div>");o.close=function(){n.removeClass("show");var e=$._data(n[0],"events");void 0!==e&&e.hasOwnProperty(e_transitionend)||n.one(e_transitionend,function(e){n.hasClass("show")||n.remove()})},n.one("click.close_iframe",function(e){o.close(),cancelEvent(e)}),n.on("click",cancelEvent),n.append(o).append(i),$body.append(n),n[0].offsetHeight,n.addClass("show")}return o},a.showInputWarning=function(e,t){var n=$("<div></div>").attr({id:e[0].id+"-warning",class:"input-warning-div",tooltip:t}).html("<i class='fas fa-exclamation-triangle' aria-hidden='true'></i>");e.after(n),tooltip.applyTooltip(n)},a.setChatListHeight(),a.initDialogPages(),a.initTextareaCharCounter(),a.autoHideLoadingAnimate(),tooltip.onload(),$body.removeClass("loading"),$win.on("resize",function(e){a.setChatListHeight(),safeCall(chat.updateChatLineIndicator)})}},tooltip={onload:function(){var s=this;s.elements={tooltip_div:$("#tooltip-div"),tooltip_text:$("#tooltip-text")},s.updateTooltip=function(e,t){e.attr("tooltip",t),e.is(":hover")&&s.elements.tooltip_text.html(t)},s.applyTooltip=function(e,t){void 0!==t&&e.attr("tooltip",t),e.on1("mouseover",s.onMouseOverTooltip),e.on1("mouseout",s.onMouseOutTooltip)},s.applyTooltipAll=function(e){e[0].hasAttribute("tooltip")&&s.applyTooltip(e),s.applyTooltip(e.find("[tooltip]"))},s.removeTooltip=function(e){e.length&&(e.removeAttr("tooltip"),e.off("mouseover mouseout"),e.is(":hover")&&s.elements.tooltip_div.removeClass("show"))},s.onMouseOverTooltip=function(e){s.elements.tooltip_text.html(this.getAttribute("tooltip")),s.elements.tooltip_div.addClass("show");var t=$(this),n=t.offset();s.elements.tooltip_div.offset({left:n.left,top:n.top-s.elements.tooltip_div.outerHeight()-8});var o=s.elements.tooltip_div.offset(),i=window.innerWidth-s.elements.tooltip_div.outerWidth()-5;s.elements.tooltip_text.offset({left:o.left>i?i:o.left}),o.top<0?(s.elements.tooltip_div.offset({left:n.left,top:n.top+t.outerHeight()+8}),s.elements.tooltip_div.addClass("bottom")):s.elements.tooltip_div.removeClass("bottom")},s.onMouseOutTooltip=function(e){s.elements.tooltip_div.removeClass("show")},s.applyTooltip($("[tooltip]"))}},e_animationend=function(){var e={animation:"animationend",OAnimation:"oAnimationEnd oanimationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in e)if(void 0!==document.body.style[t])return e[t];return"animationend"}(),e_transitionend=function(){var e={transition:"transitionend",OTransition:"oTransitionEnd otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in e)if(void 0!==document.body.style[t])return e[t];return"transitionend"}(),user_group={};function create_youtube(){var l=new platform("youtube","YouTube");l.api_url="https://www.googleapis.com/youtube/v3/",l.elements={connect_label:$("#connect-youtube-label"),live_info_div:$("#youtube-live-info-div"),live_status_div:$("#youtube-live-status-div"),viewer_user_count:$("#youtube-live-status-div>.viewer-count-div>.user-count"),follower_user_counut:$("#youtube-live-info-div>.follower-count-div>.user-count"),live_time_div:$("#youtube-live-status-div>.live-time-div"),live_up_time:$("#youtube-live-status-div>.live-time-div>.up-time"),channel_title_textarea:$("#youtube-channel-title-textarea"),channel_description_textarea:$("#youtube-channel-description-textarea"),channel_status_set_button:$("#youtube-channel-status-set-button"),channel_status_refresh_button:$("#youtube-channel-status-refresh-button")},l.init=function(){l.user_name="",l.id="",l.channel_id="",l.video_id="",l.liveChatId="",l.nextPageToken="",l.messages_id=[],l.activeLive=!1,l.msg_interval=0,l.last_follower_date=0,l.new_follower_date=0},l.init(),l.initApiEndpoints=function(){l.setApiLinks({get_user_name:l.api_url+"channels?part=id%2Csnippet&mine=true&fields=items(id%2Csnippet%2Ftitle)",get_active_video_id:l.api_url+"liveBroadcasts?part=snippet&broadcastStatus=active",get_inactive_video_id:l.api_url+"liveBroadcasts?part=snippet&broadcastType=persistent&mine=true",get_next_page_token:l.api_url+"liveChat/messages?part=id&fields=items(id)%2CnextPageToken%2CpollingIntervalMillis",get_messages:l.api_url+"liveChat/messages?part=snippet%2CauthorDetails%2Cid&fields=items(authorDetails%2Csnippet%2Cid)%2CnextPageToken%2CpollingIntervalMillis&profileImageSize=32",send_message:l.api_url+"liveChat/messages?part=snippet&fields=id%2Csnippet%2FdisplayMessage",get_stream_status:l.api_url+"videos?part=liveStreamingDetails",set_channel_info:l.api_url+"liveBroadcasts?part=snippet",get_channel_statistics:l.api_url+"channels?part=statistics&mine=true",get_follower:l.api_url+"subscriptions?part=snippet%2CsubscriberSnippet&myRecentSubscribers=true&fields=items(snippet%2FpublishedAt%2CsubscriberSnippet(channelId%2Ctitle))%2CnextPageToken%2CpageInfo%2FtotalResults"})},l.onChangeToken=function(){l.setApiHeaders({Authorization:"Bearer "+l.access_token})},l.connect=function(){l.agreed()||!(config.options.services[l.name]&&config.options.services[l.name].access_token||session&&session[l.name]&&session[l.name].access_token)?checkAuth(l.name,function(e){e&&(checkTokenExpire(l.name,function(){l.initApiEndpoints(),l.getUserName(),chat.systemMessage(l.name,"Searching for active live broadcast..."),l.getActiveBroadcast(function(e){l.getChannelInfo(e)}),l.timer.get_stream_status.isFinished()&&l.getStreamStatus(),l.startFollower()}),l.toggleConnectStatus(!0))}):showAgreement(function(){l.connect()})},l.disconnect=function(){isEmpty(l.liveChatId)||chat.systemMessage(l.name,"Disonnected."),l.init(),l.toggleConnectStatus(!1),l.toggleNameList(!1)},l.agreed=function(){return config.options.youtube_agreement&&1551183204257<=config.options.youtube_agreement},l.onError=function(e,t){var n=e&&e.responseJSON&&e.responseJSON.error&&e.responseJSON.error.errors&&e.responseJSON.error.errors.length&&e.responseJSON.error.errors[0].reason?e.responseJSON.error.errors[0].reason:"";return isEmpty(l.refresh_token)?(unauthPlatform(l.name),chat.systemMessage(l.name,"Authentication error occured. Please reconnect YouTube service."),!1):("authError"===n&&(l.access_token="",l.expires_at="",chat.systemMessage(l.name,"Authentication error occured. Reconnecting..."),refreshToken(l.name,function(e){e&&chat.systemMessage(l.name,"Connected sucessfully.")})),isEmpty(t)||(e&&e.responseJSON&&e.responseJSON.error&&e.responseJSON.error.message&&(t+="("+e.responseJSON.error.message+")"),chat.systemMessage(l.name,t)),!0)},l.getUserName=function(){l.api("get_user_name").done(function(e){e&&e.items&&(e.items.length,1)&&(l.user_name=e.items[0].snippet.title,chat.addSelfUsername(l.name,l.user_name),l.channel_id=e.items[0].id,updateId(l.name,l.channel_id),tooltip.applyTooltip(l.elements.connect_label,l.user_name))}).fail(function(e){l.onError(e,"Failed to retrieve Username.")&&l.timer.get_user_name.start()})},l.processGetActiveBroadcast=function(e,t,n){if(e.items&&e.items.length&&e.items[0].hasOwnProperty("snippet")){var o=e.items[0];return l.activeLive=t,l.liveChatId===o.snippet.liveChatId&&l.video_id===o.id||(l.video_id=o.id,l.liveChatId=o.snippet.liveChatId,l.getNextPageToken(),chat.systemMessage(l.name,(t?"Active":"Persistent")+' live broadcast found. Connecting to "'+o.snippet.title+'"...'),l.getStreamStatus()),n&&n(o),!0}return!1},l.getActiveBroadcast=function(t){l.access_token&&l.api("get_active_video_id").done(function(e){l.activeLive=!1,l.processGetActiveBroadcast(e,!0,t)||l.api("get_inactive_video_id").done(function(e){l.processGetActiveBroadcast(e,!1,t)})}).fail(function(e){l.onError(e,"Failed to retrieve liveChatId.")})},l.getNextPageToken=function(){l.api("get_next_page_token",{data:{liveChatId:l.liveChatId}}).done(function(e){l.nextPageToken=e.nextPageToken;var t=e.pollingIntervalMillis||1e4;if(l.timer.polling_message.start(l.pollingMessage,Number(t)),chat.systemMessage(l.name,"Connected successfully."),l.toggleNameList(!0),!isEmpty(e.items))for(var n=0;n<e.items.length;n++){var o=e.items[n];o.id&&l.messages_id.push(o.id)}}).fail(function(e){l.onError(e,"Failed to retrieve nextPageToken.")&&l.timer.polling_message.start(l.getNextPageToken,3e4)})},l.pollingMessage=function(){if(!isEmpty(l.liveChatId)){var e={url:l.api_links.get_messages,data:{pageToken:l.nextPageToken,liveChatId:l.liveChatId}};e.headers=l.api_headers,$.ajax(e).done(function(e){if(!isEmpty(e.nextPageToken)){l.nextPageToken=e.nextPageToken;var t=0;if(!isEmpty(e.items))for(var n=0;n<e.items.length;n++){var o=e.items[n];if(o.id&&-1===l.messages_id.indexOf(o.id)&&(100<l.messages_id.length&&l.messages_id.shift(),l.messages_id.push(o.id),t++,!isEmpty(o.snippet.displayMessage)))if(isEmpty(o.snippet.textMessageDetails))chat.noticeMessage(l.name,o.snippet.displayMessage);else{var i={user:{"display-name":o.authorDetails.displayName,roles:{},color:null},message:l.filterMessage(o.snippet.textMessageDetails.messageText),formatted_message:l.formatMessage(o.snippet.textMessageDetails.messageText),badge:l.getBadges(o.authorDetails)};if(o.authorDetails.isChatSponsor&&(i.user.roles.subscriber=1),o.authorDetails.isChatModerator&&(i.user.roles.moderator=1),o.id&&l.send_message_id.reply_id.hasOwnProperty(o.id)){if(i.self=!0,i.sent={id:l.send_message_id.reply_id[o.id],complete:!1},l.send_message_id.msg_id.hasOwnProperty(i.sent.id)){var s=l.send_message_id.msg_id[i.sent.id];i.sent.output=s.output,i.event=s.event,s.reply_id.hasOwnProperty(o.id)&&(s.complete|=s.reply_id[o.id],delete s.reply_id[o.id],delete l.send_message_id.reply_id[o.id]),s.complete&&isEmpty(s.reply_id)&&(i.sent.complete=!0,delete l.send_message_id.msg_id[i.sent.id])}}else i.self=o.authorDetails.isChatOwner;""!==l.channel_id&&l.channel_id!==o.authorDetails.channelId&&$doc.trigger("name_list:join",{platform_name:l.name,user:{id:o.authorDetails.channelId,display_name:o.authorDetails.displayName,timeout:6e5}}),chat.onMessage(l.name,i)}}l.timer.polling_message.start(l.pollingMessage,l.getMessageInterval(Number(e.pollingIntervalMillis||1e4),0!==t))}}).fail(function(e){l.onError(e,"Failed to retrieve messages.")&&l.timer.polling_message.start(l.pollingMessage,l.getMessageInterval(1e4,!1))})}},l.getMessageInterval=function(e,t){if(t)l.msg_interval=e;else{var n=l.online_status?1e4:3e4;l.msg_interval+=1e3,l.msg_interval>n&&(l.msg_interval=n),l.msg_interval<e&&(l.msg_interval=e)}return l.msg_interval};var o={awesome:"32dbc7bd",buffering:"b38c13de",chillwcat:"bfc0822d",chillwdog:"afa2e842",dothefive:"2e2d6341",elbowbump:"faa659fd",elbowcough:"db1a3929",gar:"ce71e6d1",goodvibes:"568209c0",hydrate:"f492364b",jakepeter:"7eee311c",learning:"6fb946f2",oops:"f13cf02c",sanitizer:"da7f22dd",shelterin:"c5f80a61",socialdist:"e16a72dd",stayhome:"6b154a03",takeout:"2edbbfd8",thanksdoc:"2b481e7d",videocall:"1da8c6ce",virtualhug:"8e197eb9",washhands:"815b31d8",wormorangegreen:"9e485a0d",wormredblue:"aa4914cf",wormyellowred:"310d5907",yougotthis:"3f9c7538",yt:"4095743d",ytg:"261171b8"};var t=function(){var e=[];for(var t in o)e.push(t);return new RegExp(":("+e.join("|")+"):","gi")}(),n=function(e,t){var n=t.toLowerCase();return'<span class="youtube-emoji" tooltip=":'+n+':"><img src="pic/yt/'+n+"."+o[n]+'.png" alt=":'+n+':"></span>'};return l.filterMessage=function(e){return chat.keyword_filter.isMuteEmoticons()?e.replace(t," "):e},l.formatMessage=function(e){return e.replace(t,n)},l.getBadges=function(e){var t="";return isEmpty(e.profileImageUrl)||(t+='<img src="'+e.profileImageUrl+'" class="youtube-profile-img profile-img">'),e.isChatOwner&&(t+='<span class="youtube-badge youtube-badge-owner" tooltip="Owner"></span>'),e.isChatModerator&&(t+='<span class="youtube-badge youtube-badge-moderator" tooltip="Moderator"></span>'),e.isChatSponsor&&(t+='<span class="youtube-badge youtube-badge-sponsor" tooltip="Sponsor"></span>'),e.isVerified&&(t+='<span class="youtube-badge youtube-badge-verified" tooltip="Verified User"></span>'),t},l.sendMessage=function(n){return!isEmpty(l.liveChatId)&&(l.send_message_id.msg_id[n.id]={reply_id:{},complete:!1,output:n.output,failed:0,event:!!n.hasOwnProperty("event")&&n.event},stringSlice(n.msg,200,function(e,t){l.processSendMessage({msg:e,id:n.id,complete:t})}),!0)},l.send_message_queue=[],l.send_message_sending=!1,l.send_message_id={msg_id:{},reply_id:{}},l.processSendMessage=function(e){isEmpty(e.msg)||(l.send_message_queue.push(e),!1===l.send_message_sending&&(l.send_message_sending=!0,l.processSendMessageQueue()))},l.processSendMessageQueue=function(){if(l.send_message_queue.length<=0)l.send_message_sending=!1;else{var t=l.send_message_queue.shift();l.send_message_current_id=t.id,l.api("send_message",{data:JSON.stringify({snippet:{type:"textMessageEvent",liveChatId:l.liveChatId,textMessageDetails:{messageText:t.msg}}}),method:"POST",contentType:"application/json"}).done(function(e){e&&e.id&&l.send_message_id.msg_id.hasOwnProperty(t.id)&&(l.send_message_id.msg_id[t.id].reply_id[e.id]=t.complete,l.send_message_id.reply_id[e.id]=t.id,t.complete&&0===l.send_message_id.msg_id[t.id].failed&&chat.onMessageSentComplete(l.name,t.id))}).fail(function(e){l.onError(e,'Failed to send message "'+t.msg+'".'),l.send_message_id.msg_id.hasOwnProperty(t.id)&&++l.send_message_id.msg_id[t.id].failed}).always(function(){l.timer.send_message_queue.start()})}},l.getStreamStatus=function(){isEmpty(l.video_id)?(l.toggleOnlineStatus(!1),l.getActiveBroadcast()):l.api("get_stream_status",{data:{id:l.video_id}}).done(function(e,t,n){if(!isEmpty(e.items)&&e.items.length&&!isEmpty(e.items[0].liveStreamingDetails)){if(isEmpty(e.items[0].liveStreamingDetails.actualEndTime)&&!isEmpty(e.items[0].liveStreamingDetails.actualStartTime))return l.toggleOnlineStatus(!0),l.showLiveTime(new Date(e.items[0].liveStreamingDetails.actualStartTime)-(new Date(n.getResponseHeader("date")||Date.now())-Date.now())),void l.showViewerCounter(e.items[0].liveStreamingDetails.concurrentViewers);isEmpty(e.items[0].liveStreamingDetails.actualEndTime)?isEmpty(l.access_token)&&l.onError(n,"Failed to retrieve stream status."):(l.video_id="",l.getActiveBroadcast())}l.toggleOnlineStatus(!1)}).fail(function(e){l.onError(e,"Failed to retrieve stream status.")}),l.timer.get_stream_status.start()},l.max_follower_result=5,l.startFollower=function(){events.follower_id_list.youtube=[],l.api("get_follower",{data:{maxResults:50}}).done(function(e){if(e&&(l.showFollowerCounter(e.pageInfo&&e.pageInfo.hasOwnProperty("totalResults")?e.pageInfo.totalResults:0),!isEmpty(e.items)&&e.items.length)){e.items[0].snippet&&e.items[0].snippet.publishedAt&&(l.last_follower_date=new Date(e.items[0].snippet.publishedAt));for(var t=e.items.length-1;0<=t;--t)e.items[t].subscriberSnippet&&e.items[t].subscriberSnippet.channelId&&events.follower_id_list.youtube.push(e.items[t].subscriberSnippet.channelId)}}).fail(function(e){l.onError(e,"Failed to retrieve follower statistics.")}),l.timer.get_follower.start()},l.getFollower=function(r){l.api("get_follower",{data:{maxResults:r?50:l.max_follower_result}}).done(function(e,t,n){if(e&&(void 0===r&&l.showFollowerCounter(e.pageInfo&&e.pageInfo.hasOwnProperty("totalResults")?e.pageInfo.totalResults:0),!isEmpty(e.items)&&e.items.length)){var o,i,s,a=l.last_follower_date;for(s=e.items.length-1;0<=s;s--)(o=e.items[s]).snippet&&o.snippet.publishedAt&&(a<(i=new Date(o.snippet.publishedAt))&&(a=i),i>l.last_follower_date&&o.subscriberSnippet&&o.subscriberSnippet.channelId&&o.subscriberSnippet.title&&$doc.triggerHandler("events:follower",{platform_name:l.name,username:o.subscriberSnippet.title,id:o.subscriberSnippet.channelId})&&0);l.last_follower_date=a}}).fail(function(e){l.onError(e,"Failed to retrieve follower statistics.")}),l.timer.get_follower.start()},l.elements.channel_status_set_button.on1("click",function(e){l.elements.channel_title_textarea.val().length<1?showSetTitleWarningMessage("["+l.display_name+"] title must not be blank.",$(this)):l.setChannelInfo()}),l.elements.channel_status_refresh_button.on1("click",function(e){l.getActiveBroadcast(function(e){l.getChannelInfo(e)})}),l.getChannelInfo=function(e){l.elements.channel_title_textarea.val(e.snippet.hasOwnProperty("title")?e.snippet.title:""),l.elements.channel_description_textarea.val(e.snippet.hasOwnProperty("description")?e.snippet.description:"")},l.setChannelTitle=function(e){if(!isEmpty(l.video_id)){var t={id:l.video_id,snippet:{title:e}};l.getActiveBroadcast(function(e){e.snippet.hasOwnProperty("description")&&(t.snippet.description=e.snippet.description),e.snippet.hasOwnProperty("scheduledStartTime")&&(t.snippet.scheduledStartTime=e.snippet.scheduledStartTime),e.snippet.hasOwnProperty("scheduledEndTime")&&(t.snippet.scheduledEndTime=e.snippet.scheduledEndTime),l.api("set_channel_info",{data:JSON.stringify(t),method:"PUT",contentType:"application/json"}).done(function(e){if(isEmpty(e)||isEmpty(e.snippet))chat.systemMessage(l.name,"Failed to update channel title.");else{var t=e.snippet.hasOwnProperty("title")?e.snippet.title:"",n=e.snippet.hasOwnProperty("description")?e.snippet.description:"";l.elements.channel_title_textarea.val(t),l.elements.channel_description_textarea.val(n),chat.systemMessage(l.name,"Channel information updated successfully. Title: "+t)}}).fail(function(e){l.onError(e,"Failed to update channel title.")})})}},l.setChannelInfo=function(){if(!isEmpty(l.video_id)){var t={id:l.video_id,snippet:{title:l.elements.channel_title_textarea.val(),description:l.elements.channel_description_textarea.val()}};l.getActiveBroadcast(function(e){e.snippet.hasOwnProperty("scheduledStartTime")&&(t.scheduledStartTime=e.snippet.scheduledStartTime),e.snippet.hasOwnProperty("scheduledEndTime")&&(t.scheduledEndTime=e.snippet.scheduledEndTime),l.api("set_channel_info",{data:JSON.stringify(t),method:"PUT",contentType:"application/json"}).done(function(e){if(isEmpty(e)||isEmpty(e.snippet))chat.systemMessage(l.name,"Failed to update channel title and description.");else{var t=e.snippet.hasOwnProperty("title")?e.snippet.title:"",n=e.snippet.hasOwnProperty("description")?e.snippet.description:"";chat.systemMessage(l.name,"Channel information updated successfully. Title: "+t+" , Description: "+n)}}).fail(function(e){l.onError(e,"Failed to update channel title and description.")})})}},l.isViewer=function(e){return e!==l.channel_id},l.timer.get_user_name=new Timer(l.getUserName,3e4),l.timer.polling_message=new Timer,l.timer.get_stream_status=new Timer(l.getStreamStatus,6e4),l.timer.get_follower=new Timer(l.getFollower,6e4),l.timer.send_message_queue=new Timer(l.processSendMessageQueue,1e3),l}user_group.onload=function(){this.init_user_voice_timeout=!1,this.group_audio=[],this.user_group_id=0,this.user_group_service_names=["general","twitch","youtube"],this.user_group_service_display_names=["All",twitch.display_name,youtube.display_name],this.user_group_type_names=["normal_user","self","moderator","subscriber"],this.user_group_type=null,this.selected_user_group_ele=null,this.elements={user_group_div:$("#user-group-div"),user_group_content:$("#user-group-content"),user_group_menu_div:$("#user-group-menu-div"),user_group_name_inputtext:$("#user-group-name-inputtext"),user_group_show_message_checkbox:$("#user-group-show-message-checkbox"),user_group_enable_speech_checkbox:$("#user-group-enable-speech-checkbox"),user_group_audio_notification_title_div:$("#user-group-audio-notification-dropdown-title-div"),add_user_group_div:$("#add-user-group-div"),remove_user_group_div:$("#remove-user-group-div"),add_user_group_menu_div:$("#add-user-group-menu-div"),remove_user_group_confirm_div:$("#remove-user-group-confirm-div"),remove_user_group_confirm_yes_button:$("#remove-user-group-confirm-yes-button"),remove_user_group_confirm_no_button:$("#remove-user-group-confirm-no-button"),user_group_name_list_div:$(".user-group-name-list-div"),user_group_name_list_edit_menu:$("#user-group-name-list-edit-menu"),user_group_name_list_edit_inputtext:$("#user-group-name-list-edit-inputtext"),user_group_name_list_edit_button:$("#user-group-name-list-edit-button"),user_group_remove_user_confirm_menu:$("#user-group-remove-user-confirm-menu"),user_group_remove_user_confirm_yes_button:$("#user-group-remove-user-confirm-yes-button"),user_group_remove_user_confirm_no_button:$("#user-group-remove-user-confirm-no-button"),user_group_user_advanced_options_menu:$("#user-group-user-advanced-options-menu"),user_group_enable_user_adv_options_checkbox:$("#user-group-enable-user-adv-options-checkbox"),user_group_enable_user_adv_options_label:$("#user-group-enable-user-adv-options-label"),user_group_user_adv_options_fieldset:$("#user-group-user-adv-options-fieldset"),user_group_user_pitch_slider:$("#user-group-user-pitch-slider"),user_group_user_rate_slider:$("#user-group-user-rate-slider"),user_group_user_volume_slider:$("#user-group-user-volume-slider"),user_group_user_name_pronunciation_inputtext:$("#user-group-user-name-pronunciation-inputtext"),user_group_user_name_voice_select_div:$("#user-group-user-name-voice-select-div"),user_group_user_name_voice_select:$("#user-group-user-name-voice-select"),user_group_user_voice_select_div:$("#user-group-user-voice-select-div"),user_group_user_voice_select:$("#user-group-user-voice-select")};for(var e=0;e<this.user_group_service_names.length;++e){var t=this.user_group_service_names[e],n="<div class='user-group-name-list-service-div'><div class='user-group-name-list-service-name' data-service-name='"+t+"'>"+this.user_group_service_display_names[e]+"<div class='user-group-name-list-option-div'><input id='user-group-name-normal_user-checkbox-"+t+"' class='option-checkbox' type='checkbox'><label for='user-group-name-normal_user-checkbox-"+t+"' class='option-label checkbox-label' tooltip='Normal users'><i class='fas fa-male' aria-hidden='true'></i></label><input id='user-group-name-self-checkbox-"+t+"' class='option-checkbox' type='checkbox'><label for='user-group-name-self-checkbox-"+t+"' class='option-label checkbox-label' tooltip='Self'><i class='fas fa-user-circle' aria-hidden='true'></i></label><input id='user-group-name-moderator-checkbox-"+t+"' class='option-checkbox' type='checkbox'><label for='user-group-name-moderator-checkbox-"+t+"' class='option-label checkbox-label' tooltip='Moderators'><i class='fas fa-wrench' aria-hidden='true'></i></label><input id='user-group-name-subscriber-checkbox-"+t+"' class='option-checkbox' type='checkbox'><label for='user-group-name-subscriber-checkbox-"+t+"' class='option-label checkbox-label' tooltip='Subscribers'><i class='far fa-heart' aria-hidden='true'></i></label><div id='user-group-name-list-edit-"+t+"' class='user-group-name-list-edit-title dropdown-title-div' tooltip='Add users'><div class='user-group-name-list-edit dropdown-title'><i class='fas fa-plus' aria-hidden='true'></i><i class='fas fa-user' aria-hidden='true'></i></div></div></div></div><div class='user-group-name-list-toggle'><ul id='user-group-name-list-service-"+t+"' class='user-group-name-list'></ul></div></div>";$(".user-group-name-list-scroll-div").append(n)}tooltip.applyTooltip($(".user-group-name-list-service-div [tooltip]")),tooltip.updateTooltip($("#user-group-name-subscriber-checkbox-youtube+label"),"Sponsers")},user_group.USER_GROUP_TYPE=function(){this.normal_user=null,this.self=null,this.moderator=null,this.subscriber=null},user_group.USER_GROUP_SERVICE_TYPE=function(){this.general=new user_group.USER_GROUP_TYPE,this.twitch=new user_group.USER_GROUP_TYPE,this.youtube=new user_group.USER_GROUP_TYPE},user_group.USER_GROUP_SERVICE_NAME_LIST=function(){this.names=[],this.normal_user=this.self=this.moderator=this.subscriber=!1},user_group.USER_GROUP_NAME_LIST=function(){this.general=new user_group.USER_GROUP_SERVICE_NAME_LIST,this.twitch=new user_group.USER_GROUP_SERVICE_NAME_LIST,this.youtube=new user_group.USER_GROUP_SERVICE_NAME_LIST},user_group.getUserGroupByType=function(e,t){return null!==user_group.user_group_type[t][e]?user_group.user_group_type[t][e]:null!==user_group.user_group_type.general[e]?user_group.user_group_type.general[e]:null},user_group.getUserGroupByUserName=function(e,t){if(e=e.toLowerCase(),isEmpty(config)||isEmpty(config.user_groups))return null;for(var n=0,o=config.user_groups.length;n<o;++n)if(0<=config.user_groups[n].name_list.general.names.indexOf(e)||0<=config.user_groups[n].name_list[t].names.indexOf(e))return config.user_groups[n];return null},user_group.getUserAdvOptionsByGroup=function(e,n,o){var t=null;if(null!==o){var i=function(e){var t=null;return e=e.toLowerCase(),o.name_list[n].hasOwnProperty("adv_options")&&o.name_list[n].adv_options.hasOwnProperty(e)&&((t=o.name_list[n].adv_options[e]).hasOwnProperty("enable")&&t.enable||(t=null)),!t&&o.name_list.general.hasOwnProperty("adv_options")&&o.name_list.general.adv_options.hasOwnProperty(e)&&(t=o.name_list.general.adv_options[e]),"object"==typeof t&&null!==t&&t.enable||(t=null),t};if("object"!=typeof e)return i(e);if(!isEmpty(e.name)&&(t=i(e.name)))return t;if(!isEmpty(e.display_name)&&(t=i(e.display_name)))return t}return t},user_group.getUserAdvOptions=function(e,t){return user_group.getUserAdvOptionsByGroup(e,t,user_group.getUserGroupByUserName(e,t))},user_group.getVoiceAdvOptionsValue=function(e,t){void 0===e&&(e=t);var n=Math.min(parseInt(e),99);return(n<10?"0":"")+n},user_group.getVoiceAdvOptionsVoice=function(e,t){if(void 0===e)return t;for(var n=1;n<voice_select_list_2.length;++n)if(voice_select_list_2[n].html===e)return n-1;return t},user_group.getVoiceByUserAdvOptions=function(e){var t="";return null!==e&&(t="!s"+user_group.getVoiceAdvOptionsValue(e.pitch,50)+user_group.getVoiceAdvOptionsValue(e.rate,50)+user_group.getVoiceAdvOptionsValue(e.volume,100)+user_group.getVoiceAdvOptionsVoice(e.user_voice,9999)),t},user_group.getVoiceIdByUserAdvOptions=function(e){var t=9999;return null!==e&&(t=user_group.getVoiceAdvOptionsVoice(e.username_voice,9999)),9999===t&&0<=username_voice_index&&(t=username_voice_index),t},user_group.getNamePronByAdvOptions=function(e,t){return null===e||isEmpty(e.name_pron)?t:e.name_pron},user_group.updateUserGroupNameList=function(e,t){var n=$("#user-group-name-list-service-"+t);n.empty();for(var o="",i=e.name_list[t],s=0;s<i.names.length;++s)o+="<li>"+i.names[s]+"<div class='user-group-name-list-remove-user-button dropdown-title-div' tooltip='Remove user'><div class='dropdown-title'><i class='fas fa-times' aria-hidden='true'></i></div></div><div class='user-group-name-list-advanced-options-button dropdown-title-div' tooltip='Options'><div class='dropdown-title'><i class='fas fa-cog' aria-hidden='true'></i></div></div><div class='user-group-name-list-advanced-options-indicator'></div></li>";var a=$(o);if(n.append(a),"object"==typeof i.adv_options)for(var r in i.adv_options)if(i.adv_options[r].enable){var l=i.names.indexOf(r);0<=l&&a.find(".user-group-name-list-advanced-options-indicator").eq(l).addClass("enable")}tooltip.applyTooltip(a.find(">.user-group-name-list-remove-user-button,>.user-group-name-list-advanced-options-button")),$(".user-group-name-list-toggle").each(function(){var e=$(this),t=e.find(">.user-group-name-list").outerHeight(!0);0<t&&(t+=3),e.css("height",t)}),$(".user-group-name-list-remove-user-button").on1("click",function(e){cancelEvent(e);var t=$(this),n=!t.find(">.dropdown-title").hasClass(dropdown_title_show_classname);user_group.hideAllUserGroupMenu(),n&&(showDropdownTitle(t.find(">.dropdown-title")),user_group.confirmRemoveUser(t.parent().parent().parent().siblings(".user-group-name-list-service-name")[0].dataset.serviceName,t.parent().parent().find(">li").index(t.parent()),getMenuOffset(this)))}),$(".user-group-name-list-advanced-options-button").on1("click",function(e){cancelEvent(e);var t=$(this),n=!t.find(">.dropdown-title").hasClass(dropdown_title_show_classname);user_group.hideAllUserGroupMenu(),n&&user_group.openUserAdvancedOptions(t.parent().parent().parent().siblings(".user-group-name-list-service-name")[0].dataset.serviceName,t.parent().parent().find(">li").index(t.parent()),getMenuOffset(this))});for(s=0;s<user_group.user_group_service_names.length;++s){t=user_group.user_group_service_names[s];for(var u=0;u<user_group.user_group_type_names.length;++u){var c=user_group.user_group_type_names[u];$("#user-group-name-"+c+"-checkbox-"+t)[0].checked=e.name_list[t][c]}}},user_group.initUserGroupNameList=function(){if(config.user_groups.length){for(var e=0;e<config.user_groups.length;++e)for(var t=0;t<user_group.user_group_service_names.length;++t){for(var n=config.user_groups[e].name_list[user_group.user_group_service_names[t]],o=n.names,i=0;i<o.length;++i)o[i]=o[i].toLowerCase();var s=n.adv_options;if("object"==typeof s)for(var a in s)void 0!==s[a].enable&&s[a].enable&&(points.toggle("user_group_user_advanced_options",!0,"activate advanced user group options")||(s[a].enable=!1,updateConfig("user_group",e)))}user_group.openUserGroupNameList(user_group.getGroupByIndex(0))}$(".user-group-name-list-service-name").on1("click",function(e){cancelEvent(e),user_group.hideAllUserGroupMenu();var t=$(this).siblings(".user-group-name-list-toggle");if(t.hasClass("collapse-group")){var n=t.find(">.user-group-name-list").outerHeight(!0);0<n&&(n+=3),t.css("height",n)}else t.css("height",0);t.toggleClass("collapse-group")}),user_group.elements.user_group_name_list_div.on1("click",function(e){cancelEvent(e),user_group.hideAllUserGroupMenu()}),$("input.tab-radio[name='tabs1']").on1("change",function(e){user_group.elements.user_group_div.toggleClass("show-user-group-div",$(e.target).hasClass("user-group-radio"))});for(e=0;e<user_group.user_group_service_names.length;++e)for(var r=0;r<user_group.user_group_type_names.length;++r)$("#user-group-name-"+user_group.user_group_type_names[r]+"-checkbox-"+user_group.user_group_service_names[e]).on1("change",function(e){var t=this.id.replace(/^.+-checkbox-/gi,""),n=this.id.replace(/^user-group-name-|-checkbox-.+/gi,"");if(null!==user_group.selected_user_group_ele){var o=user_group.getGroupIndex(user_group.selected_user_group_ele);config.user_groups[o].name_list[t][n]=this.checked,updateConfig("user_groups",o),user_group.updateUserGroupType()}});$(".user-group-name-list-edit-title").on1("click",function(e){cancelEvent(e);var t=$(this),n=t.find(">.dropdown-title"),o=!n.hasClass(dropdown_title_show_classname)&&null!==user_group.selected_user_group_ele;user_group.hideAllUserGroupMenu(),o&&(showDropdownTitle(n),showDropdownMenu(user_group.elements.user_group_name_list_edit_menu),user_group.elements.user_group_name_list_edit_menu.css(getMenuOffset(n[0]))),user_group.elements.user_group_name_list_edit_button[0].dataset.serviceName=t.parent().parent()[0].dataset.serviceName}),user_group.elements.user_group_name_list_edit_menu.on1("click",cancelEvent),user_group.elements.user_group_name_list_edit_button.on1("click",function(e){cancelEvent(e),user_group.hideAllUserGroupMenu();var t=user_group.elements.user_group_name_list_edit_inputtext.val().split(",");if(null!==user_group.selected_user_group_ele&&!isEmpty(t)){for(var n=user_group.getGroupIndex(user_group.selected_user_group_ele),o=config.user_groups[n],i=user_group.elements.user_group_name_list_edit_button[0].dataset.serviceName,s=o.name_list[i].names,a=0;a<t.length;++a)t[a]=t[a].trim().toLowerCase(),""!==t[a]&&-1===s.indexOf(t[a])&&s.push(t[a]);user_group.updateUserGroupNameList(o,i),updateConfig("user_groups",n)}user_group.elements.user_group_name_list_edit_inputtext.val("")})},user_group.openUserGroupNameList=function(e){if(user_group.hideAllUserGroupMenu(),hideDropdownTitle($(".user-group.dropdown-title")),null!==(user_group.selected_user_group_ele=e)){showDropdownTitle(e.find(">.dropdown-title")),user_group.elements.user_group_div.animate({scrollTop:e[0].offsetTop},200);var t=user_group.getGroupIndex(e);showDropdownMenu(user_group.elements.user_group_name_list_div);var n=config.user_groups[t];for(var o in user_group.elements.user_group_name_inputtext.val(n.name),user_group.elements.user_group_show_message_checkbox[0].checked=n.show_message,user_group.elements.user_group_enable_speech_checkbox[0].checked=n.speech,$(".user-group-name-list-toggle").removeClass("collapse-group"),config.user_groups[t].name_list)user_group.updateUserGroupNameList(config.user_groups[t],o)}else{user_group.elements.user_group_name_inputtext.val(""),user_group.elements.user_group_show_message_checkbox[0].checked=!1,user_group.elements.user_group_enable_speech_checkbox[0].checked=!1;for(var i=0;i<user_group.user_group_service_names.length;++i){for(var s=0;s<user_group.user_group_type_names.length;++s)$("#user-group-name-"+user_group.user_group_type_names[s]+"-checkbox-"+user_group.user_group_service_names[i])[0].checked=!1;$("#user-group-name-list-service-"+user_group.user_group_service_names[i]).empty()}}},user_group.openUserGroupMenu=function(e){var t=$("#user-group-option-div"),n=user_group.getGroupMenuByIndex(user_group.getGroupIndex(e)),o=!t.hasClass(dropdown_title_show_classname);user_group.hideAllUserGroupMenu(),o&&(n.css(getMenuOffset(user_group.elements.user_group_audio_notification_title_div[0])),showDropdownTitle(t),showDropdownMenu(n))},user_group.confirmRemoveUser=function(i,s,e){showDropdownMenu(user_group.elements.user_group_remove_user_confirm_menu),user_group.elements.user_group_remove_user_confirm_menu.css(e),user_group.elements.user_group_remove_user_confirm_menu.on1("click",cancelEvent),user_group.elements.user_group_remove_user_confirm_yes_button.on1("click",function(e){cancelEvent(e),user_group.hideAllUserGroupMenu();var t=config.user_groups[user_group.getGroupIndex(user_group.selected_user_group_ele)],n=t.name_list[i],o=n.names[s];n.names.splice(s,1),void 0!==n.adv_options&&void 0!==n.adv_options[o]&&(n.adv_options[o].enable&&points.toggle("user_group_user_advanced_options",!1),delete n.adv_options[o]),user_group.updateUserGroupNameList(t,i),updateConfig("user_groups",user_group.getGroupIndex(user_group.selected_user_group_ele))}),user_group.elements.user_group_remove_user_confirm_no_button.on1("click",function(e){cancelEvent(e),user_group.hideAllUserGroupMenu()})},user_group.updateUserGroupUserAdvancedOptions=function(t,n,e,o,i,s,a){void 0!==i&&void 0!==i[n]&&(e=i[n]),t.val(e),o&&tooltip.updateTooltip(t.parent(),o+": "+e+"%"),t.on1("change",function(e){void 0===i&&(s[a]={},i=s[a]),i[n]=this.value,updateConfig()}),o&&t.on1("input",function(e){tooltip.updateTooltip(t.parent(),o+": "+this.value+"%")})},user_group.initAdvOptionsMenuUserVoice=function(e,t,n,o){if(0!==voice_select_list_2.length&&0!==voices_value.length&&(select_list.initSelectList(e,t,voice_select_list_2,function(e){if(!isEmpty(config.options)){if(o&&!o.enable)return void t.selectByText(o[n]||"");void 0!==o&&(o[n]=0<=e.index?e.html:"",updateConfig("options"))}}),void 0!==o&&void 0!==o[n]))for(var i=o[n],s=0;s<voice_select_list_2.length;++s)if(voice_select_list_2[s].html===i)return void t.selectByIndex(s)},user_group.openUserAdvancedOptions=function(i,s,e){var a=config.user_groups[user_group.getGroupIndex(user_group.selected_user_group_ele)],r=a.name_list[i].names[s];void 0===a.name_list[i].adv_options&&(a.name_list[i].adv_options={});var l=a.name_list[i].adv_options[r];ui.createDCDialog({css:{width:250,height:"auto",textAlign:"left"},fullscreen:!0,html:"<div class='center-div'><div class='user-group-user-adv-options-user-name option-label'>Name: "+r+"</div><input id='user-group-enable-user-adv-options-checkbox' class='option-checkbox' type='checkbox'><label id='user-group-enable-user-adv-options-label' for='user-group-enable-user-adv-options-checkbox' class='option-label checkbox-label'>Advanced options</label><span class='cost-points-span checkbox-line-height'><span class='points-img-span'></span></i>1</span><fieldset id='user-group-user-adv-options-fieldset' class='option-fieldset'><label class='option-label user-group-user-slider-container'>Pitch:<div id='user-group-user-pitch-tooltip' class='volume-slider-div option-label' tooltip='Pitch: 100%'><input id='user-group-user-pitch-slider' class='volume-slider' type='range' min='0' max='100' step='1' value='100'></div></label><label class='option-label user-group-user-slider-container'>Rate:<div id='user-group-user-rate-tooltip' class='volume-slider-div option-label' tooltip='Rate: 100%'><input id='user-group-user-rate-slider' class='volume-slider' type='range' min='0' max='100' step='1' value='100'></div></label><label class='option-label user-group-user-slider-container'>Volume:<div id='user-group-user-volume-tooltip' class='volume-slider-div option-label' tooltip='Volume: 100%'><input id='user-group-user-volume-slider' class='volume-slider' type='range' min='0' max='100' step='1' value='100'></div></label><label id='user-group-user-advanced-options-menu-name-pron-label' class='option-label'>Pronunciation of the user name:<br><input id='user-group-user-name-pronunciation-inputtext' class='full-width-tab-inputtext' spellcheck='false'></label><br><label class='option-label user-group-user-voice-label'>Voice to pronunciate user's name:</label><div id='user-group-user-name-voice-select-div' class='option-select-div'><div id='user-group-user-name-voice-select' class='option-select'></div></div><br><label class='option-label user-group-user-voice-label'>User speaking voice:</label><div id='user-group-user-voice-select-div' class='option-select-div'><div id='user-group-user-voice-select' class='option-select'></div></div></fieldset></div>",done:function(e){var t=void 0===l||void 0===l.enable||!l.enable,n=$("#user-group-user-adv-options-fieldset");n.prop("disabled",t),$("#user-group-enable-user-adv-options-checkbox").prop("checked",!t).on1("change",function(e){if(this.checked){if(!points.toggle("user_group_user_advanced_options",!0))return void(this.checked=!1)}else points.toggle("user_group_user_advanced_options",!1);void 0===l&&(l=a.name_list[i].adv_options[r]={}),l.enable=this.checked,updateConfig(),$("#user-group-name-list-service-"+i+">li:eq("+s+")>.user-group-name-list-advanced-options-indicator").toggleClass("enable",l.enable),n.prop("disabled",!l.enable)});var o=a.name_list[i].adv_options;user_group.updateUserGroupUserAdvancedOptions($("#user-group-user-pitch-slider"),"pitch",50,"Pitch",l,o,r),user_group.updateUserGroupUserAdvancedOptions($("#user-group-user-rate-slider"),"rate",50,"Rate",l,o,r),user_group.updateUserGroupUserAdvancedOptions($("#user-group-user-volume-slider"),"volume",100,"Volume",l,o,r),user_group.updateUserGroupUserAdvancedOptions($("#user-group-user-name-pronunciation-inputtext"),"name_pron","",null,l,o,r),user_group.initAdvOptionsMenuUserVoice($("#user-group-user-name-voice-select-div"),$("#user-group-user-name-voice-select"),"username_voice",l),user_group.initAdvOptionsMenuUserVoice($("#user-group-user-voice-select-div"),$("#user-group-user-voice-select"),"user_voice",l),tooltip.applyTooltipAll(e)}})},user_group.initUserGroupUserAdvancedOptionsTooltip=function(){var e=function(e,t){var n=e.parent();e.on1("input",function(e){tooltip.updateTooltip(n,t+this.value+"%")})};e(user_group.elements.user_group_user_pitch_slider,"Pitch: "),e(user_group.elements.user_group_user_rate_slider,"Rate: "),e(user_group.elements.user_group_user_volume_slider,"Volume: ")},user_group.hideAllUserGroupMenu=function(){hideDropdownTitle($("#user-group-content~div .dropdown-title-show, #user-group-content>div:not(#user-group-div) .dropdown-title-show")),hideDropdownMenu($("#user-group-content~div .dropdown-menu-show,#user-group-content~ .dropdown-menu-show,#user-group-content .dropdown-menu-show")),user_group.hideSelectAudioMenu()},user_group.createUserGroup=function(e){defaultValue(e,"show_message",!0),defaultValue(e,"speech",!0),defaultValue(e,"sound",!0),defaultValue(e,"audio_link",""),defaultValue(e,"audio_file",""),defaultValue(e,"volume",100),defaultValue(e,"name_list",""),""===e.name_list&&(e.name_list=new user_group.USER_GROUP_NAME_LIST);for(var t=0;t<user_group.user_group_service_names.length;++t)isEmpty(e.name_list[user_group.user_group_service_names[t]])&&(e.name_list[user_group.user_group_service_names[t]]=new user_group.USER_GROUP_SERVICE_NAME_LIST);var n=user_group.user_group_id++,o=$("<div class='dropdown-title-div'><div class='user-group dropdown-title user-group-hidden'>"+e.name+"</div></div>"),i=$("<div class='user-group-menu dropdown-menu'><div id='audio-select-div-"+n+"' class='audio-select-div'><label class='user-group-select-audio-label option-label'>Audio File:</label><button id='select-audio-local-button-"+n+"' class='select-audio-button' tooltip='File will upload to your Google Drive.'>Local disk file</button><button id='select-audio-external-button-"+n+"' class='select-audio-button'>External links</button></div><div id='audio-div-"+n+"' class='audio-div'><label class='option-label'>Audio File:</label><div class='audio-control-div'><div id='audio-volume-tooltip-"+n+"' class='volume-slider-div option-label' tooltip='Volume: 100%'><input id='audio-volume-slider-"+n+"' class='volume-slider' type='range' min='0' max='100' step='1' value='100'></div><div id='audio-test-div-"+n+"' class='test-audio dropdown-title-div' tooltip='test'><i class='fas fa-volume-up dropdown-title audio-test-i' aria-hidden='true'></i></div></div><input id='audio-inputtext-"+n+"' class='audio-inputtext' spellcheck='false' readonly><button id='audio-remove-button-"+n+"' class='audio-remove-button' tooltip='Remove'><i class='fas fa-trash' aria-hidden='true'></i></button></div></div>"),s=o.find(">.dropdown-title");user_group.elements.user_group_div.append(o),user_group.elements.user_group_menu_div.append(i),tooltip.applyTooltip(i.find("[tooltip]")),o.on1("click",function(e){user_group.openUserGroupNameList(o),cancelEvent(e)}),i.on1("click",function(e){cancelEvent(e)}),i.on1("mousedown",function(e){user_group.hideConfirmRemoveUserGroupMenu(),user_group.hideSelectAudioMenu()}),s[0].offsetHeight,s.removeClass("user-group-hidden"),initAudioElement({id:n,cfg:e,setAudio:function(e){user_group.group_audio[user_group.getGroupIndex(o)]=e},getAudio:function(){return user_group.group_audio[user_group.getGroupIndex(o)]},getParents:function(){return null},updateConfigAudio:function(){updateConfig("user_groups",user_group.getGroupIndex(o))}})},user_group.addUserGroup=function(e){config.user_groups.push(e),user_group.createUserGroup(e),user_group.openUserGroupNameList(user_group.getGroupByIndex(config.user_groups.length-1)),updateConfig("add_user_group",config.user_groups.length-1)},user_group.removeUserGroup=function(e){var t=user_group.getGroupIndex(e),n=e.find(">.dropdown-title");if(!(-1===t||t>=config.user_groups.length)){removeAudioFile(config.user_groups[t].audio_file),config.user_groups.splice(t,1),user_group.group_audio.splice(t,1),hideDropdownTitle(n),e.addClass("user-group-hidden"),e.off("click"),setTimeout(function(){e.remove()},200);var o=user_group.elements.user_group_menu_div.find(">:eq("+t+")");o.appendTo("#remove-user-group-div"),o[0].offsetHeight,o.removeClass(dropdown_menu_show_classname),setTimeout(function(){o.remove()},200),user_group.openUserGroupNameList(config.user_groups.length?user_group.getGroupByIndex(t<config.user_groups.length?t:config.user_groups.length-1):null),updateConfig("user_groups")}},user_group.confirmRemoveUserGroup=function(t,e){user_group.elements.remove_user_group_confirm_div.css(e),showDropdownMenu(user_group.elements.remove_user_group_confirm_div),user_group.elements.remove_user_group_confirm_yes_button.on1("click",function(e){user_group.hideConfirmRemoveUserGroupMenu(),user_group.removeUserGroup(t),cancelEvent(e)}),user_group.elements.remove_user_group_confirm_no_button.on1("click",function(e){user_group.hideConfirmRemoveUserGroupMenu(),cancelEvent(e)})},user_group.hideConfirmRemoveUserGroupMenu=function(){hideDropdownTitle(user_group.elements.remove_user_group_div),hideDropdownMenu(user_group.elements.remove_user_group_confirm_div)},user_group.hideSelectAudioMenu=function(){hideDropdownMenu(elements.select_audio_external_menu_div)},user_group.getGroupIndex=function(e){return user_group.elements.user_group_div.find(">:not(.user-group-hidden)").index(e)},user_group.getGroupMenuByIndex=function(e){return user_group.elements.user_group_menu_div.find(">:eq("+e+")")},user_group.getGroupByIndex=function(e){return user_group.elements.user_group_div.find(">:not(.user-group-hidden):eq("+e+")")},user_group.enable=function(){if(user_group.elements.user_group_div.empty(),void 0!==config&&config.hasOwnProperty("user_groups"))for(var e=0;e<config.user_groups.length;++e)user_group.createUserGroup(config.user_groups[e]);user_group.elements.add_user_group_div.on1("click",function(e){user_group.addUserGroup({name:"User Group"}),cancelEvent(e)}),user_group.elements.add_user_group_menu_div.on1("click",cancelEvent),user_group.elements.remove_user_group_confirm_div.on1("click",cancelEvent),user_group.elements.user_group_show_message_checkbox.on1("change",function(e){if(!isEmpty(user_group.selected_user_group_ele)){var t=user_group.getGroupIndex(user_group.selected_user_group_ele);config.user_groups[t].show_message=user_group.elements.user_group_show_message_checkbox[0].checked,updateConfig("user_groups",t)}}),user_group.elements.user_group_enable_speech_checkbox.on1("change",function(e){if(!isEmpty(user_group.selected_user_group_ele)){var t=user_group.getGroupIndex(user_group.selected_user_group_ele);config.user_groups[t].speech=user_group.elements.user_group_enable_speech_checkbox[0].checked,updateConfig("user_groups",t)}}),user_group.elements.user_group_audio_notification_title_div.on1("click",function(e){cancelEvent(e),isEmpty(user_group.selected_user_group_ele)||user_group.openUserGroupMenu(user_group.selected_user_group_ele)}),user_group.elements.user_group_name_inputtext.on1("change",function(e){if(isEmpty(user_group.selected_user_group_ele))user_group.elements.user_group_name_inputtext.val("");else{var t=user_group.getGroupIndex(user_group.selected_user_group_ele);config.user_groups[t].name=user_group.elements.user_group_name_inputtext.val(),user_group.selected_user_group_ele.find(">.user-group.dropdown-title").text(user_group.elements.user_group_name_inputtext.val()),updateConfig("user_groups",t)}}),user_group.elements.remove_user_group_div.on1("click",function(e){cancelEvent(e);var t=!user_group.elements.remove_user_group_div.hasClass(dropdown_title_show_classname);user_group.hideAllUserGroupMenu(),t&&!isEmpty(user_group.selected_user_group_ele)&&(showDropdownTitle(user_group.elements.remove_user_group_div),user_group.confirmRemoveUserGroup(user_group.selected_user_group_ele,getMenuOffset(user_group.elements.remove_user_group_div[0])))}),user_group.elements.user_group_content.on1("click",function(e){cancelEvent(e),user_group.hideAllUserGroupMenu()}),user_group.initUserGroupNameList(),user_group.updateUserGroupType(),user_group.initUserGroupUserAdvancedOptionsTooltip()},user_group.disable=function(){user_group.elements.user_group_div.empty(),user_group.elements.user_group_menu_div.empty(),$(".user-group-name-list").empty(),$("#user-group-content, #user-group-content div, #user-group-content button").off("click"),$("#user-group-content input").off("change"),$("#user-group-content input[type='checkbox']:checked").prop("checked",!1),$("input.tab-radio[name='tabs1']").off("change")},user_group.updateUserGroupType=function(){user_group.user_group_type=new user_group.USER_GROUP_SERVICE_TYPE;for(var e=0;e<config.user_groups.length;++e)for(var t=0;t<user_group.user_group_service_names.length;++t)for(var n=user_group.user_group_service_names[t],o=0;o<user_group.user_group_type_names.length;++o){var i=user_group.user_group_type_names[o];isEmpty(user_group.user_group_type[n][i])&&config.user_groups[e].name_list[n][i]&&(user_group.user_group_type[n][i]=config.user_groups[e])}},user_group.playUserGroupAudio=function(e){if(!isEmpty(e.audio_file)||!isEmpty(e.audio_link)){var t=user_group.group_audio[config.user_groups.indexOf(e)];t.currentTime=0,t.play()}};